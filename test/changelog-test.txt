commit 0d5ca3a057ae48b5fdccb2f0a7a841a5cc76d3dd
Merge: 7ee3899 cf9c476
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 1 13:56:57 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit cf9c47690fa0f3da590de766ea8c6a543984ee3c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 1 13:56:16 2013 -0400

    Update to pax-linux-3.10.10-test25.patch:
    - fixed a few more REFCOUNT false positives, by Mathias Krause <minipli@googlemail.com>
    - got inet_getid and ipv6_select_ident rid of the cmpxchg loop

 block/blk-cgroup.c                |    4 ++--
 drivers/video/hyperv_fb.c         |    4 ++--
 fs/namespace.c                    |    4 ++--
 include/net/inetpeer.h            |   13 +++++--------
 kernel/trace/trace_clock.c        |    4 ++--
 net/ipv6/output_core.c            |   15 ++++++---------
 net/sunrpc/auth_gss/svcauth_gss.c |    4 ++--
 7 files changed, 21 insertions(+), 27 deletions(-)

commit 7ee3899312d611b85cadd3eda173f7a3952bb8aa
Merge: fd0338c 2bdeae7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 31 22:07:38 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit 2bdeae76eab5c34e4b88c7090a435b969037a3c1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 31 22:06:55 2013 -0400

    Update to pax-linux-3.10.10-test24.patch:
    - fixed a REFCOUNT false positive, by Mathias Krause <minipli@googlemail.com>
    - fixed a bunch more after a quick audit of atomic_inc_return users

 drivers/acpi/apei/ghes.c                      |    4 ++--
 drivers/ata/libata-core.c                     |    4 ++--
 drivers/ata/libata-scsi.c                     |    2 +-
 drivers/ata/libata.h                          |    2 +-
 drivers/block/drbd/drbd_nl.c                  |    4 ++--
 drivers/crypto/hifn_795x.c                    |    4 ++--
 drivers/edac/edac_device.c                    |    4 ++--
 drivers/edac/edac_pci.c                       |    4 ++--
 drivers/firewire/core-card.c                  |    4 ++--
 drivers/hv/hv_balloon.c                       |   18 +++++++++---------
 drivers/infiniband/hw/mlx4/mad.c              |    2 +-
 drivers/infiniband/hw/mlx4/mlx4_ib.h          |    2 +-
 drivers/input/misc/ims-pcu.c                  |    4 ++--
 drivers/input/serio/serio_raw.c               |    4 ++--
 drivers/media/pci/ivtv/ivtv-driver.c          |    2 +-
 drivers/media/radio/radio-maxiradio.c         |    2 +-
 drivers/media/radio/radio-shark.c             |    2 +-
 drivers/media/radio/radio-shark2.c            |    2 +-
 drivers/media/radio/radio-si476x.c            |    2 +-
 drivers/media/rc/rc-main.c                    |    4 ++--
 drivers/media/v4l2-core/v4l2-device.c         |    4 ++--
 drivers/net/usb/sierra_net.c                  |    4 ++--
 drivers/pci/hotplug/pciehp_hpc.c              |    4 +---
 drivers/regulator/core.c                      |    4 ++--
 drivers/scsi/fcoe/fcoe_sysfs.c                |   12 ++++++------
 drivers/staging/android/timed_output.c        |    6 +++---
 drivers/staging/media/solo6x10/solo6x10-p2m.c |    2 +-
 drivers/staging/media/solo6x10/solo6x10.h     |    2 +-
 drivers/target/sbp/sbp_target.c               |    4 ++--
 drivers/tty/hvc/hvsi.c                        |   12 ++++++------
 drivers/tty/hvc/hvsi_lib.c                    |    6 +++---
 drivers/tty/serial/ioc4_serial.c              |    6 +++---
 drivers/tty/serial/msm_serial.c               |    4 ++--
 drivers/usb/misc/appledisplay.c               |    4 ++--
 fs/afs/inode.c                                |    4 ++--
 fs/btrfs/delayed-inode.c                      |    6 +++---
 fs/btrfs/delayed-inode.h                      |    4 ++--
 fs/fscache/cookie.c                           |    4 ++--
 include/media/v4l2-device.h                   |    2 +-
 net/ceph/messenger.c                          |    4 ++--
 net/core/netpoll.c                            |    4 ++--
 net/xfrm/xfrm_state.c                         |    4 ++--
 security/selinux/avc.c                        |    6 +++---
 43 files changed, 93 insertions(+), 95 deletions(-)

commit fd0338c8877c47789a9cc61f3a26c83e68aa3d37
Merge: 1bdf7ec 85099d2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 31 21:07:29 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit 85099d220fb014b6e4c6ffe18a55b20c61f6daed
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 31 21:06:55 2013 -0400

    Update to pax-linux-3.10.10-test23.patch:
    - added the necessary atomic_unchecked_t conversion for mips
    - audited and fixed arm and sparc for proper atomic_unchecked_t usage

 arch/arm/kvm/arm.c            |    8 ++++----
 arch/arm/mm/context.c         |   10 +++++-----
 arch/mips/kernel/irq.c        |    6 +++---
 arch/mips/kernel/sync-r4k.c   |   24 ++++++++++++------------
 arch/mips/sgi-ip27/ip27-nmi.c |    6 +++---
 arch/sparc/kernel/smp_64.c    |   12 ++++++------
 arch/sparc/kernel/traps_64.c  |   14 +++++++-------
 arch/sparc/mm/init_64.c       |   10 +++++-----
 8 files changed, 45 insertions(+), 45 deletions(-)

commit 1bdf7ec39027ffd7c3099b78ff20c39295448b34
Merge: 995a168 38ee86c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Aug 30 19:23:36 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit 38ee86c05df0f8db582df8776b9f23f317d42bbb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Aug 30 19:23:11 2013 -0400

    Update to pax-linux-3.10.10-test22.patch:
    - fixed !REFCOUNT/mips compilation, by Corey Minyard <cminyard@mvista.com>
    - fixed a few more format strings

 arch/mips/include/asm/atomic.h          |   20 ++++++++++++++++----
 drivers/md/bcache/super.c               |    2 +-
 drivers/net/wireless/iwlwifi/dvm/main.c |    3 +--
 drivers/pci/hotplug/pciehp_hpc.c        |    2 +-
 drivers/platform/x86/wmi.c              |    2 +-
 drivers/scsi/sd.c                       |    2 +-
 drivers/vfio/vfio.c                     |    4 ++--
 fs/ntfs/super.c                         |    6 +++---
 include/linux/workqueue.h               |    6 +++---
 net/mac80211/main.c                     |    2 +-
 sound/pci/hda/hda_codec.c               |    8 ++------
 11 files changed, 32 insertions(+), 25 deletions(-)

commit 995a16841e2097c3a9dfc652e856469679c4a0ba
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Aug 30 17:11:11 2013 -0400

    fix compilation with GRKERNSEC_DENYUSB as reported by slashbeast

 grsecurity/grsec_sysctl.c |    7 ++++---
 1 files changed, 4 insertions(+), 3 deletions(-)

commit 8ba1cc35ec5216383369ddf3ef2cde5e4aaacb57
Merge: be2497c 1052971
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 29 20:44:29 2013 -0400

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	include/linux/sched.h

commit 10529710192fe7f7d42ad7bb1dfef2143cca8ad2
Merge: e902dad 8bf3379
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 29 20:39:50 2013 -0400

    Update to pax-linux-3.10.10-test21.patch
    
    Merge branch 'linux-3.10.y' into pax-test
    
    Conflicts:
    	arch/x86/kernel/sys_x86_64.c
    	arch/x86/mm/mmap.c
    	include/linux/sched.h

commit be2497c1b629a5ad604a8b0ec265ef5d801c7de8
Merge: 081c22b e902dad
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Aug 28 20:52:44 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit e902dad6b609a176f58c1b9393b3a98f14bd4b74
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Aug 28 20:51:21 2013 -0400

    Update to pax-linux-3.10.9-test21.patch:
    - removed unnecessary type cast in do_PrefetchAbort, noticed by spender
    - since pax_report_refcount_overflow disables preemption inside, no need to do it explicitly in do_ov
    - fixed a REFCOUNT false positive in UHID
    - inspired by Dan Carpenter's recent fix (http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=909bd5926d474e275599094acad986af79671ac9)
      Emese Revfy wrote a gcc plugin to find other instances of the same error, here's the fallout
      (come to the 10th H2HC if you want to learn about the magic behind this and other plugins):
      - icmpv6_filter: no memory corruption, probably just some logical error in the caller
      - dccp_new/dccp_packet/dccp_error: probably remote kernel stack overflow (12 byte network data overwriting a local ptr variable)
      - gigaset_brkchars: causes DMA on the kernel stack, some archs don't like it (more of this is to come)
      - isdn_ioctl/IIOCDBGVAR: kernel heap address leak (by design), restricted to CAP_SYS_RAWIO now
      - __dwc3_gadget_ep_enable: probably forgotten memset, seems harmless
      - lowpan_header_create: leaks 3 bytes of a kernel heap address over the network

 arch/arm/mm/fault.c                        |    2 +-
 arch/mips/kernel/traps.c                   |    2 --
 drivers/hid/uhid.c                         |    6 +++---
 drivers/isdn/gigaset/usb-gigaset.c         |    2 +-
 drivers/isdn/i4l/isdn_common.c             |    2 ++
 drivers/net/wireless/hostap/hostap_ioctl.c |    4 ++--
 drivers/usb/dwc3/gadget.c                  |    2 --
 net/ieee802154/6lowpan.c                   |    2 +-
 net/ipv6/raw.c                             |    2 +-
 net/netfilter/nf_conntrack_proto_dccp.c    |    6 +++---
 10 files changed, 14 insertions(+), 16 deletions(-)

commit 081c22b436d4d4ac8c9ef7c3f3b9587cfb02d804
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Aug 28 20:42:39 2013 -0400

    add export of gr_handle_new_usb()

 grsecurity/grsec_usb.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 2e708ca9984ef74536d1d9b1d4e6e73d27561ed6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Aug 28 19:24:47 2013 -0400

    Add new GRKERNSEC_DENYUSB feature that I've been sitting on for a bit
    Kees' recent findings are motivation enough to publish it

 drivers/usb/core/hub.c     |    5 +++++
 grsecurity/Kconfig         |   20 ++++++++++++++++++++
 grsecurity/Makefile        |    3 ++-
 grsecurity/grsec_init.c    |    1 +
 grsecurity/grsec_sysctl.c  |   11 +++++++++++
 grsecurity/grsec_usb.c     |   13 +++++++++++++
 include/linux/grinternal.h |    1 +
 include/linux/grsecurity.h |    2 ++
 8 files changed, 55 insertions(+), 1 deletions(-)

commit 8044382257ec75a03f3d784ce048ef14e94b90ca
Author: Kees Cook <keescook@chromium.org>
Date:   Wed Aug 14 09:35:07 2013 -0700

    HID: zeroplus: validate output report details
    
    The zeroplus HID driver was not checking the size of allocated values
    in fields it used. A HID device could send a malicious output report
    that would cause the driver to write beyond the output report allocation
    during initialization, causing a heap overflow:
    
    [ 1442.728680] usb 1-1: New USB device found, idVendor=0c12, idProduct=0005
    ...
    [ 1466.243173] BUG kmalloc-192 (Tainted: G        W   ): Redzone overwritten
    
    CVE-2013-2889
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Cc: stable@kernel.org

 drivers/hid/hid-zpff.c |   14 ++------------
 1 files changed, 2 insertions(+), 12 deletions(-)

commit 1ead832874dde8c45c3d4c8c704f2cd7ad6a328f
Author: Kees Cook <keescook@chromium.org>
Date:   Wed Aug 14 14:36:15 2013 -0700

    HID: provide a helper for validating hid reports
    
    Many drivers need to validate the characteristics of their HID report
    during initialization to avoid misusing the reports. This adds a common
    helper to perform validation of the report, its field count, and the
    value count within the fields.
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Cc: stable@kernel.org

 drivers/hid/hid-core.c |   50 ++++++++++++++++++++++++++++++++++++++++++++++++
 include/linux/hid.h    |    4 +++
 2 files changed, 54 insertions(+), 0 deletions(-)

commit 270ba9096ddecdc3cf6c4d76e6892184820116be
Author: Kees Cook <keescook@chromium.org>
Date:   Wed Aug 14 09:14:34 2013 -0700

    HID: steelseries: validate output report details
    
    A HID device could send a malicious output report that would cause the
    steelseries HID driver to write beyond the output report allocation
    during initialization, causing a heap overflow:
    
    [  167.981534] usb 1-1: New USB device found, idVendor=1038, idProduct=1410
    ...
    [  182.050547] BUG kmalloc-256 (Tainted: G        W   ): Redzone overwritten
    
    CVE-2013-2891
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Cc: stable@kernel.org

 drivers/hid/hid-steelseries.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

commit 366e6cf394366e4bb2598e5d3763c6ca53fb7248
Author: Kees Cook <keescook@chromium.org>
Date:   Wed Aug 14 08:49:21 2013 -0700

    HID: pantherlord: validate output report details
    
    A HID device could send a malicious output report that would cause the
    pantherlord HID driver to write beyond the output report allocation
    during initialization, causing a heap overflow:
    
    [  310.939483] usb 1-1: New USB device found, idVendor=0e8f, idProduct=0003
    ...
    [  315.980774] BUG kmalloc-192 (Tainted: G        W   ): Redzone overwritten
    
    CVE-2013-2892
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Cc: stable@kernel.org

 drivers/hid/hid-pl.c |   10 ++++++++--
 1 files changed, 8 insertions(+), 2 deletions(-)

commit 60115e8108e508060815bce5ef9504233c81898c
Author: Kees Cook <keescook@chromium.org>
Date:   Tue Aug 13 16:49:01 2013 -0700

    HID: LG: validate HID output report details
    
    A HID device could send a malicious output report that would cause the
    lg, lg3, and lg4 HID drivers to write beyond the output report allocation
    during an event, causing a heap overflow:
    
    [  325.245240] usb 1-1: New USB device found, idVendor=046d, idProduct=c287
    ...
    [  414.518960] BUG kmalloc-4096 (Not tainted): Redzone overwritten
    
    Additionally, while lg2 did correctly validate the report details, it was
    cleaned up and shortened.
    
    CVE-2013-2893
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Cc: stable@kernel.org

 drivers/hid/hid-lg2ff.c |   19 +++----------------
 drivers/hid/hid-lg3ff.c |   29 ++++++-----------------------
 drivers/hid/hid-lg4ff.c |   20 +-------------------
 drivers/hid/hid-lgff.c  |   17 ++---------------
 4 files changed, 12 insertions(+), 73 deletions(-)

commit 1814f6ffbd0d5feccce1f03e8cc17882528e8a9f
Author: Kees Cook <keescook@chromium.org>
Date:   Thu Aug 15 23:21:23 2013 -0700

    HID: lenovo-tpkbd: validate output report details
    
    A HID device could send a malicious output report that would cause the
    lenovo-tpkbd HID driver to write just beyond the output report allocation
    during initialization, causing a heap overflow:
    
    [   76.109807] usb 1-1: New USB device found, idVendor=17ef, idProduct=6009
    ...
    [   80.462540] BUG kmalloc-192 (Tainted: G        W   ): Redzone overwritten
    
    CVE-2013-2894
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Cc: stable@kernel.org

 drivers/hid/hid-lenovo-tpkbd.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

commit 38627769bb2b9a550e251b2caf1babda7566fb4a
Author: Kees Cook <keescook@chromium.org>
Date:   Thu Aug 15 23:45:03 2013 -0700

    HID: logitech-dj: validate output report details
    
    A HID device could send a malicious output report that would cause the
    logitech-dj HID driver to leak kernel memory contents to the device, or
    trigger a NULL dereference during initialization:
    
    [  304.424553] usb 1-1: New USB device found, idVendor=046d, idProduct=c52b
    ...
    [  304.780467] BUG: unable to handle kernel NULL pointer dereference at 0000000000000028
    [  304.781409] IP: [<ffffffff815d50aa>] logi_dj_recv_send_report.isra.11+0x1a/0x90
    
    CVE-2013-2895
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Cc: stable@kernel.org

 drivers/hid/hid-logitech-dj.c |   12 ++++++++++--
 1 files changed, 10 insertions(+), 2 deletions(-)

commit db334388c9d3f95aeb6aacdcec72169b6edd6f07
Author: Kees Cook <keescook@chromium.org>
Date:   Fri Aug 16 00:18:15 2013 -0700

    HID: ntrig: validate feature report details
    
    A HID device could send a malicious feature report that would cause the
    ntrig HID driver to trigger a NULL dereference during initialization:
    
    [57383.031190] usb 3-1: New USB device found, idVendor=1b96, idProduct=0001
    ...
    [57383.315193] BUG: unable to handle kernel NULL pointer dereference at 0000000000000030
    [57383.315308] IP: [<ffffffffa08102de>] ntrig_probe+0x25e/0x420 [hid_ntrig]
    
    CVE-2013-2896
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Cc: stable@kernel.org

 drivers/hid/hid-ntrig.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 86adcfe96ceefd7d64593a493abe07c155bb8f88
Author: Kees Cook <keescook@chromium.org>
Date:   Fri Aug 16 00:11:32 2013 -0700

    HID: multitouch: validate feature report details
    
    When working on report indexes, always validate that they are in bounds.
    Without this, a HID device could report a malicious feature report that
    could trick the driver into a heap overflow:
    
    [  634.885003] usb 1-1: New USB device found, idVendor=0596, idProduct=0500
    ...
    [  676.469629] BUG kmalloc-192 (Tainted: G        W   ): Redzone overwritten
    
    CVE-2013-2897
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Cc: stable@kernel.org

 drivers/hid/hid-multitouch.c |   25 ++++++++++++++++++++-----
 1 files changed, 20 insertions(+), 5 deletions(-)

commit 813f51e0881e4ea6d221da828b1cced02ad9694d
Author: Kees Cook <keescook@chromium.org>
Date:   Fri Aug 16 08:12:45 2013 -0700

    HID: sensor-hub: validate feature report details
    
    A HID device could send a malicious feature report that would cause the
    sensor-hub HID driver to read past the end of heap allocation, leaking
    kernel memory contents to the caller.
    
    CVE-2013-2898
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Cc: stable@kernel.org

 drivers/hid/hid-sensor-hub.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 6ed7d602e322c67adcfa3ebe79ca2c4a3376330c
Author: Kees Cook <keescook@chromium.org>
Date:   Fri Aug 16 08:05:10 2013 -0700

    HID: picolcd_core: validate output report details
    
    A HID device could send a malicious output report that would cause the
    picolcd HID driver to trigger a NULL dereference during attr file writing.
    
    CVE-2013-2899
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Cc: stable@kernel.org

 drivers/hid/hid-picolcd_core.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 95e3cfb5a995dabe45b98cafb77e59d074de151f
Author: Kees Cook <keescook@chromium.org>
Date:   Fri Aug 16 08:09:54 2013 -0700

    HID: check for NULL field when setting values
    
    Defensively check that the field to be worked on is not NULL.
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Cc: stable@kernel.org

 drivers/hid/hid-core.c |    7 ++++++-
 1 files changed, 6 insertions(+), 1 deletions(-)

commit 96a55ce1b2f3af376c400a02059174e79ce4399c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Aug 28 18:09:18 2013 -0400

    http://marc.info/?l=linux-input&m=137772180514608&q=raw
    
    From: Kees Cook <keescook@chromium.org>
    
    The "Report ID" field of a HID report is used to build indexes of
    reports. The kernel's index of these is limited to 256 entries, so any
    malicious device that sets a Report ID greater than 255 will trigger
    memory corruption on the host:
    
    [ 1347.156239] BUG: unable to handle kernel paging request at ffff88094958a878
    [ 1347.156261] IP: [<ffffffff813e4da0>] hid_register_report+0x2a/0x8b
    
    CVE-2013-2888
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Cc: stable@kernel.org
    ---
     drivers/hid/hid-core.c |   10 +++++++---
     include/linux/hid.h    |    4 +++-
     2 files changed, 10 insertions(+), 4 deletions(-)

 drivers/hid/hid-core.c |   10 +++++++---
 include/linux/hid.h    |    4 +++-
 2 files changed, 10 insertions(+), 4 deletions(-)

commit eb1106eef5f17bfda833ca3cf89e315919173257
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Fri Aug 9 12:52:31 2013 +0300

    Upstream commit: 909bd5926d474e275599094acad986af79671ac9
    
    Hostap: copying wrong data prism2_ioctl_giwaplist()
    
    We want the data stored in "addr" and "qual", but the extra ampersands
    mean we are copying stack data instead.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

 drivers/net/wireless/hostap/hostap_ioctl.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit b12fdddbc01b0d855dd56fa6fea6b4100aae7af4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Aug 28 17:01:21 2013 -0400

    fix typo in ipv6 backport

 net/ipv6/addrconf.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit b42367d45ce67de82c38c5c7cb6f4cf521cca2f4
Author: Andy Lutomirski <luto@amacapital.net>
Date:   Thu Aug 22 11:39:15 2013 -0700

    Upstream commit: d661684cf6820331feae71146c35da83d794467e
    
    net: Check the correct namespace when spoofing pid over SCM_RIGHTS
    
    This is a security bug.
    
    The follow-up will fix nsproxy to discourage this type of issue from
    happening again.
    
    Cc: stable@vger.kernel.org
    Signed-off-by: Andy Lutomirski <luto@amacapital.net>
    Reviewed-by: "Eric W. Biederman" <ebiederm@xmission.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/core/scm.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 10b2e7e1f75d1da2e0bbe0bff04233ea2ec1bed9
Author: Hannes Frederic Sowa <hannes@stressinduktion.org>
Date:   Fri Aug 16 13:02:27 2013 +0200

    Upstream commit: 4b08a8f1bd8cb4541c93ec170027b4d0782dab52
    
    ipv6: remove max_addresses check from ipv6_create_tempaddr
    
    Because of the max_addresses check attackers were able to disable privacy
    extensions on an interface by creating enough autoconfigured addresses:
    
    <http://seclists.org/oss-sec/2012/q4/292>
    
    But the check is not actually needed: max_addresses protects the
    kernel to install too many ipv6 addresses on an interface and guards
    addrconf_prefix_rcv to install further addresses as soon as this limit
    is reached. We only generate temporary addresses in direct response of
    a new address showing up. As soon as we filled up the maximum number of
    addresses of an interface, we stop installing more addresses and thus
    also stop generating more temp addresses.
    
    Even if the attacker tries to generate a lot of temporary addresses
    by announcing a prefix and removing it again (lifetime == 0) we won't
    install more temp addresses, because the temporary addresses do count
    to the maximum number of addresses, thus we would stop installing new
    autoconfigured addresses when the limit is reached.
    
    This patch fixes CVE-2013-0343 (but other layer-2 attacks are still
    possible).
    
    Thanks to Ding Tianhong to bring this topic up again.
    
    Cc: Ding Tianhong <dingtianhong@huawei.com>
    Cc: George Kargiotakis <kargig@void.gr>
    Cc: P J P <ppandit@redhat.com>
    Cc: YOSHIFUJI Hideaki <yoshfuji@linux-ipv6.org>
    Signed-off-by: Hannes Frederic Sowa <hannes@stressinduktion.org>
    Acked-by: Ding Tianhong <dingtianhong@huawei.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    Conflicts:
    
    	net/ipv6/addrconf.c

 net/ipv6/addrconf.c |   10 ++++------
 1 files changed, 4 insertions(+), 6 deletions(-)

commit 8333e0981469a226a47d0142ff31090a48db95a4
Author: David Vrabel <david.vrabel@citrix.com>
Date:   Thu Aug 15 13:21:06 2013 +0100

    Upstream commit: 84ca7a8e45dafb49cd5ca90a343ba033e2885c17
    
    xen/events: initialize local per-cpu mask for all possible events
    
    The sizeof() argument in init_evtchn_cpu_bindings() is incorrect
    resulting in only the first 64 (or 32 in 32-bit guests) ports having
    their bindings being initialized to VCPU 0.
    
    In most cases this does not cause a problem as request_irq() will set
    the irq affinity which will set the correct local per-cpu mask.
    However, if the request_irq() is called on a VCPU other than 0, there
    is a window between the unmasking of the event and the affinity being
    set were an event may be lost because it is not locally unmasked on
    any VCPU. If request_irq() is called on VCPU 0 then local irqs are
    disabled during the window and the race does not occur.
    
    Fix this by initializing all NR_EVENT_CHANNEL bits in the local
    per-cpu masks.
    
    Signed-off-by: David Vrabel <david.vrabel@citrix.com>
    Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
    CC: stable@vger.kernel.org

 drivers/xen/events.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 2a9a83768433937a2b7a97001ba1627156c0efed
Author: Roland Dreier <roland@purestorage.com>
Date:   Mon Aug 5 17:55:01 2013 -0700

    Upstream commit: 35dc248383bbab0a7203fca4d722875bc81ef091
    
    [SCSI] sg: Fix user memory corruption when SG_IO is interrupted by a signal
    
    There is a nasty bug in the SCSI SG_IO ioctl that in some circumstances
    leads to one process writing data into the address space of some other
    random unrelated process if the ioctl is interrupted by a signal.
    What happens is the following:
    
     - A process issues an SG_IO ioctl with direction DXFER_FROM_DEV (ie the
       underlying SCSI command will transfer data from the SCSI device to
       the buffer provided in the ioctl)
    
     - Before the command finishes, a signal is sent to the process waiting
       in the ioctl.  This will end up waking up the sg_ioctl() code:
    
    		result = wait_event_interruptible(sfp->read_wait,
    			(srp_done(sfp, srp) || sdp->detached));
    
       but neither srp_done() nor sdp->detached is true, so we end up just
       setting srp->orphan and returning to userspace:
    
    		srp->orphan = 1;
    		write_unlock_irq(&sfp->rq_list_lock);
    		return result;	/* -ERESTARTSYS because signal hit process */
    
       At this point the original process is done with the ioctl and
       blithely goes ahead handling the signal, reissuing the ioctl, etc.
    
     - Eventually, the SCSI command issued by the first ioctl finishes and
       ends up in sg_rq_end_io().  At the end of that function, we run through:
    
    	write_lock_irqsave(&sfp->rq_list_lock, iflags);
    	if (unlikely(srp->orphan)) {
    		if (sfp->keep_orphan)
    			srp->sg_io_owned = 0;
    		else
    			done = 0;
    	}
    	srp->done = done;
    	write_unlock_irqrestore(&sfp->rq_list_lock, iflags);
    
    	if (likely(done)) {
    		/* Now wake up any sg_read() that is waiting for this
    		 * packet.
    		 */
    		wake_up_interruptible(&sfp->read_wait);
    		kill_fasync(&sfp->async_qp, SIGPOLL, POLL_IN);
    		kref_put(&sfp->f_ref, sg_remove_sfp);
    	} else {
    		INIT_WORK(&srp->ew.work, sg_rq_end_io_usercontext);
    		schedule_work(&srp->ew.work);
    	}
    
       Since srp->orphan *is* set, we set done to 0 (assuming the
       userspace app has not set keep_orphan via an SG_SET_KEEP_ORPHAN
       ioctl), and therefore we end up scheduling sg_rq_end_io_usercontext()
       to run in a workqueue.
    
     - In workqueue context we go through sg_rq_end_io_usercontext() ->
       sg_finish_rem_req() -> blk_rq_unmap_user() -> ... ->
       bio_uncopy_user() -> __bio_copy_iov() -> copy_to_user().
    
       The key point here is that we are doing copy_to_user() on a
       workqueue -- that is, we're on a kernel thread with current->mm
       equal to whatever random previous user process was scheduled before
       this kernel thread.  So we end up copying whatever data the SCSI
       command returned to the virtual address of the buffer passed into
       the original ioctl, but it's quite likely we do this copying into a
       different address space!
    
    As suggested by James Bottomley <James.Bottomley@hansenpartnership.com>,
    add a check for current->mm (which is NULL if we're on a kernel thread
    without a real userspace address space) in bio_uncopy_user(), and skip
    the copy if we're on a kernel thread.
    
    There's no reason that I can think of for any caller of bio_uncopy_user()
    to want to do copying on a kernel thread with a random active userspace
    address space.
    
    Huge thanks to Costa Sapuntzakis <costa@purestorage.com> for the
    original pointer to this bug in the sg code.
    
    Signed-off-by: Roland Dreier <roland@purestorage.com>
    Tested-by: David Milburn <dmilburn@redhat.com>
    Cc: Jens Axboe <axboe@kernel.dk>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: James Bottomley <JBottomley@Parallels.com>

 fs/bio.c |   20 +++++++++++++++-----
 1 files changed, 15 insertions(+), 5 deletions(-)

commit e6fe57dee152671afd618d6bc8cbf23155be6c34
Merge: cdc8f7d f2095a4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Aug 27 18:13:35 2013 -0400

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	arch/arm/mm/fault.c
    	security/Kconfig

commit f2095a4787f7d332e5919f0bd00f8de6021ad612
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Aug 27 18:08:23 2013 -0400

    Update to pax-linux-3.10.9-test20.patch:
    - removed unnecessary mark_sym_for_renaming calls from the gcc plugins, reported by Emese Revfy
    - made some KERNEXEC/UDEREF induced fault handling on arm more robust (IFAR isn't always set on v7), by Corey Minyard <cminyard@mvista.com>
    - converted some mips atomic accessor macros to functions in preparation of REFCOUNT support, by Corey Minyard <cminyard@mvista.com>
    - __copy_from_user_inatomic on amd64 will now return unsigned long like other userland accessors do
    - added REFCOUNT support for mips, by Corey Minyard <cminyard@mvista.com>
    - fixed arm compilation with UDEREF disabled, reported by fabled (http://forums.grsecurity.net/viewtopic.php?f=1&t=3720)
    - fixed early boot panic due to a INVCPID/PCID mismatch, reported by Patrick McLean (https://bugs.gentoo.org/show_bug.cgi?id=482010)

 arch/arm/mm/fault.c               |   11 +-
 arch/mips/include/asm/atomic.h    |  722 +++++++++++++++++++++++++++++++++++--
 arch/mips/kernel/traps.c          |   14 +-
 arch/x86/include/asm/tlbflush.h   |    4 +
 arch/x86/include/asm/uaccess_64.h |    2 +-
 fs/ntfs/file.c                    |    2 +-
 kernel/events/internal.h          |    4 +-
 kernel/events/uprobes.c           |    2 +-
 kernel/futex.c                    |    2 +-
 mm/filemap.c                      |    8 +-
 security/Kconfig                  |    2 +-
 tools/gcc/kernexec_plugin.c       |   18 +-
 tools/gcc/latent_entropy_plugin.c |   26 +-
 tools/gcc/size_overflow_plugin.c  |    3 +-
 14 files changed, 750 insertions(+), 70 deletions(-)

commit cdc8f7d7a0d09f5ccec1717d1378ac284b5bb4e9
Merge: 5a9ae57 745975e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 26 20:27:33 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit 745975e3b3b74b64e00e85778f9a22714d1274f2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 26 20:26:33 2013 -0400

    Fix compilation when UDEREF is enabled and KERNEXEC is disabled,
    as reported by fabled on the forums:
    http://forums.grsecurity.net/viewtopic.php?f=1&t=3720

 arch/arm/include/asm/pgtable.h |    4 +---
 1 files changed, 1 insertions(+), 3 deletions(-)

commit 5a9ae577def10802fc8ad6957f05ce2a180dfa36
Merge: 486ec00 f68df21
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Aug 20 20:15:20 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit f68df215c8bf7fada2710c14b3f3a0ea53fd9e43
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Aug 20 20:14:50 2013 -0400

    Update to pax-linux-3.10.9-test18.patch:
    - fixed missing export of cpu_pgd, reported by Alexander Tsoy (https://bugs.gentoo.org/show_bug.cgi?id=481786)
    - fixed UDEREF regression on !PCID processors, reported by Alexander Tsoy (https://bugs.gentoo.org/show_bug.cgi?id=481790)
    - forward port to 3.10.9

 arch/x86/kernel/entry_64.S       |   18 +++++++++---------
 arch/x86/kernel/i386_ksyms_32.c  |    4 ++++
 arch/x86/kernel/x8664_ksyms_64.c |    4 ++++
 3 files changed, 17 insertions(+), 9 deletions(-)

commit 486ec00945b5dd8826f625e4af8995c5c8cb2a6f
Merge: f47a293 d8fed0e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Aug 20 20:12:47 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit d8fed0eba89a7607afe296c0caf17bc72311d6e9
Merge: f6ace8e 0a4b6d4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Aug 20 20:12:33 2013 -0400

    Merge branch 'linux-3.10.y' into pax-test

commit f47a293a1440da2a3e2c239d43d636e37ca74f10
Merge: f1e8ec7 f6ace8e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Aug 20 18:20:05 2013 -0400

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	arch/arm/kernel/perf_event.c
    	include/linux/sched.h

commit f6ace8e1804aadc296bec38b4c4a2d711b9e7c72
Merge: b4fa847 6f54059
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Aug 20 18:18:02 2013 -0400

    Update to pax-linux-3.10.8-test18.patch
    
    Merge branch 'linux-3.10.y' into pax-test
    
    Conflicts:
    	arch/x86/kernel/sys_x86_64.c
    	arch/x86/mm/mmap.c
    	include/linux/sched.h

commit f1e8ec79b6019ca0aa6a6cdde5668c1bbd9f51ca
Merge: 6f88011 b4fa847
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Aug 20 18:05:12 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit b4fa84790ec760430818ab9b74a8b5acc6b40e63
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Aug 20 18:04:14 2013 -0400

    Update to pax-linux-3.10.7-test18.patch:
    - reverted constification of zcache, problem reported by Marcin MirosÅ‚aw (https://bugs.gentoo.org/show_bug.cgi?id=481752)
    - fixed a UDEREF resume regression due to the constification of clone_pgd_mask
    - fixed suspend/resume regression due to the recent constification of mmu_cr4_features, reported by Mathias Krause

 arch/arm/kernel/process.c        |    2 +-
 arch/x86/include/asm/processor.h |   25 ++-----------------------
 arch/x86/kernel/cpu/common.c     |    4 ++++
 arch/x86/kernel/setup.c          |   36 ++++++++++++++++++++++++++++++++++++
 drivers/staging/zcache/tmem.c    |    4 ++--
 drivers/staging/zcache/tmem.h    |    6 ++----
 6 files changed, 47 insertions(+), 30 deletions(-)

commit 6f88011297cb3b1b79ff4d96f8a9b8e2ed5a025f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 19 22:10:04 2013 -0400

    fix bad git merge (call to __cpu_disable_lazy_restore was duplicated)
    as reported by pipacs

 arch/x86/kernel/smpboot.c |    3 ---
 1 files changed, 0 insertions(+), 3 deletions(-)

commit 07f718e061bc4696b64a98ac1cf56e9ca1275dc3
Merge: 6eba999 5de93c8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 18 22:03:19 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit 5de93c8e2a86865f7a2d62dbcf8702dbf12494db
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 18 22:02:47 2013 -0400

    Update to pax-linux-3.10.7-test15.patch:
    - fixed more PCID fallout, reported by spender, Negres and GBit (http://forums.grsecurity.net/viewtopic.php?f=3&t=3705)
    - fixed some new REFCOUNT false positives, caught by inspection

 arch/x86/kernel/cpu/common.c |    5 +++--
 arch/x86/kernel/entry_64.S   |   11 +++++++----
 fs/ceph/super.c              |    4 ++--
 mm/backing-dev.c             |    4 ++--
 4 files changed, 14 insertions(+), 10 deletions(-)

commit 94c119587c76723c1072237b98fff9886ccb7689
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 18 20:49:39 2013 -0400

    fix pipacs' DEMORGAN typo

 arch/x86/include/asm/tlbflush.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 6eba999a3263c2ed3f7e87222a5c9c55315c7f00
Merge: df347f6 64a293e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 18 18:13:04 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit 64a293ebd17bf4a7ce6bd921ed879673e79fe128
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 18 18:12:37 2013 -0400

    Update to pax-linux-3.10.7-test14.patch:
    - fixed compile error introduced by the previous PCID change
    - fixed timer_create kernel stack leak, reported by Roman Å½ilka (https://bugs.gentoo.org/show_bug.cgi?id=470214)

 arch/x86/include/asm/tlbflush.h |    2 +-
 kernel/posix-timers.c           |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

commit df347f6db6cc0aaa40406d8a8b7284b7c15bc685
Merge: d8efbc5 e11b314
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 18 08:15:00 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit e11b314734c5b7317f5468be75305ad812e78c2b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 18 08:14:26 2013 -0400

    Update to pax-linux-3.10.7-test13.patch:
    - always enable the use of PCID and INVPCID when available in the CPU
      - kvm guest kernels can use these features even if the host kernel lacks UDEREF

 arch/x86/include/asm/tlbflush.h |   69 ++++++++++++++++++++++----------------
 arch/x86/kernel/cpu/common.c    |   48 +++++++++++++++++----------
 2 files changed, 70 insertions(+), 47 deletions(-)

commit d8efbc54f5c8aba589d4d12eed9257a754a67de8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 17 12:00:20 2013 -0400

    make kallsyms_lookup_size_offset available to approved source files

 include/linux/kallsyms.h |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit 6c8feffa95ce2db280160015027b52bb41a344c8
Merge: dbf6930 0bb1c2b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 17 11:57:50 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit 0bb1c2b2d9ba9a15fb504d47270499e8e2764106
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 17 11:56:43 2013 -0400

    Update to pax-linux-3.10.7-test12.patch:
    - fixed superfluous initializer in __native_flush_tlb_single, reported by Mathias Krause
    - fixed some arm compile problems

 arch/x86/include/asm/tlbflush.h      |    2 +-
 drivers/clocksource/bcm_kona_timer.c |    2 +-
 kernel/signal.c                      |    4 ++++
 3 files changed, 6 insertions(+), 2 deletions(-)

commit dbf69305ad4f8a037aae95af90f9201f556dcb48
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 17 11:18:09 2013 -0400

    allow use of kallsyms_lookup_name to approved source files

 include/linux/kallsyms.h |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit a566c5f4dec33f410678c257e95ab6726ce8e4f9
Merge: 68bd16f f562e3e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 17 10:35:02 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit f562e3ef7737ea8d80431a722479b36a12504ace
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 17 10:34:51 2013 -0400

    add uderef_64.c

 arch/x86/mm/uderef_64.c |   37 +++++++++++++++++++++++++++++++++++++
 1 files changed, 37 insertions(+), 0 deletions(-)

commit 68bd16fce3cf51c4c407e2ac6bc3db0629783622
Author: Asbjoern Sloth Toennesen <ast@fiberby.net>
Date:   Mon Aug 12 16:30:09 2013 +0000

    Upstream commit: 3e805ad288c524bb65aad3f1e004402223d3d504
    
    rtnetlink: rtnl_bridge_getlink: Call nlmsg_find_attr() with ifinfomsg header
    
    Fix the iproute2 command `bridge vlan show`, after switching from
    rtgenmsg to ifinfomsg.
    
    Let's start with a little history:
    
    Feb 20:   Vlad Yasevich got his VLAN-aware bridge patchset included in
              the 3.9 merge window.
              In the kernel commit 6cbdceeb, he added attribute support to
              bridge GETLINK requests sent with rtgenmsg.
    
    Mar 6th:  Vlad got this iproute2 reference implementation of the bridge
              vlan netlink interface accepted (iproute2 9eff0e5c)
    
    Apr 25th: iproute2 switched from using rtgenmsg to ifinfomsg (63338dca)
              http://patchwork.ozlabs.org/patch/239602/
              http://marc.info/?t=136680900700007
    
    Apr 28th: Linus released 3.9
    
    Apr 30th: Stephen released iproute2 3.9.0
    
    The `bridge vlan show` command haven't been working since the switch to
    ifinfomsg, or in a released version of iproute2. Since the kernel side
    only supports rtgenmsg, which iproute2 switched away from just prior to
    the iproute2 3.9.0 release.
    
    I haven't been able to find any documentation, about neither rtgenmsg
    nor ifinfomsg, and in which situation to use which, but kernel commit
    88c5b5ce seams to suggest that ifinfomsg should be used.
    
    Fixing this in kernel will break compatibility, but I doubt that anybody
    have been using it due to this bug in the user space reference
    implementation, at least not without noticing this bug. That said the
    functionality is still fully functional in 3.9, when reversing iproute2
    commit 63338dca.
    
    This could also be fixed in iproute2, but thats an ugly patch that would
    reintroduce rtgenmsg in iproute2, and from searching in netdev it seams
    like rtgenmsg usage is discouraged. I'm assuming that the only reason
    that Vlad implemented the kernel side to use rtgenmsg, was because
    iproute2 was using it at the time.
    
    Signed-off-by: Asbjoern Sloth Toennesen <ast@fiberby.net>
    Reviewed-by: Vlad Yasevich <vyasevich@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/core/rtnetlink.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 8c7bc5bafddddff55ed4687203a977e96f72540a
Author: Johannes Berg <johannes.berg@intel.com>
Date:   Tue Aug 13 09:04:05 2013 +0200

    Upstream commit: 58ad436fcf49810aa006016107f494c9ac9013db
    
    genetlink: fix family dump race
    
    When dumping generic netlink families, only the first dump call
    is locked with genl_lock(), which protects the list of families,
    and thus subsequent calls can access the data without locking,
    racing against family addition/removal. This can cause a crash.
    Fix it - the locking needs to be conditional because the first
    time around it's already locked.
    
    A similar bug was reported to me on an old kernel (3.4.47) but
    the exact scenario that happened there is no longer possible,
    on those kernels the first round wasn't locked either. Looking
    at the current code I found the race described above, which had
    also existed on the old kernel.
    
    Cc: stable@vger.kernel.org
    Reported-by: Andrei Otcheretianski <andrei.otcheretianski@intel.com>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/netlink/genetlink.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

commit 0aef405c4f269d1e35abb5393cee4e7d452ed4bb
Author: Daniel Borkmann <dborkman@redhat.com>
Date:   Fri Aug 9 16:25:21 2013 +0200

    Upstream commit: 771085d6bf3c52de29fc213e5bad07a82e57c23e
    
    net: sctp: sctp_transport_destroy{, _rcu}: fix potential pointer corruption
    
    Probably this one is quite unlikely to be triggered, but it's more safe
    to do the call_rcu() at the end after we have dropped the reference on
    the asoc and freed sctp packet chunks. The reason why is because in
    sctp_transport_destroy_rcu() the transport is being kfree()'d, and if
    we're unlucky enough we could run into corrupted pointers. Probably
    that's more of theoretical nature, but it's safer to have this simple fix.
    
    Introduced by commit 8c98653f ("sctp: sctp_close: fix release of bindings
    for deferred call_rcu's"). I also did the 8c98653f regression test and
    it's fine that way.
    
    Signed-off-by: Daniel Borkmann <dborkman@redhat.com>
    Acked-by: Vlad Yasevich <vyasevich@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/sctp/transport.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 3925eab5483946fd746575a46f97bee9d566bb77
Author: Stephane Grosjean <s.grosjean@peak-system.com>
Date:   Fri Aug 9 11:44:06 2013 +0200

    Upstream commit: 3c322a56b01695df15c70bfdc2d02e0ccd80654e
    
    can: pcan_usb: fix wrong memcpy() bytes length
    
    Fix possibly wrong memcpy() bytes length since some CAN records received from
    PCAN-USB could define a DLC field in range [9..15].
    In that case, the real DLC value MUST be used to move forward the record pointer
    but, only 8 bytes max. MUST be copied into the data field of the struct
    can_frame object of the skb given to the network core.
    
    Cc: linux-stable <stable@vger.kernel.org>
    Signed-off-by: Stephane Grosjean <s.grosjean@peak-system.com>
    Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/can/usb/peak_usb/pcan_usb.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit c1ac6642baae4a400d1f87115024d1bb1ef53598
Author: Linus Lüssing <linus.luessing@web.de>
Date:   Tue Aug 6 20:21:15 2013 +0200

    Upstream commit: 9d2c9488cedb666bc8206fbdcdc1575e0fbc5929
    
    batman-adv: fix potential kernel paging errors for unicast transmissions
    
    There are several functions which might reallocate skb data. Currently
    some places keep reusing their old ethhdr pointer regardless of whether
    they became invalid after such a reallocation or not. This potentially
    leads to kernel paging errors.
    
    This patch fixes these by refetching the ethdr pointer after the
    potential reallocations.
    
    Signed-off-by: Linus Lüssing <linus.luessing@web.de>
    Signed-off-by: Marek Lindner <lindner_marek@yahoo.de>
    Signed-off-by: Antonio Quartulli <ordex@autistici.org>

 net/batman-adv/bridge_loop_avoidance.c |    2 ++
 net/batman-adv/gateway_client.c        |   13 ++++++++++++-
 net/batman-adv/gateway_client.h        |    3 +--
 net/batman-adv/soft-interface.c        |    9 ++++++++-
 net/batman-adv/unicast.c               |   13 ++++++++++---
 5 files changed, 33 insertions(+), 7 deletions(-)

commit d11ebb55757d366b2e445dea5a96e3ef1b4d22eb
Author: Yuchung Cheng <ycheng@google.com>
Date:   Fri Aug 9 17:21:27 2013 -0700

    Upstream commit: 356d7d88e088687b6578ca64601b0a2c9d145296
    
    netfilter: nf_conntrack: fix tcp_in_window for Fast Open
    
    Currently the conntrack checks if the ending sequence of a packet
    falls within the observed receive window. However it does so even
    if it has not observe any packet from the remote yet and uses an
    uninitialized receive window (td_maxwin).
    
    If a connection uses Fast Open to send a SYN-data packet which is
    dropped afterward in the network. The subsequent SYNs retransmits
    will all fail this check and be discarded, leading to a connection
    timeout. This is because the SYN retransmit does not contain data
    payload so
    
    end == initial sequence number (isn) + 1
    sender->td_end == isn + syn_data_len
    receiver->td_maxwin == 0
    
    The fix is to only apply this check after td_maxwin is initialized.
    
    Reported-by: Michael Chan <mcfchan@stanford.edu>
    Signed-off-by: Yuchung Cheng <ycheng@google.com>
    Acked-by: Eric Dumazet <edumazet@google.com>
    Acked-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

 net/netfilter/nf_conntrack_proto_tcp.c |   12 ++++++++----
 1 files changed, 8 insertions(+), 4 deletions(-)

commit 94462727d1f151aa2e3f7fbf0dedb19d8545d2ec
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Thu Aug 1 12:36:57 2013 +0300

    Upstream commit: e4d091d7bf787cd303383725b8071d0bae76f981
    
    netfilter: nfnetlink_{log,queue}: fix information leaks in netlink message
    
    These structs have a "_pad" member.  Also the "phw" structs have an 8
    byte "hw_addr[]" array but sometimes only the first 6 bytes are
    initialized.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

 net/netfilter/nfnetlink_log.c        |    6 +++++-
 net/netfilter/nfnetlink_queue_core.c |    5 ++++-
 2 files changed, 9 insertions(+), 2 deletions(-)

commit c5b469d0a0b480a8b2dcac9b4e6532c0ac17f81f
Author: Pablo Neira Ayuso <pablo@netfilter.org>
Date:   Thu Jul 25 10:46:46 2013 +0200

    Upstream commit: a206bcb3b02025b23137f3228109d72e0f835c05
    
    netfilter: xt_TCPOPTSTRIP: fix possible off by one access
    
    Fix a possible off by one access since optlen()
    touches opt[offset+1] unsafely when i == tcp_hdrlen(skb) - 1.
    
    This patch replaces tcp_hdrlen() by the local variable tcp_hdrlen
    that stores the TCP header length, to save some cycles.
    
    Reported-by: Julian Anastasov <ja@ssi.bg>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

 net/netfilter/xt_TCPOPTSTRIP.c |   10 ++++++----
 1 files changed, 6 insertions(+), 4 deletions(-)

commit 4634def261cf5f635bc60afe8a6ad436b3ec151e
Author: Pablo Neira Ayuso <pablo@netfilter.org>
Date:   Thu Jul 25 10:37:49 2013 +0200

    Upstream commit: 71ffe9c77dd7a2b62207953091efa8dafec958dd
    
    netfilter: xt_TCPMSS: fix handling of malformed TCP header and options
    
    Make sure the packet has enough room for the TCP header and
    that it is not malformed.
    
    While at it, store tcph->doff*4 in a variable, as it is used
    several times.
    
    This patch also fixes a possible off by one in case of malformed
    TCP options.
    
    Reported-by: Julian Anastasov <ja@ssi.bg>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

 net/netfilter/xt_TCPMSS.c |   28 ++++++++++++++++------------
 1 files changed, 16 insertions(+), 12 deletions(-)

commit dc552b7b377b8b0cba23513ee09a2341d6714ae8
Author: Dave Jones <davej@redhat.com>
Date:   Fri Aug 9 11:16:34 2013 -0700

    Upstream commit: d06f5187469eee1b2932c02fd093d113cfc60d5e
    
    8139cp: Fix skb leak in rx_status_loop failure path.
    
    Introduced in cf3c4c03060b688cbc389ebc5065ebcce5653e96
    ("8139cp: Add dma_mapping_error checking")
    
    Signed-off-by: Dave Jones <davej@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/ethernet/realtek/8139cp.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 227b279491a0bbcc70ca3654f34903282c378600
Author: Timo Teräs <timo.teras@iki.fi>
Date:   Tue Aug 6 13:45:43 2013 +0300

    Upstream commit: 77a482bdb2e68d13fae87541b341905ba70d572b
    
    ip_gre: fix ipgre_header to return correct offset
    
    Fix ipgre_header() (header_ops->create) to return the correct
    amount of bytes pushed. Most callers of dev_hard_header() seem
    to care only if it was success, but af_packet.c uses it as
    offset to the skb to copy from userspace only once. In practice
    this fixes packet socket sendto()/sendmsg() to gre tunnels.
    
    Regression introduced in c54419321455631079c7d6e60bc732dd0c5914c5
    ("GRE: Refactor GRE tunneling code.")
    
    Cc: Pravin B Shelar <pshelar@nicira.com>
    Signed-off-by: Timo Teräs <timo.teras@iki.fi>
    Acked-by: Eric Dumazet <edumazet@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv4/ip_gre.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 4b37d11c0ebb440d9335861ce8f1e690a34c10fb
Author: Eric Dumazet <edumazet@google.com>
Date:   Mon Aug 5 11:18:49 2013 -0700

    Upstream commit: aab515d7c32a34300312416c50314e755ea6f765
    
    fib_trie: remove potential out of bound access
    
    AddressSanitizer [1] dynamic checker pointed a potential
    out of bound access in leaf_walk_rcu()
    
    We could allocate one more slot in tnode_new() to leave the prefetch()
    in-place but it looks not worth the pain.
    
    Bug added in commit 82cfbb008572b ("[IPV4] fib_trie: iterator recode")
    
    [1] :
    https://code.google.com/p/address-sanitizer/wiki/AddressSanitizerForKernel
    
    Reported-by: Andrey Konovalov <andreyknvl@google.com>
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Cc: Dmitry Vyukov <dvyukov@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv4/fib_trie.c |    5 +----
 1 files changed, 1 insertions(+), 4 deletions(-)

commit 3928184d65fdaf3eef446f0e6c5f305352c1fd02
Author: Daniel Borkmann <dborkman@redhat.com>
Date:   Mon Aug 5 12:49:35 2013 +0200

    Upstream commit: 7921895a5e852fc99de347bc0600659997de9298
    
    net: esp{4,6}: fix potential MTU calculation overflows
    
    Commit 91657eafb ("xfrm: take net hdr len into account for esp payload
    size calculation") introduced a possible interger overflow in
    esp{4,6}_get_mtu() handlers in case of x->props.mode equals
    XFRM_MODE_TUNNEL. Thus, the following expression will overflow
    
      unsigned int net_adj;
      ...
      <case ipv{4,6} XFRM_MODE_TUNNEL>
             net_adj = 0;
      ...
      return ((mtu - x->props.header_len - crypto_aead_authsize(esp->aead) -
               net_adj) & ~(align - 1)) + (net_adj - 2);
    
    where (net_adj - 2) would be evaluated as <foo> + (0 - 2) in an unsigned
    context. Fix it by simply removing brackets as those operations here
    do not need to have special precedence.
    
    Signed-off-by: Daniel Borkmann <dborkman@redhat.com>
    Cc: Benjamin Poirier <bpoirier@suse.de>
    Cc: Steffen Klassert <steffen.klassert@secunet.com>
    Acked-by: Benjamin Poirier <bpoirier@suse.de>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv4/esp4.c |    2 +-
 net/ipv6/esp6.c |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

commit f02bce292d1c2fe610be509c96593e70b3de387b
Author: Julia Lawall <Julia.Lawall@lip6.fr>
Date:   Mon Aug 5 16:47:38 2013 +0200

    Upstream commit: d9af2d67e490b48f0d36f448d34e7bab9425f142
    
    net/vmw_vsock/af_vsock.c: drop unneeded semicolon
    
    Drop the semicolon at the end of the list_for_each_entry loop header.
    
    Signed-off-by: Julia Lawall <Julia.Lawall@lip6.fr>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/vmw_vsock/af_vsock.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 4b62f0cbc3f949056e8bbe0af036acfc20e8e049
Author: Tiger Yang <tiger.yang@oracle.com>
Date:   Tue Aug 13 16:00:58 2013 -0700

    Upstream commit: c7dd3392ad469e6ba125170ad29f881bed85b678
    
    ocfs2: fix NULL pointer dereference in ocfs2_duplicate_clusters_by_page
    
    Since ocfs2_cow_file_pos will invoke ocfs2_refcount_icow with a NULL as
    the struct file pointer, it finally result in a null pointer dereference
    in ocfs2_duplicate_clusters_by_page.
    
    This patch replace file pointer with inode pointer in
    cow_duplicate_clusters to fix this issue.
    
    [jeff.liu@oracle.com: rebased patch against linux-next tree]
    Signed-off-by: Tiger Yang <tiger.yang@oracle.com>
    Signed-off-by: Jie Liu <jeff.liu@oracle.com>
    Cc: Joel Becker <jlbec@evilplan.org>
    Cc: Mark Fasheh <mfasheh@suse.com>
    Acked-by: Tao Ma <tm@tao.ma>
    Tested-by: David Weber <wb@munzinger.de>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/ocfs2/aops.c         |    2 +-
 fs/ocfs2/file.c         |    6 ++--
 fs/ocfs2/move_extents.c |    2 +-
 fs/ocfs2/refcounttree.c |   53 +++++++---------------------------------------
 fs/ocfs2/refcounttree.h |    6 ++--
 5 files changed, 16 insertions(+), 53 deletions(-)

commit 433bf493c7472435b328b2bc85b6e54f6dd3d0d3
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Thu Aug 15 15:52:57 2013 +0300

    Upstream commit: 15718ea0d844e4816dbd95d57a8a0e3e264ba90e
    
    tun: signedness bug in tun_get_user()
    
    The recent fix d9bf5f1309 "tun: compare with 0 instead of total_len" is
    not totally correct.  Because "len" and "sizeof()" are size_t type, that
    means they are never less than zero.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Acked-by: Michael S. Tsirkin <mst@redhat.com>
    Acked-by: Neil Horman <nhorman@tuxdriver.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/tun.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

commit 26ad267ddda451919357965a0cf271ca24d1bcf2
Author: Weiping Pan <wpan@redhat.com>
Date:   Tue Aug 13 21:46:56 2013 +0800

    Upstream commit: d9bf5f130946695063469749bfd190087b7fad39
    
    tun: compare with 0 instead of total_len
    
    Since we set "len = total_len" in the beginning of tun_get_user(),
    so we should compare the new len with 0, instead of total_len,
    or the if statement always returns false.
    
    Signed-off-by: Weiping Pan <wpan@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/tun.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 70023d3ea40fae8b6b6a142a7a5c3db0bcc283f9
Author: Guenter Roeck <linux@roeck-us.net>
Date:   Fri Aug 16 20:50:55 2013 -0700

    Upstream commit: 215b28a5308f3d332df2ee09ef11fda45d7e4a92
    
    s390: Fix broken build
    
    Fix this build error:
    
      In file included from fs/exec.c:61:0:
      arch/s390/include/asm/tlb.h:35:23: error: expected identifier or '(' before 'unsigned'
      arch/s390/include/asm/tlb.h:36:1: warning: no semicolon at end of struct or union [enabled by default]
      arch/s390/include/asm/tlb.h: In function 'tlb_gather_mmu':
      arch/s390/include/asm/tlb.h:57:5: error: 'struct mmu_gather' has no member named 'end'
    
    Broken due to commit 2b047252d0 ("Fix TLB gather virtual address range
    invalidation corner cases").
    
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Cc: stable@vger.kernel.org
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    [ Oh well. We had build testing for ppc amd um, but no s390  - Linus ]
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 arch/s390/include/asm/tlb.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 4e57312c2de2a25ddb181d129dafbc0251062c33
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Thu Aug 15 11:42:25 2013 -0700

    Upstream commit: 2b047252d087be7f2ba088b4933cd904f92e6fce
    
    Fix TLB gather virtual address range invalidation corner cases
    
    Ben Tebulin reported:
    
     "Since v3.7.2 on two independent machines a very specific Git
      repository fails in 9/10 cases on git-fsck due to an SHA1/memory
      failures.  This only occurs on a very specific repository and can be
      reproduced stably on two independent laptops.  Git mailing list ran
      out of ideas and for me this looks like some very exotic kernel issue"
    
    and bisected the failure to the backport of commit 53a59fc67f97 ("mm:
    limit mmu_gather batching to fix soft lockups on !CONFIG_PREEMPT").
    
    That commit itself is not actually buggy, but what it does is to make it
    much more likely to hit the partial TLB invalidation case, since it
    introduces a new case in tlb_next_batch() that previously only ever
    happened when running out of memory.
    
    The real bug is that the TLB gather virtual memory range setup is subtly
    buggered.  It was introduced in commit 597e1c3580b7 ("mm/mmu_gather:
    enable tlb flush range in generic mmu_gather"), and the range handling
    was already fixed at least once in commit e6c495a96ce0 ("mm: fix the TLB
    range flushed when __tlb_remove_page() runs out of slots"), but that fix
    was not complete.
    
    The problem with the TLB gather virtual address range is that it isn't
    set up by the initial tlb_gather_mmu() initialization (which didn't get
    the TLB range information), but it is set up ad-hoc later by the
    functions that actually flush the TLB.  And so any such case that forgot
    to update the TLB range entries would potentially miss TLB invalidates.
    
    Rather than try to figure out exactly which particular ad-hoc range
    setup was missing (I personally suspect it's the hugetlb case in
    zap_huge_pmd(), which didn't have the same logic as zap_pte_range()
    did), this patch just gets rid of the problem at the source: make the
    TLB range information available to tlb_gather_mmu(), and initialize it
    when initializing all the other tlb gather fields.
    
    This makes the patch larger, but conceptually much simpler.  And the end
    result is much more understandable; even if you want to play games with
    partial ranges when invalidating the TLB contents in chunks, now the
    range information is always there, and anybody who doesn't want to
    bother with it won't introduce subtle bugs.
    
    Ben verified that this fixes his problem.
    
    Reported-bisected-and-tested-by: Ben Tebulin <tebulin@googlemail.com>
    Build-testing-by: Stephen Rothwell <sfr@canb.auug.org.au>
    Build-testing-by: Richard Weinberger <richard.weinberger@gmail.com>
    Reviewed-by: Michal Hocko <mhocko@suse.cz>
    Acked-by: Peter Zijlstra <peterz@infradead.org>
    Cc: stable@vger.kernel.org
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 arch/arm/include/asm/tlb.h   |    7 +++++--
 arch/arm64/include/asm/tlb.h |    7 +++++--
 arch/ia64/include/asm/tlb.h  |    9 ++++++---
 arch/s390/include/asm/tlb.h  |    8 ++++++--
 arch/sh/include/asm/tlb.h    |    6 ++++--
 arch/um/include/asm/tlb.h    |    6 ++++--
 fs/exec.c                    |    4 ++--
 include/asm-generic/tlb.h    |    2 +-
 mm/hugetlb.c                 |    2 +-
 mm/memory.c                  |   36 +++++++++++++++++++++---------------
 mm/mmap.c                    |    4 ++--
 11 files changed, 57 insertions(+), 34 deletions(-)

commit 771ed01c6027772eca1a0df8de65043e7f0d94f8
Merge: 5568c80 ffceabf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 17 09:11:41 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit ffceabfcc65c60109ba5fca694d78d4dc7047809
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 17 09:10:44 2013 -0400

    Update to pax-linux-3.10.7-test11.patch:
    - simplified some arm code
    - disabled preemption when calling show_regs, reported by Corey Minyard
    - added PCID based support for UDEREF on amd64 (blog will have more details)
      - requires Westmere/Sandy Bridge/Ivy Bridge/Haswell/etc
      - nopcid turns it off
      - by default a strong form of UDEREF is used under PCID
      - pax_weakuderef switches to the older, less secure UDEREF
      - fixed several bugs that would also have manifested under SMAP
      - INVPCID is used when available (Haswell)
    - added a few more return insn instrumentation in new amd64 crypto code

 Documentation/kernel-parameters.txt          |    7 +
 arch/arm/include/asm/uaccess.h               |    3 +
 arch/x86/crypto/blowfish-avx2-asm_64.S       |    6 +
 arch/x86/crypto/camellia-aesni-avx-asm_64.S  |   10 ++
 arch/x86/crypto/camellia-aesni-avx2-asm_64.S |   10 ++
 arch/x86/crypto/crc32c-pcl-intel-asm_64.S    |    2 +
 arch/x86/crypto/ghash-clmulni-intel_asm.S    |    5 +
 arch/x86/crypto/serpent-avx2-asm_64.S        |    9 ++
 arch/x86/crypto/sha256-avx-asm.S             |    2 +
 arch/x86/crypto/sha256-avx2-asm.S            |    2 +
 arch/x86/crypto/sha256-ssse3-asm.S           |    2 +
 arch/x86/crypto/sha512-avx-asm.S             |    2 +
 arch/x86/crypto/sha512-avx2-asm.S            |    2 +
 arch/x86/crypto/sha512-ssse3-asm.S           |    2 +
 arch/x86/crypto/twofish-avx2-asm_64.S        |    8 ++
 arch/x86/ia32/ia32_signal.c                  |    2 +-
 arch/x86/ia32/ia32entry.S                    |   24 ++++-
 arch/x86/include/asm/cpufeature.h            |    3 +-
 arch/x86/include/asm/fpu-internal.h          |    2 +
 arch/x86/include/asm/futex.h                 |    4 +
 arch/x86/include/asm/mmu_context.h           |   80 +++++++++++---
 arch/x86/include/asm/pgtable.h               |   10 +-
 arch/x86/include/asm/processor.h             |   15 +++-
 arch/x86/include/asm/segment.h               |    5 +-
 arch/x86/include/asm/smap.h                  |   64 +++++++++++-
 arch/x86/include/asm/tlbflush.h              |   63 +++++++++--
 arch/x86/include/asm/uaccess.h               |   18 +++-
 arch/x86/include/asm/xsave.h                 |    4 +
 arch/x86/kernel/cpu/common.c                 |   38 +++++++
 arch/x86/kernel/entry_32.S                   |    2 +-
 arch/x86/kernel/entry_64.S                   |  152 +++++++++++++++++++++++---
 arch/x86/kernel/head_32.S                    |    2 +-
 arch/x86/kernel/head_64.S                    |    8 +-
 arch/x86/kernel/process_64.c                 |    5 +
 arch/x86/kernel/setup.c                      |    8 +-
 arch/x86/kernel/signal.c                     |    4 +-
 arch/x86/kernel/smpboot.c                    |   15 ++-
 arch/x86/lib/copy_user_64.S                  |   50 +--------
 arch/x86/lib/copy_user_nocache_64.S          |    2 +
 arch/x86/lib/csum-wrappers_64.c              |   11 ++-
 arch/x86/lib/memcpy_64.S                     |    4 +-
 arch/x86/lib/memmove_64.S                    |    2 +-
 arch/x86/lib/memset_64.S                     |    4 +-
 arch/x86/lib/usercopy_64.c                   |    5 +-
 arch/x86/mm/Makefile                         |    4 +
 arch/x86/mm/fault.c                          |   29 ++++--
 arch/x86/mm/init.c                           |    7 +-
 arch/x86/mm/init_64.c                        |    9 ++-
 arch/x86/mm/pageattr.c                       |    2 +-
 arch/x86/mm/pgtable.c                        |    3 +
 arch/x86/platform/efi/efi_32.c               |    2 +-
 arch/x86/platform/efi/efi_64.c               |    2 +-
 arch/x86/realmode/rm/trampoline_64.S         |    1 +
 fs/exec.c                                    |    2 +
 include/asm-generic/uaccess.h                |    8 ++
 include/linux/compat.h                       |    1 +
 include/linux/preempt.h                      |   19 +++
 include/linux/signal.h                       |    1 +
 include/linux/smp.h                          |    2 +
 init/main.c                                  |   14 ++-
 kernel/signal.c                              |   16 +++
 security/Kconfig                             |    5 +
 tools/lib/lk/Makefile                        |    2 +-
 tools/perf/Makefile                          |    2 +-
 64 files changed, 673 insertions(+), 136 deletions(-)

commit 5568c8059e78d6d002815409df4e90c83b3b08a8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 17 08:58:34 2013 -0400

    Fix two harmless compiler warnings

 arch/arm/kernel/process.c |    4 ++--
 fs/exec.c                 |    2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

commit e4a41a3eef8c6bdebdbe273cc0fbe372bcb62806
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Aug 16 22:55:24 2013 -0400

    Upstream commit: c95eb3184ea1a3a2551df57190c81da695e2144b

 arch/arm/kernel/perf_event.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

commit 3637bc893b57a227b01852fe34685ab237285b10
Author: Stephen Boyd <sboyd@codeaurora.org>
Date:   Wed Aug 7 16:18:08 2013 -0700

    Upstream commit: b88a2595b6d8aedbd275c07dfa784657b4f757eb
    
    perf/arm: Fix armpmu_map_hw_event()
    
    Fix constraint check in armpmu_map_hw_event().
    
    Reported-and-tested-by: Vince Weaver <vincent.weaver@maine.edu>
    Cc: <stable@kernel.org>
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 arch/arm/kernel/perf_event.c |    7 ++++++-
 1 files changed, 6 insertions(+), 1 deletions(-)

commit 11802e1f961a088c39af58d1c1b14d861eedfb35
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Aug 16 22:53:30 2013 -0400

    More ARM backports

 arch/arm/kernel/entry-armv.S |    3 ++-
 arch/arm/kernel/fiq.c        |    8 ++------
 2 files changed, 4 insertions(+), 7 deletions(-)

commit bf89938c71ddbd6efb2c2e43bf4f3f99fef623ea
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Aug 16 22:46:01 2013 -0400

    Fix HIDESYM compatibility with kprobes, as reported by feandil at:
    http://forums.grsecurity.net/viewtopic.php?t=3701&p=13376#p13376

 include/linux/kallsyms.h |    2 +-
 kernel/kprobes.c         |    3 +++
 2 files changed, 4 insertions(+), 1 deletions(-)

commit 3d1cf88bbdbe4c0e83dd7d731ecaf1741209d6b7
Author: yonghua zheng <younghua.zheng@gmail.com>
Date:   Tue Aug 13 16:01:03 2013 -0700

    fs/proc/task_mmu.c: fix buffer overflow in add_page_map()
    
    Recently we met quite a lot of random kernel panic issues after enabling
    CONFIG_PROC_PAGE_MONITOR.  After debuggind we found this has something
    to do with following bug in pagemap:
    
    In struct pagemapread:
    
      struct pagemapread {
          int pos, len;
          pagemap_entry_t *buffer;
          bool v2;
      };
    
    pos is number of PM_ENTRY_BYTES in buffer, but len is the size of
    buffer, it is a mistake to compare pos and len in add_page_map() for
    checking buffer is full or not, and this can lead to buffer overflow and
    random kernel panic issue.
    
    Correct len to be total number of PM_ENTRY_BYTES in buffer.
    
    [akpm@linux-foundation.org: document pagemapread.pos and .len units, fix PM_ENTRY_BYTES definition]
    Signed-off-by: Yonghua Zheng <younghua.zheng@gmail.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/proc/task_mmu.c

 fs/proc/task_mmu.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

commit 0a3dac834746de241c10d4978bf61b4f146ba89d
Merge: dc19474 e12de30
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Aug 16 17:39:01 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit e12de30aa6b575fc3c9f5cd098dd03623598cb33
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Aug 16 17:34:47 2013 -0400

    Update to pax-linux-3.10.7-test9.patch:
    - Emese fixed a size overflow false positive reported by Sven Vermeulen
    - fixed some arm compile problems reported by spender
    - added empty unchecked wrappers for local_t accessors on mips, by Corey Minyard <cminyard@mvista.com>
      eventually we'll have full REFCOUNT support on mips

 arch/arm/kernel/process.c     |    5 ++-
 arch/arm/mm/Kconfig           |    2 +-
 arch/arm/mm/fault.c           |    3 ++
 arch/mips/include/asm/local.h |   57 +++++++++++++++++++++++++++++++++++++++++
 mm/internal.h                 |    2 +-
 5 files changed, 65 insertions(+), 4 deletions(-)

commit dc19474d0ea6ea3c939544ae5f906067b1784a10
Merge: 51b78c0 82266f9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 15 21:47:37 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit 82266f90a3f87ab5017329fb539aebf94c42253a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 15 21:14:47 2013 -0400

    Update to pax-linux-3.10.7-test9.patch

 arch/arm/kernel/process.c |    6 ++----
 1 files changed, 2 insertions(+), 4 deletions(-)

commit 51b78c06d1f41614f593cd36456b4af559e9d7fa
Merge: e32d904 cb77ead
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 15 20:53:45 2013 -0400

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	security/Kconfig

commit cb77ead0eccb5abb75f7e437a3725d0254558ccd
Merge: 13675b8 519be45
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 15 20:50:47 2013 -0400

    Update to pax-linux-3.10.7-test8.patch
    
    Merge branch 'linux-3.10.y' into pax-test

commit e32d904b87292288e74e2637b900fd1115687b8e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 10 09:41:40 2013 -0400

    propagate the threadstack offset through to the topdown/bottomup allocators
    on sparc64 hugepages

 arch/sparc/mm/hugetlbpage.c |   12 ++++++++----
 1 files changed, 8 insertions(+), 4 deletions(-)

commit cefa30759f6c977fff5cc1634ecfbfe0ee44391c
Author: Oleg Nesterov <oleg@redhat.com>
Date:   Thu Aug 8 18:55:32 2013 +0200

    Upstream commit: 8742f229b635bf1c1c84a3dfe5e47c814c20b5c8
    
    another local DoS found in reaction to the one I reported,
    we don't allow unpriv user ns use so this doesn't matter much to us
    
    userns: limit the maximum depth of user_namespace->parent chain
    
    Ensure that user_namespace->parent chain can't grow too much.
    Currently we use the hardroded 32 as limit.
    
    Reported-by: Andy Lutomirski <luto@amacapital.net>
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 include/linux/user_namespace.h |    1 +
 kernel/user_namespace.c        |    4 ++++
 2 files changed, 5 insertions(+), 0 deletions(-)

commit 223ac007ef18bf3a5095ba0a56675c1f16200149
Merge: 1c92de4 13675b8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 8 20:45:24 2013 -0400

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	security/Kconfig

commit 13675b848cf02bffd26924b2b84d927095bc253d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 8 20:43:52 2013 -0400

    Update to pax-linux-3.10.5-test8.patch:
    - Emese fixed a size overflow false positive, reported by markusle (http://forums.grsecurity.net/viewtopic.php?f=3&t=3692)
    - fixed the use of PXN for 2-level pages tables on arm, by Corey Minyard <cminyard@mvista.com>
    - added PAGEEXEC/XI violation reporting on mips, by Corey Minyard <cminyard@mvista.com>

 arch/arm/include/asm/pgtable-2level.h |    4 +++-
 arch/arm/mm/proc-v7-2level.S          |    3 ---
 arch/mips/mm/fault.c                  |    8 ++++++++
 arch/x86/include/asm/processor.h      |    3 ++-
 include/linux/math64.h                |    2 +-
 security/Kconfig                      |    2 --
 6 files changed, 14 insertions(+), 8 deletions(-)

commit 1c92de4b8811c330af033c31d83c9c45e3d064b2
Merge: e65aa3d 1660f49
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 5 18:50:45 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit 1660f496848b8400d263f7920989dae15e72185a
Merge: 7f91ba1 dc51cd2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 5 18:50:12 2013 -0400

    Update to pax-linux-3.10.5-test7.patch
    
    Merge branch 'linux-3.10.y' into pax-test
    
    Conflicts:
    	arch/x86/kernel/head_64.S
    	mm/mempolicy.c

commit e65aa3dd447115cb79b4815bc1ceac7b3cacef15
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 5 17:58:42 2013 -0400

    Disable RANDKSTACK for a VirtualBox host as mentioned on the
    gentoo-hardened bugzilla:
    https://bugs.gentoo.org/show_bug.cgi?id=382793

 security/Kconfig |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 60d8cffd7740fd1d527790caf9a24a35d8c45858
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Tue Jul 30 13:23:39 2013 +0300

    Upstream commit: 8cb3b9c3642c0263d48f31d525bcee7170eedc20
    
    net_sched: info leak in atm_tc_dump_class()
    
    The "pvc" struct has a hole after pvc.sap_family which is not cleared.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Reviewed-by: Jiri Pirko <jiri@resnulli.us>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/sched/sch_atm.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 50d20ebce56b6e0b9622685930e007e46c7c04bb
Author: Daniel Borkmann <dborkman@redhat.com>
Date:   Fri Aug 2 11:32:43 2013 +0200

    Upstream commit: 446266b0c742a2c9ee8f0dce759a0117bce58a86
    
    net: rtm_to_ifaddr: free ifa if ifa_cacheinfo processing fails
    
    Commit 5c766d642 ("ipv4: introduce address lifetime") leaves the ifa
    resource that was allocated via inet_alloc_ifa() unfreed when returning
    the function with -EINVAL. Thus, free it first via inet_free_ifa().
    
    Signed-off-by: Daniel Borkmann <dborkman@redhat.com>
    Reviewed-by: Jiri Pirko <jiri@resnulli.us>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv4/devinet.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

commit 0acaba4eea12097cc59bc61a46ba1ef4a468b260
Author: Himanshu Madhani <himanshu.madhani@qlogic.com>
Date:   Fri Aug 2 23:15:56 2013 -0400

    Upstream commit: f91bbcb0b82186b4d5669021b142c263b66505e1
    
    qlcnic: Free up memory in error path.
    
    Signed-off-by: Himanshu Madhani <himanshu.madhani@qlogic.com>
    Signed-off-by: Shahed Shaikh <shahed.shaikh@qlogic.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/ethernet/qlogic/qlcnic/qlcnic_ctx.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

commit 3626ec32c8b24cb38b8db2a1b2f5430bd898408a
Author: Shahed Shaikh <shahed.shaikh@qlogic.com>
Date:   Fri Aug 2 23:15:54 2013 -0400

    Upstream commit: 4a99ab56cea66f9f67b9d07ace5cd40a336c8e6f
    
    qlcnic: Fix MAC address filter issue on 82xx adapter
    
    Driver was passing the address of a pointer instead of
    the pointer itself.
    
    Signed-off-by: Shahed Shaikh <shahed.shaikh@qlogic.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/ethernet/qlogic/qlcnic/qlcnic_io.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 5570df953d6c143e05f1d60d9c23210e60dbbe81
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 5 17:26:40 2013 -0400

    Move user namespace capability check to shared create_user_ns code so we
    cover unshare() as well.
    
    Also kill a trivial 1-line, 22-character upstream kernel DoS, thanks to
    user namespaces!

 kernel/fork.c           |   17 -----------------
 kernel/user_namespace.c |   24 ++++++++++++++++++++++--
 2 files changed, 22 insertions(+), 19 deletions(-)

commit 97112fe30de4ca84e79c82ebfa2353b9c9988ca1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 5 16:05:41 2013 -0400

    silence a warning on older gcc

 grsecurity/gracl.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit b8966a5d577e9220fbc63306eee978f819f24e2e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 3 08:31:08 2013 -0400

    we only care about mmaps of the beginning of an ELF, filter out
    all others as suggested by pipacs

 mm/mmap.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 8aea9fe5866dec3c847a34f743f343e18cf1cdcb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Aug 2 23:54:51 2013 -0400

    add include

 grsecurity/grsec_log.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit d48425ef8cb3761ab6130e52f1f8e401f5b5a295
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Aug 2 23:49:13 2013 -0400

    fix compilation

 include/linux/grinternal.h |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 1704c23fdc55b68f512dc9927940e72237f3f43e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Aug 2 23:34:35 2013 -0400

    Improve PaX reporting (tells when anon mapping is stack or heap)
    Remove textrel logging option, combine into rwx logging option
    Enhance RWX logging option to display when PT_GNU_STACK-enabled library
    is loaded under an MPROTECTed binary
    Enhance RWX mprotect logging to display stack/heap instead of just
    anon mapping

 fs/binfmt_elf.c            |   37 +++++++++++++++++++++++++++++++++++++
 fs/exec.c                  |    4 ++++
 grsecurity/Kconfig         |   21 +++++----------------
 grsecurity/grsec_init.c    |    4 ----
 grsecurity/grsec_log.c     |   14 ++++++++++++++
 grsecurity/grsec_pax.c     |   19 ++++++++++++++-----
 grsecurity/grsec_sysctl.c  |    9 ---------
 include/linux/binfmts.h    |    1 +
 include/linux/grinternal.h |    2 +-
 include/linux/grmsg.h      |    3 ++-
 include/linux/grsecurity.h |    3 ++-
 mm/mmap.c                  |    7 +++++++
 mm/mprotect.c              |    2 +-
 13 files changed, 88 insertions(+), 38 deletions(-)

commit faf81c100c8565524e21c9af780a0ad2ce3fd925
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 1 18:52:02 2013 -0400

    add missing #define

 grsecurity/gracl.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit e87232d1fcb4da72df971cbc623aac6c9b3871a0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 1 18:43:53 2013 -0400

    fix compilation for !COMPAT as reported on the forums

 grsecurity/gracl.c |  195 ++++++++++++++++++++++++++--------------------------
 1 files changed, 97 insertions(+), 98 deletions(-)

commit 65c9b9c6c42939dc55be1b8842e7c2e05733056c
Merge: 65019c9 7f91ba1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jul 31 17:47:31 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit 65019c9bd05f860437071cbf00e2027fd2d68615
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jul 31 17:47:20 2013 -0400

    Revert "revert recent PaX change that causes boot failures with 32bit userland"
    
    This reverts commit 23278a1ee1c7738dd1e7005241394d32b82196e4.

 arch/x86/include/asm/processor.h |    4 ++--
 arch/x86/kernel/cpu/common.c     |    2 +-
 arch/x86/kernel/process_64.c     |    2 +-
 arch/x86/kernel/smpboot.c        |    2 +-
 arch/x86/xen/smp.c               |    2 +-
 5 files changed, 6 insertions(+), 6 deletions(-)

commit 7f91ba11122fcaa96fc2dca42bddcd5f8db3b945
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jul 31 17:46:00 2013 -0400

    Update to pax-linux-3.10.4-test7.patch:
    - added a few more missing format strings
    - added reporting of mismatched MPROTECT/EMUTRAMP flags between libraries and the main executable
    - reverted the recent amd64 kstack alignment fix, it'll be done the harder way another time
    - fixed a UDEREF/i386 regression, __get_user_8 would always fail

 arch/x86/include/asm/processor.h           |    4 +-
 arch/x86/kernel/cpu/common.c               |    2 +-
 arch/x86/kernel/dumpstack.c                |    2 +-
 arch/x86/kernel/process_64.c               |    2 +-
 arch/x86/kernel/reboot_fixups_32.c         |    2 +-
 arch/x86/kernel/smpboot.c                  |    2 +-
 arch/x86/lib/getuser.S                     |    4 +-
 arch/x86/xen/smp.c                         |    2 +-
 drivers/net/wireless/iwlwifi/dvm/debugfs.c |    8 ++--
 drivers/video/backlight/backlight.c        |    2 +-
 drivers/video/backlight/lcd.c              |    2 +-
 fs/binfmt_elf.c                            |   51 +++++++++++++++++++++++++---
 fs/exec.c                                  |   50 +++++++++++++--------------
 include/linux/sched.h                      |    2 +
 14 files changed, 88 insertions(+), 47 deletions(-)

commit 043130da54cb7cc8dc44e0ce889d426e889a0532
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jul 31 16:26:58 2013 -0400

    compile fix for !COMPAT as mentioned on forums

 grsecurity/gracl.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit ed0a195abd4e41c2449a020a53a19c74dc866d78
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 22:33:14 2013 -0400

    perform compat conversion of rlimit infinity

 grsecurity/gracl_compat.c |   10 ++++++++--
 1 files changed, 8 insertions(+), 2 deletions(-)

commit a99c1b9f31678c1c72a63bea65aed1b2d3205259
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 22:21:40 2013 -0400

    remove debugging

 grsecurity/gracl_compat.c |   44 +++++++++++---------------------------------
 1 files changed, 11 insertions(+), 33 deletions(-)

commit e75b3f504692b97960a7530ad0855d91441d79c0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 22:20:32 2013 -0400

    eliminate compat_dev_t

 include/linux/gracl_compat.h |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit e5abbaf95313066a724e1a843d4fc902a9a6450e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 22:13:22 2013 -0400

    fix compat rlimit size

 grsecurity/gracl_compat.c    |   68 +++++++++++++++++++++++++++++-------------
 include/linux/gracl_compat.h |    4 +-
 2 files changed, 49 insertions(+), 23 deletions(-)

commit 877d6c2f8b3518ff39601084560bb33c58d35a1f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 21:20:18 2013 -0400

    compile fix

 grsecurity/gracl.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit a2062eae8d1dc48d338480e599fedee2dc5e2f98
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 21:14:29 2013 -0400

    copy correct pointer size in new compat code

 grsecurity/gracl.c        |    8 ++++----
 grsecurity/gracl_compat.c |    4 ++--
 2 files changed, 6 insertions(+), 6 deletions(-)

commit 23278a1ee1c7738dd1e7005241394d32b82196e4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 19:48:58 2013 -0400

    revert recent PaX change that causes boot failures with 32bit userland

 arch/x86/include/asm/processor.h |    4 ++--
 arch/x86/kernel/cpu/common.c     |    2 +-
 arch/x86/kernel/process_64.c     |    2 +-
 arch/x86/kernel/smpboot.c        |    2 +-
 arch/x86/xen/smp.c               |    2 +-
 5 files changed, 6 insertions(+), 6 deletions(-)

commit ec27f71a813656fea8ab37faecb2b485fe99d08e
Merge: 3a11bcf 05f0a61
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 19:42:21 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit 05f0a610373fa95df838f97c3fcfb59a3d79c5b8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 19:41:44 2013 -0400

    Update to pax-linux-3.10.4-test6.patch:
    - fixed some size_overflow false positives on i386 caused by __SC_LONG, reported by spender

 include/linux/syscalls.h |    8 ++++++--
 1 files changed, 6 insertions(+), 2 deletions(-)

commit 3a11bcfcc738ed5dbf0d56713db872ed36351a26
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 19:15:50 2013 -0400

    compile fix

 grsecurity/gracl_compat.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

commit 1dbd99b5cb0b6757eadf22309501e7fdd84f5de7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 19:12:46 2013 -0400

    remove BUILD_BUG_ONs

 grsecurity/gracl_compat.c |   20 --------------------
 1 files changed, 0 insertions(+), 20 deletions(-)

commit a283b21cbd77622383a1dcb1f7bf1080db3bae88
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 00:18:36 2013 -0400

    compile fixes

 grsecurity/gracl_compat.c    |    8 ++++----
 include/linux/gracl_compat.h |    2 +-
 2 files changed, 5 insertions(+), 5 deletions(-)

commit 8b744005f8bae565e24c1fd88af77e6e619b9434
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 00:16:42 2013 -0400

    compile fixes

 grsecurity/gracl.c        |    4 ++--
 grsecurity/gracl_compat.c |    2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

commit 5cd86afa393bf9bf38c2e9063191709ac2beff2c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 00:13:51 2013 -0400

    compile fixes

 grsecurity/gracl.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

commit b93b829afcc98b6108b18d99ff63c53642d0b951
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 00:11:03 2013 -0400

    compile fixes

 grsecurity/gracl_compat.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit 7da096415fa633c4ad2b1f74bd43d3a58a63b5c0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 30 00:08:21 2013 -0400

    more compile fixes

 grsecurity/gracl.c |   28 ++++++++++++++--------------
 1 files changed, 14 insertions(+), 14 deletions(-)

commit 6c1fd80e19f1449b6895f1ed77f23f1245470b3b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 29 23:59:50 2013 -0400

    more compile fixes

 grsecurity/gracl.c |   10 +++++++++-
 1 files changed, 9 insertions(+), 1 deletions(-)

commit 89dda536f276dd4bb55fa0f9ea8980ac8b750d29
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 29 23:56:47 2013 -0400

    additional compile fixes

 grsecurity/gracl.c |   59 +++++++++++++++++++++++++++++++++++++++++++--------
 1 files changed, 49 insertions(+), 10 deletions(-)

commit ac695a081d1124fb28bec46814535d34c5e40611
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 29 23:47:15 2013 -0400

    fix typo

 grsecurity/gracl.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit d95dd21a8d6d00c5cf34fee3f45dd914b6da6093
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 29 23:46:59 2013 -0400

    compile fixes

 grsecurity/gracl.c |   53 ++++++++++++++++++++++++++++++++++++++-------------
 1 files changed, 39 insertions(+), 14 deletions(-)

commit 82631f451cc7432b6c5578cf8d24155473feb25c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 29 23:22:44 2013 -0400

    Initial commit of compat RBAC loading
    Permits 32bit gradm to load policy for a 64bit kernel
    
    Also removed code duplication for copying strings into the kernel
    
    Work performed as part of sponsorship

 grsecurity/Makefile          |    4 +
 grsecurity/gracl.c           |  315 +++++++++++++++++++++++-------------------
 grsecurity/gracl_compat.c    |  270 ++++++++++++++++++++++++++++++++++++
 include/linux/gracl_compat.h |  156 +++++++++++++++++++++
 4 files changed, 603 insertions(+), 142 deletions(-)

commit 84c4a433dfb096e4a1162ee5e68025122c70b421
Merge: c9d3ed3 9fe5897
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 29 17:08:56 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit 9fe58978938e357642885866ca48090a7753d403
Merge: 8f693ad 6f7bb6b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 29 17:08:43 2013 -0400

    Merge branch 'linux-3.10.y' into pax-test

commit c9d3ed33c5370bbacfadf86f6a1566828a3d7775
Merge: d5e5bfd 8f693ad
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 28 10:03:08 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit 8f693ade9b3e448f92706d34148b00a087637f70
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 28 10:02:16 2013 -0400

    Update to pax-linux-3.10.3-test5.patch:
    - fixed amd64 kstack alignment (caught by some crazy codegen by clang/llvm)
    - fixed handling of faulting userland accesses for UDEREF/arm, from spender
    - updated the size overflow hash table, from Emese

 arch/arm/kernel/entry-armv.S      |    3 +-
 arch/x86/include/asm/processor.h  |    4 +-
 arch/x86/kernel/cpu/common.c      |    2 +-
 arch/x86/kernel/process_64.c      |    2 +-
 arch/x86/kernel/smpboot.c         |    2 +-
 arch/x86/xen/smp.c                |    2 +-
 tools/gcc/size_overflow_hash.data |  553 +++++++++++++++++++++++++++++++++----
 7 files changed, 513 insertions(+), 55 deletions(-)

commit d5e5bfd6ecc1fc7e86d070df8eb0ce8d0643c558
Merge: 19e077b 8a8a0d0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jul 25 21:05:18 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit 8a8a0d0b22a86bf65302d03bb6732e42bc0a2e56
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jul 25 21:04:09 2013 -0400

    Update to pax-linux-3.10.3-test4.patch:
    - introduced per-slab object sanitization, contributed by Mathias Krause and secunet.
      this is finer grained sanitization than the existing per-page based approach (which
      is still done) at a somewhat higher performance cost. the pax_sanitize_slab command
      line option can be used to enable/disable it on boot (it's enabled by default when
      CONFIG_PAX_MEMORY_SANITIZE is enabled).

 Documentation/kernel-parameters.txt |    4 ++++
 fs/buffer.c                         |    2 +-
 fs/dcache.c                         |    3 ++-
 include/linux/slab.h                |    7 +++++++
 include/linux/slab_def.h            |    4 ++++
 kernel/fork.c                       |    2 +-
 mm/rmap.c                           |    6 ++++--
 mm/slab.c                           |   27 +++++++++++++++++++++++++++
 mm/slab.h                           |   12 +++++++++++-
 mm/slab_common.c                    |   14 ++++++++++++++
 mm/slob.c                           |    5 +++++
 mm/slub.c                           |   11 +++++++++++
 net/core/skbuff.c                   |    6 ++++--
 security/Kconfig                    |   23 +++++++++++++++++------
 14 files changed, 112 insertions(+), 14 deletions(-)

commit 19e077bfff54ca211d0142c07cb6dd88069a390c
Merge: 960ec51 c8f7f51
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jul 25 19:53:34 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit c8f7f51591207b82530214300e86277028919286
Merge: d5142e3 81a4648
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jul 25 19:52:29 2013 -0400

    Update to pax-linux-3.10.3-test3.patch:
    - fixed some compile issues reported by Michael Tremer and spender
    - fixed an i386 regression with the lower address space gap on i386, reported by cnu
    
    Merge branch 'linux-3.10.y' into pax-test
    
    Conflicts:
    	kernel/time/tick-broadcast.c

commit 960ec51ab2142544fbae563d4fd5744775408965
Author: Al Viro <viro@zeniv.linux.org.uk>
Date:   Sat Jul 20 03:13:55 2013 +0400

    Upstream commit: acfec9a5a892f98461f52ed5770de99a3e571ae2
    
    livelock avoidance in sget()
    
    Eric Sandeen has found a nasty livelock in sget() - take a mount(2) about
    to fail.  The superblock is on ->fs_supers, ->s_umount is held exclusive,
    ->s_active is 1.  Along comes two more processes, trying to mount the same
    thing; sget() in each is picking that superblock, bumping ->s_count and
    trying to grab ->s_umount.  ->s_active is 3 now.  Original mount(2)
    finally gets to deactivate_locked_super() on failure; ->s_active is 2,
    superblock is still ->fs_supers because shutdown will *not* happen until
    ->s_active hits 0.  ->s_umount is dropped and now we have two processes
    chasing each other:
    s_active = 2, A acquired ->s_umount, B blocked
    A sees that the damn thing is stillborn, does deactivate_locked_super()
    s_active = 1, A drops ->s_umount, B gets it
    A restarts the search and finds the same superblock.  And bumps it ->s_active.
    s_active = 2, B holds ->s_umount, A blocked on trying to get it
    ... and we are in the earlier situation with A and B switched places.
    
    The root cause, of course, is that ->s_active should not grow until we'd
    got MS_BORN.  Then failing ->mount() will have deactivate_locked_super()
    shut the damn thing down.  Fortunately, it's easy to do - the key point
    is that grab_super() is called only for superblocks currently on ->fs_supers,
    so it can bump ->s_count and grab ->s_umount first, then check MS_BORN and
    bump ->s_active; we must never increment ->s_count for superblocks past
    ->kill_sb(), but grab_super() is never called for those.
    
    The bug is pretty old; we would've caught it by now, if not for accidental
    exclusion between sget() for block filesystems; the things like cgroup or
    e.g. mtd-based filesystems don't have anything of that sort, so they get
    bitten.  The right way to deal with that is obviously to fix sget()...
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

 fs/super.c |   25 ++++++++++---------------
 1 files changed, 10 insertions(+), 15 deletions(-)

commit 3540cebbbfa4aef94527ad3e0e49097848147fb9
Merge: ab95b58 d5142e3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 21 22:47:46 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit d5142e31785f8c32c7338c51fcc27313bdd4a84e
Merge: f36ae8c 0f4a56e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 21 22:47:34 2013 -0400

    Merge branch 'linux-3.10.y' into pax-test

commit ab95b5842899d61ff5c30f4582e72029b3155be8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 21 22:28:40 2013 -0400

    compile fix with constification reported by Michael Tremer

 drivers/gpu/host1x/drm/dc.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 817cd2d1e7a55720326599dd8f542578eef30927
Author: Hannes Frederic Sowa <hannes@stressinduktion.org>
Date:   Fri Jul 12 23:46:33 2013 +0200

    Upstream commit: 307f2fb95e9b96b3577916e73d92e104f8f26494
    
    ipv6: only static routes qualify for equal cost multipathing
    
    Static routes in this case are non-expiring routes which did not get
    configured by autoconf or by icmpv6 redirects.
    
    To make sure we actually get an ecmp route while searching for the first
    one in this fib6_node's leafs, also make sure it matches the ecmp route
    assumptions.
    
    v2:
    a) Removed RTF_EXPIRE check in dst.from chain. The check of RTF_ADDRCONF
       already ensures that this route, even if added again without
       RTF_EXPIRES (in case of a RA announcement with infinite timeout),
       does not cause the rt6i_nsiblings logic to go wrong if a later RA
       updates the expiration time later.
    
    v3:
    a) Allow RTF_EXPIRES routes to enter the ecmp route set. We have to do so,
       because an pmtu event could update the RTF_EXPIRES flag and we would
       not count this route, if another route joins this set. We now filter
       only for RTF_GATEWAY|RTF_ADDRCONF|RTF_DYNAMIC, which are flags that
       don't get changed after rt6_info construction.
    
    Cc: Nicolas Dichtel <nicolas.dichtel@6wind.com>
    Signed-off-by: Hannes Frederic Sowa <hannes@stressinduktion.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv6/ip6_fib.c |   15 +++++++++++----
 1 files changed, 11 insertions(+), 4 deletions(-)

commit 77db8196d51b043e2e2d124094da101b0f01bccb
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Fri Jul 12 09:39:03 2013 +0300

    Upstream commit: b2781e1021525649c0b33fffd005ef219da33926
    
    svcrdma: underflow issue in decode_write_list()
    
    My static checker marks everything from ntohl() as untrusted and it
    complains we could have an underflow problem doing:
    
    	return (u32 *)&ary->wc_array[nchunks];
    
    Also on 32 bit systems the upper bound check could overflow.
    
    Cc: stable@vger.kernel.org
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: J. Bruce Fields <bfields@redhat.com>

 net/sunrpc/xprtrdma/svc_rdma_marshal.c |   20 ++++++++++++++------
 1 files changed, 14 insertions(+), 6 deletions(-)

commit 926473317fd7953137ef97835edd36dabc584b01
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jul 17 21:29:02 2013 -0400

    add missing asm/pgtable.h include, reported by Michael Tremer

 drivers/clk/socfpga/clk.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit c592ae0001b31932ef1491784dfa374058797c66
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 16 20:40:24 2013 -0400

    allow viewing of ecryptfs version under SYSFS_RESTRICT

 fs/sysfs/dir.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 36db325ef3b07ea8cdb47f549e706e5d71398e14
Merge: 9c96441 f36ae8c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 14 19:23:13 2013 -0400

    Merge branch 'pax-test' into grsec-test

commit f36ae8c741ae32b1caff10825be12c327792c925
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 14 19:22:15 2013 -0400

    Update to pax-linux-3.10-test2.patch:
    - spender fixed a compile regression in a recent arm/UDEREF change, reported by Michael Tremer
    - spender fixed arm/KERNEXEC for v5 and older CPUs, reported by Michael Tremer
    - spender fixed a new CONSTIFY victim on arm, reported by Michael Tremer
    - spender fixed an madvise regression, reported by Peter Keel
    - spender fixed a SLAB regression, reported by Thorsten (http://forums.grsecurity.net/viewtopic.php?f=3&t=3614) and Jens (http://forums.grsecurity.net/viewtopic.php?f=1&t=3616)
    - fixed a headers_install regression, reported by Mathias Krause
    - fixed a SLOB compile regression, reported by Mathias Krause

 arch/arm/include/asm/uaccess.h |    4 ++--
 arch/arm/mm/mmu.c              |   15 +++++++++++++--
 drivers/clk/socfpga/clk.c      |    6 ++++--
 mm/madvise.c                   |    4 ++--
 mm/slab.c                      |    4 ++--
 mm/slob.c                      |    4 ++--
 scripts/headers_install.sh     |    2 +-
 7 files changed, 26 insertions(+), 13 deletions(-)

commit 9c9644156a49637050741d9165df79174e59b0ef
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 14 19:19:54 2013 -0400

    Fix sparc64 compilation, reported by Blake Self

 arch/sparc/kernel/sys_sparc_64.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 7bcd3db081454768542c3d741bcf32cd61a50cf5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 14 11:49:17 2013 -0400

    Update PaX fix, just return the error

 mm/madvise.c |   15 +++++++--------
 1 files changed, 7 insertions(+), 8 deletions(-)

commit a10e377d0eddd37e8a3665b135e546ab03d9d171
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 14 11:36:00 2013 -0400

    Fix madvise oops reported by Peter Keel

 mm/madvise.c |   11 ++++++-----
 1 files changed, 6 insertions(+), 5 deletions(-)

commit 08c5adca34d408772255b313f90d82c250c1d967
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 14 11:26:34 2013 -0400

    don't make high vector mapping non-present on old ARM architectures, no
    point in emulating some vector entries when the processor doesn't even support XN

 arch/arm/mm/mmu.c |    7 +++++--
 1 files changed, 5 insertions(+), 2 deletions(-)

commit 2b40781d4197a89a003616af584884e36361c5b2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 14 09:51:58 2013 -0400

    Temporary compile fix for code incorrectly modifying const data
    Wrap a cast version of the code with open/close
    
    Thanks to Michael Tremer for the report

 drivers/clk/socfpga/clk.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

commit a8258c1b4098c396cd4ea719e20858182feac1c1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 14 09:41:16 2013 -0400

    Fix missing right parens in pipacs' "improvement" of my ARM code ;)
    Thanks to Michael Tremer for reporting

 arch/arm/include/asm/uaccess.h |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 8542e1e973be7cc9a009d2ada8033576b2890e6f
Merge: 86f446e 2577f8e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 13 20:46:58 2013 -0400

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	mm/memcontrol.c

commit 2577f8e4ec41efb347706a59c6838de20f0c90da
Merge: 75a36f0 cb5d8be
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 13 20:43:42 2013 -0400

    Merge branch 'linux-3.10.y' into pax-test
    
    Conflicts:
    	crypto/algapi.c
    	drivers/block/nbd.c

commit 86f446e9d5c6b475d2e9360cc04f4361ad1b19b8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jul 12 23:02:11 2013 -0400

    we always want the vector page to be noaccess for userland
    therefore, when kernexec is disabled, instead of L_PTE_USER | L_PTE_RDONLY
    which turns into supervisor rwx, userland rx, we instead omit that entirely,
    leaving it as supervisor rwx only
    
    Fixes booting on ARMv5 and earlier, which need to write directly
    to the high vector mapping via set_tls when context switching
    
    Thanks to Michael Tremer for the bugreport

 arch/arm/mm/mmu.c |   12 ++++++++++--
 1 files changed, 10 insertions(+), 2 deletions(-)

commit 90cd0827eef656ec884f19c977873fefe2f2e47d
Author: Cong Wang <amwang@redhat.com>
Date:   Sat Jun 29 12:02:59 2013 +0800

    Upstream commit: 6c734fb8592f6768170e48e7102cb2f0a1bb9759
    
    gre: fix a regression in ioctl
    
    When testing GRE tunnel, I got:
    
     # ip tunnel show
     get tunnel gre0 failed: Invalid argument
     get tunnel gre1 failed: Invalid argument
    
    This is a regression introduced by commit c54419321455631079c7d
    ("GRE: Refactor GRE tunneling code.") because previously we
    only check the parameters for SIOCADDTUNNEL and SIOCCHGTUNNEL,
    after that commit, the check is moved for all commands.
    
    So, just check for SIOCADDTUNNEL and SIOCCHGTUNNEL.
    
    After this patch I got:
    
     # ip tunnel show
     gre0: gre/ip  remote any  local any  ttl inherit  nopmtudisc
     gre1: gre/ip  remote 192.168.122.101  local 192.168.122.45  ttl inherit
    
    Cc: Pravin B Shelar <pshelar@nicira.com>
    Cc: "David S. Miller" <davem@davemloft.net>
    Signed-off-by: Cong Wang <amwang@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv4/ip_gre.c |    9 +++++----
 1 files changed, 5 insertions(+), 4 deletions(-)

commit 50d4e90ec8da630eac8840da9c53b8738a2f98b5
Author: Cong Wang <amwang@redhat.com>
Date:   Sat Jun 29 13:00:57 2013 +0800

    Upstream commit: ab6c7a0a43c2eaafa57583822b619b22637b49c7
    
    vti: remove duplicated code to fix a memory leak
    
    vti module allocates dev->tstats twice: in vti_fb_tunnel_init()
    and in vti_tunnel_init(), this lead to a memory leak of
    dev->tstats.
    
    Just remove the duplicated operations in vti_fb_tunnel_init().
    
    (candidate for -stable)
    
    Cc: Stephen Hemminger <stephen@networkplumber.org>
    Cc: Saurabh Mohan <saurabh.mohan@vyatta.com>
    Cc: "David S. Miller" <davem@davemloft.net>
    Signed-off-by: Cong Wang <amwang@redhat.com>
    Acked-by: Stephen Hemminger <stephen@networkplumber.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv4/ip_vti.c |    7 -------
 1 files changed, 0 insertions(+), 7 deletions(-)

commit af9e57897a8fab9bbeceb984bd0aeaedb36aefcd
Author: Michal Schmidt <mschmidt@redhat.com>
Date:   Mon Jul 1 17:23:05 2013 +0200

    Upstream commit: 058eec4116935c5640299913e1e0715e87ec622a
    
    bnx2x: remove zeroing of dump data buffer
    
    There is no need to initialize the dump data with zeros.
    data is allocated with vzalloc, so it's already zero-filled.
    
    More importantly, the memset is harmful, because dump->len (the length
    requested by userspace) can be bigger than the allocated buffer (whose
    size is determined by asking the driver's .get_dump_flag method).
    
    Signed-off-by: Michal Schmidt <mschmidt@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 .../net/ethernet/broadcom/bnx2x/bnx2x_ethtool.c    |    2 --
 1 files changed, 0 insertions(+), 2 deletions(-)

commit c771072b72c261f9bddd6734dca6979c1b96e7df
Author: Michal Schmidt <mschmidt@redhat.com>
Date:   Mon Jul 1 17:23:06 2013 +0200

    Upstream commit: 5bb680d6cbe36de9d7ba12b05f845c91a8692318
    
    bnx2x: fix dump flag handling
    
    bnx2x interprets the dump flag as an index of a register preset.
    It is important to validate the index to avoid out of bounds
    memory accesses.
    
    Signed-off-by: Michal Schmidt <mschmidt@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 .../net/ethernet/broadcom/bnx2x/bnx2x_ethtool.c    |    3 +++
 drivers/net/ethernet/broadcom/bnx2x/bnx2x_main.c   |    2 ++
 2 files changed, 5 insertions(+), 0 deletions(-)

commit aed315c8fad9b2044143b46b239574b1b72135ce
Author: Michal Schmidt <mschmidt@redhat.com>
Date:   Mon Jul 1 17:23:30 2013 +0200

    Upstream commit: c590b5e2f05b5e98e614382582b7ae4cddb37599
    
    ethtool: make .get_dump_data() harder to misuse by drivers
    
    As the patch "bnx2x: remove zeroing of dump data buffer" showed,
    it is too easy implement .get_dump_data incorrectly in a driver.
    
    Let's make sure drivers cannot get confused by userspace requesting
    a too big dump.
    
    Also WARN if the driver sets dump->len to something weird and make
    sure the length reported to userspace is the actual length of data
    copied to userspace.
    
    Signed-off-by: Michal Schmidt <mschmidt@redhat.com>
    Reviewed-by: Ben Hutchings <ben@decadent.org.uk>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/core/ethtool.c |   21 ++++++++++++++++++++-
 1 files changed, 20 insertions(+), 1 deletions(-)

commit 5c57991e66216e386dcc875d34c33f0edd038569
Author: Wei Yongjun <yongjun_wei@trendmicro.com.cn>
Date:   Tue Jul 2 09:02:07 2013 +0800

    Upstream commit: e1558a93b61962710733dc8c11a2bc765607f1cd
    
    l2tp: add missing .owner to struct pppox_proto
    
    Add missing .owner of struct pppox_proto. This prevents the
    module from being removed from underneath its users.
    
    Signed-off-by: Wei Yongjun <yongjun_wei@trendmicro.com.cn>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/l2tp/l2tp_ppp.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 4613b8adae32cc774bb727d2ec71f3d0bd7ff1c4
Author: Benjamin Herrenschmidt <benh@kernel.crashing.org>
Date:   Sun Jun 30 14:37:11 2013 +1000

    Upstream commit: 7cc47d139f9a815a91bd9e7377063238c69a0423
    
    cxgb3: Missing rtnl lock in error recovery
    
    When exercising error injection on IBM pseries machine, I hit the
    following warning:
    
    [  251.450043] RTAS: event: 89, Type: Platform Error, Severity: 2
    [  253.549822] cxgb3 0006:01:00.0: enabling device (0140 -> 0142)
    [  253.713560] cxgb3 0006:01:00.0: adapter recovering, PEX ERR 0x100
    [  254.895437] RTNL: assertion failed at net/core/dev.c (2031)
    [  254.895467] CPU: 6 PID: 5449 Comm: eehd Tainted: G        W    3.10.0-rc7-00157-gea461ab #19
    [  254.895474] Call Trace:
    [  254.895483] [c000000fac56f7d0] [c000000000014dcc] .show_stack+0x7c/0x1f0 (unreliable)
    [  254.895493] [c000000fac56f8a0] [c0000000007ba318] .dump_stack+0x28/0x3c
    [  254.895500] [c000000fac56f910] [c0000000006c0384] .netif_set_real_num_tx_queues+0x224/0x230
    [  254.895515] [c000000fac56f9b0] [d00000000ef35510] .cxgb_open+0x80/0x3f0 [cxgb3]
    [  254.895525] [c000000fac56fa50] [d00000000ef35914] .t3_resume_ports+0x94/0x100 [cxgb3]
    [  254.895533] [c000000fac56fae0] [c00000000005fc8c] .eeh_report_resume+0x8c/0xd0
    [  254.895539] [c000000fac56fb60] [c00000000005e9fc] .eeh_pe_dev_traverse+0x9c/0x190
    [  254.895545] [c000000fac56fc10] [c000000000060000] .eeh_handle_event+0x110/0x330
    [  254.895551] [c000000fac56fca0] [c000000000060350] .eeh_event_handler+0x130/0x1a0
    [  254.895558] [c000000fac56fd30] [c0000000000ad758] .kthread+0xe8/0xf0
    [  254.895566] [c000000fac56fe30] [c00000000000a05c] .ret_from_kernel_thread+0x5c/0x80
    
    It appears that t3_resume_ports() is called with the rtnl_lock held from
    the fatal error task but not from the PCI error callbacks. This fixes it.
    
    Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/ethernet/chelsio/cxgb3/cxgb3_main.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit ea8f4222cddf3250dbcfc7db0437ebf74c352370
Author: Hannes Frederic Sowa <hannes@stressinduktion.org>
Date:   Mon Jul 1 20:21:30 2013 +0200

    Upstream commit: 8822b64a0fa64a5dd1dfcf837c5b0be83f8c05d1
    
    ipv6: call udp_push_pending_frames when uncorking a socket with AF_INET pending data
    
    We accidentally call down to ip6_push_pending_frames when uncorking
    pending AF_INET data on a ipv6 socket. This results in the following
    splat (from Dave Jones):
    
    skbuff: skb_under_panic: text:ffffffff816765f6 len:48 put:40 head:ffff88013deb6df0 data:ffff88013deb6dec tail:0x2c end:0xc0 dev:<NULL>
    ------------[ cut here ]------------
    kernel BUG at net/core/skbuff.c:126!
    invalid opcode: 0000 [#1] PREEMPT SMP DEBUG_PAGEALLOC
    Modules linked in: dccp_ipv4 dccp 8021q garp bridge stp dlci mpoa snd_seq_dummy sctp fuse hidp tun bnep nfnetlink scsi_transport_iscsi rfcomm can_raw can_bcm af_802154 appletalk caif_socket can caif ipt_ULOG x25 rose af_key pppoe pppox ipx phonet irda llc2 ppp_generic slhc p8023 psnap p8022 llc crc_ccitt atm bluetooth
    +netrom ax25 nfc rfkill rds af_rxrpc coretemp hwmon kvm_intel kvm crc32c_intel snd_hda_codec_realtek ghash_clmulni_intel microcode pcspkr snd_hda_codec_hdmi snd_hda_intel snd_hda_codec snd_hwdep usb_debug snd_seq snd_seq_device snd_pcm e1000e snd_page_alloc snd_timer ptp snd pps_core soundcore xfs libcrc32c
    CPU: 2 PID: 8095 Comm: trinity-child2 Not tainted 3.10.0-rc7+ #37
    task: ffff8801f52c2520 ti: ffff8801e6430000 task.ti: ffff8801e6430000
    RIP: 0010:[<ffffffff816e759c>]  [<ffffffff816e759c>] skb_panic+0x63/0x65
    RSP: 0018:ffff8801e6431de8  EFLAGS: 00010282
    RAX: 0000000000000086 RBX: ffff8802353d3cc0 RCX: 0000000000000006
    RDX: 0000000000003b90 RSI: ffff8801f52c2ca0 RDI: ffff8801f52c2520
    RBP: ffff8801e6431e08 R08: 0000000000000000 R09: 0000000000000000
    R10: 0000000000000001 R11: 0000000000000001 R12: ffff88022ea0c800
    R13: ffff88022ea0cdf8 R14: ffff8802353ecb40 R15: ffffffff81cc7800
    FS:  00007f5720a10740(0000) GS:ffff880244c00000(0000) knlGS:0000000000000000
    CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
    CR2: 0000000005862000 CR3: 000000022843c000 CR4: 00000000001407e0
    DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
    DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000600
    Stack:
     ffff88013deb6dec 000000000000002c 00000000000000c0 ffffffff81a3f6e4
     ffff8801e6431e18 ffffffff8159a9aa ffff8801e6431e90 ffffffff816765f6
     ffffffff810b756b 0000000700000002 ffff8801e6431e40 0000fea9292aa8c0
    Call Trace:
     [<ffffffff8159a9aa>] skb_push+0x3a/0x40
     [<ffffffff816765f6>] ip6_push_pending_frames+0x1f6/0x4d0
     [<ffffffff810b756b>] ? mark_held_locks+0xbb/0x140
     [<ffffffff81694919>] udp_v6_push_pending_frames+0x2b9/0x3d0
     [<ffffffff81694660>] ? udplite_getfrag+0x20/0x20
     [<ffffffff8162092a>] udp_lib_setsockopt+0x1aa/0x1f0
     [<ffffffff811cc5e7>] ? fget_light+0x387/0x4f0
     [<ffffffff816958a4>] udpv6_setsockopt+0x34/0x40
     [<ffffffff815949f4>] sock_common_setsockopt+0x14/0x20
     [<ffffffff81593c31>] SyS_setsockopt+0x71/0xd0
     [<ffffffff816f5d54>] tracesys+0xdd/0xe2
    Code: 00 00 48 89 44 24 10 8b 87 d8 00 00 00 48 89 44 24 08 48 8b 87 e8 00 00 00 48 c7 c7 c0 04 aa 81 48 89 04 24 31 c0 e8 e1 7e ff ff <0f> 0b 55 48 89 e5 0f 0b 55 48 89 e5 0f 0b 55 48 89 e5 0f 0b 55
    RIP  [<ffffffff816e759c>] skb_panic+0x63/0x65
     RSP <ffff8801e6431de8>
    
    This patch adds a check if the pending data is of address family AF_INET
    and directly calls udp_push_ending_frames from udp_v6_push_pending_frames
    if that is the case.
    
    This bug was found by Dave Jones with trinity.
    
    (Also move the initialization of fl6 below the AF_INET check, even if
    not strictly necessary.)
    
    Cc: Dave Jones <davej@redhat.com>
    Cc: YOSHIFUJI Hideaki <yoshfuji@linux-ipv6.org>
    Signed-off-by: Hannes Frederic Sowa <hannes@stressinduktion.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 include/net/udp.h |    1 +
 net/ipv4/udp.c    |    3 ++-
 net/ipv6/udp.c    |    7 ++++++-
 3 files changed, 9 insertions(+), 2 deletions(-)

commit cd83094a85d9bbd5a67332156407d53cf8835432
Author: Hannes Frederic Sowa <hannes@stressinduktion.org>
Date:   Tue Jul 2 08:04:05 2013 +0200

    Upstream commit: 75a493e60ac4bbe2e977e7129d6d8cbb0dd236be
    
    ipv6: ip6_append_data_mtu did not care about pmtudisc and frag_size
    
    If the socket had an IPV6_MTU value set, ip6_append_data_mtu lost track
    of this when appending the second frame on a corked socket. This results
    in the following splat:
    
    [37598.993962] ------------[ cut here ]------------
    [37598.994008] kernel BUG at net/core/skbuff.c:2064!
    [37598.994008] invalid opcode: 0000 [#1] SMP
    [37598.994008] Modules linked in: tcp_lp uvcvideo videobuf2_vmalloc videobuf2_memops videobuf2_core videodev media vfat fat usb_storage fuse ebtable_nat xt_CHECKSUM bridge stp llc ipt_MASQUERADE nf_conntrack_netbios_ns nf_conntrack_broadcast ip6table_mangle ip6t_REJECT nf_conntrack_ipv6 nf_defrag_ipv6 iptable_nat
    +nf_nat_ipv4 nf_nat iptable_mangle nf_conntrack_ipv4 nf_defrag_ipv4 xt_conntrack nf_conntrack ebtable_filter ebtables ip6table_filter ip6_tables be2iscsi iscsi_boot_sysfs bnx2i cnic uio cxgb4i cxgb4 cxgb3i cxgb3 mdio libcxgbi ib_iser rdma_cm ib_addr iw_cm ib_cm ib_sa ib_mad ib_core iscsi_tcp libiscsi_tcp libiscsi
    +scsi_transport_iscsi rfcomm bnep iTCO_wdt iTCO_vendor_support snd_hda_codec_conexant arc4 iwldvm mac80211 snd_hda_intel acpi_cpufreq mperf coretemp snd_hda_codec microcode cdc_wdm cdc_acm
    [37598.994008]  snd_hwdep cdc_ether snd_seq snd_seq_device usbnet mii joydev btusb snd_pcm bluetooth i2c_i801 e1000e lpc_ich mfd_core ptp iwlwifi pps_core snd_page_alloc mei cfg80211 snd_timer thinkpad_acpi snd tpm_tis soundcore rfkill tpm tpm_bios vhost_net tun macvtap macvlan kvm_intel kvm uinput binfmt_misc
    +dm_crypt i915 i2c_algo_bit drm_kms_helper drm i2c_core wmi video
    [37598.994008] CPU 0
    [37598.994008] Pid: 27320, comm: t2 Not tainted 3.9.6-200.fc18.x86_64 #1 LENOVO 27744PG/27744PG
    [37598.994008] RIP: 0010:[<ffffffff815443a5>]  [<ffffffff815443a5>] skb_copy_and_csum_bits+0x325/0x330
    [37598.994008] RSP: 0018:ffff88003670da18  EFLAGS: 00010202
    [37598.994008] RAX: ffff88018105c018 RBX: 0000000000000004 RCX: 00000000000006c0
    [37598.994008] RDX: ffff88018105a6c0 RSI: ffff88018105a000 RDI: ffff8801e1b0aa00
    [37598.994008] RBP: ffff88003670da78 R08: 0000000000000000 R09: ffff88018105c040
    [37598.994008] R10: ffff8801e1b0aa00 R11: 0000000000000000 R12: 000000000000fff8
    [37598.994008] R13: 00000000000004fc R14: 00000000ffff0504 R15: 0000000000000000
    [37598.994008] FS:  00007f28eea59740(0000) GS:ffff88023bc00000(0000) knlGS:0000000000000000
    [37598.994008] CS:  0010 DS: 0000 ES: 0000 CR0: 000000008005003b
    [37598.994008] CR2: 0000003d935789e0 CR3: 00000000365cb000 CR4: 00000000000407f0
    [37598.994008] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
    [37598.994008] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400
    [37598.994008] Process t2 (pid: 27320, threadinfo ffff88003670c000, task ffff88022c162ee0)
    [37598.994008] Stack:
    [37598.994008]  ffff88022e098a00 ffff88020f973fc0 0000000000000008 00000000000004c8
    [37598.994008]  ffff88020f973fc0 00000000000004c4 ffff88003670da78 ffff8801e1b0a200
    [37598.994008]  0000000000000018 00000000000004c8 ffff88020f973fc0 00000000000004c4
    [37598.994008] Call Trace:
    [37598.994008]  [<ffffffff815fc21f>] ip6_append_data+0xccf/0xfe0
    [37598.994008]  [<ffffffff8158d9f0>] ? ip_copy_metadata+0x1a0/0x1a0
    [37598.994008]  [<ffffffff81661f66>] ? _raw_spin_lock_bh+0x16/0x40
    [37598.994008]  [<ffffffff8161548d>] udpv6_sendmsg+0x1ed/0xc10
    [37598.994008]  [<ffffffff812a2845>] ? sock_has_perm+0x75/0x90
    [37598.994008]  [<ffffffff815c3693>] inet_sendmsg+0x63/0xb0
    [37598.994008]  [<ffffffff812a2973>] ? selinux_socket_sendmsg+0x23/0x30
    [37598.994008]  [<ffffffff8153a450>] sock_sendmsg+0xb0/0xe0
    [37598.994008]  [<ffffffff810135d1>] ? __switch_to+0x181/0x4a0
    [37598.994008]  [<ffffffff8153d97d>] sys_sendto+0x12d/0x180
    [37598.994008]  [<ffffffff810dfb64>] ? __audit_syscall_entry+0x94/0xf0
    [37598.994008]  [<ffffffff81020ed1>] ? syscall_trace_enter+0x231/0x240
    [37598.994008]  [<ffffffff8166a7e7>] tracesys+0xdd/0xe2
    [37598.994008] Code: fe 07 00 00 48 c7 c7 04 28 a6 81 89 45 a0 4c 89 4d b8 44 89 5d a8 e8 1b ac b1 ff 44 8b 5d a8 4c 8b 4d b8 8b 45 a0 e9 cf fe ff ff <0f> 0b 66 0f 1f 84 00 00 00 00 00 66 66 66 66 90 55 48 89 e5 48
    [37598.994008] RIP  [<ffffffff815443a5>] skb_copy_and_csum_bits+0x325/0x330
    [37598.994008]  RSP <ffff88003670da18>
    [37599.007323] ---[ end trace d69f6a17f8ac8eee ]---
    
    While there, also check if path mtu discovery is activated for this
    socket. The logic was adapted from ip6_append_data when first writing
    on the corked socket.
    
    This bug was introduced with commit
    0c1833797a5a6ec23ea9261d979aa18078720b74 ("ipv6: fix incorrect ipsec
    fragment").
    
    v2:
    a) Replace IPV6_PMTU_DISC_DO with IPV6_PMTUDISC_PROBE.
    b) Don't pass ipv6_pinfo to ip6_append_data_mtu (suggestion by Gao
       feng, thanks!).
    c) Change mtu to unsigned int, else we get a warning about
       non-matching types because of the min()-macro type-check.
    
    Acked-by: Gao feng <gaofeng@cn.fujitsu.com>
    Cc: YOSHIFUJI Hideaki <yoshfuji@linux-ipv6.org>
    Signed-off-by: Hannes Frederic Sowa <hannes@stressinduktion.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv6/ip6_output.c |   16 ++++++++++------
 1 files changed, 10 insertions(+), 6 deletions(-)

commit 23151ca7ca80e58d2616dac7be9fd62943c9a72c
Author: Michael S. Tsirkin <mst@redhat.com>
Date:   Sun Jul 7 14:26:53 2013 +0300

    Upstream commit: dd7633ecd553a5e304d349aa6f8eb8a0417098c5
    
    vhost-net: fix use-after-free in vhost_net_flush
    
    vhost_net_ubuf_put_and_wait has a confusing name:
    it will actually also free it's argument.
    Thus since commit 1280c27f8e29acf4af2da914e80ec27c3dbd5c01
        "vhost-net: flush outstanding DMAs on memory change"
    vhost_net_flush tries to use the argument after passing it
    to vhost_net_ubuf_put_and_wait, this results
    in use after free.
    To fix, don't free the argument in vhost_net_ubuf_put_and_wait,
    add an new API for callers that want to free ubufs.
    
    Acked-by: Asias He <asias@redhat.com>
    Acked-by: Jason Wang <jasowang@redhat.com>
    Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/vhost/net.c |    9 +++++++--
 1 files changed, 7 insertions(+), 2 deletions(-)

commit 088806db74ac2f08c106202bc5498585a9ee529f
Author: Michal Hocko <mhocko@suse.cz>
Date:   Mon Jul 8 16:00:29 2013 -0700

    Upstream commit: f37a96914d1aea10fed8d9af10251f0b9caea31b
    
    memcg, kmem: fix reference count handling on the error path
    
    mem_cgroup_css_online calls mem_cgroup_put if memcg_init_kmem fails.
    This is not correct because only memcg_propagate_kmem takes an
    additional reference while mem_cgroup_sockets_init is allowed to fail as
    well (although no current implementation fails) but it doesn't take any
    reference.  This all suggests that it should be memcg_propagate_kmem
    that should clean up after itself so this patch moves mem_cgroup_put
    over there.
    
    Unfortunately this is not that easy (as pointed out by Li Zefan) because
    memcg_kmem_mark_dead marks the group dead (KMEM_ACCOUNTED_DEAD) if it is
    marked active (KMEM_ACCOUNTED_ACTIVE) which is the case even if
    memcg_propagate_kmem fails so the additional reference is dropped in
    that case in kmem_cgroup_destroy which means that the reference would be
    dropped two times.
    
    The easiest way then would be to simply remove mem_cgrroup_put from
    mem_cgroup_css_online and rely on kmem_cgroup_destroy doing the right
    thing.
    
    Signed-off-by: Michal Hocko <mhocko@suse.cz>
    Signed-off-by: Li Zefan <lizefan@huawei.com>
    Acked-by: KAMEZAWA Hiroyuki <kamezawa.hiroyu@jp.fujitsu.com>
    Cc: Hugh Dickins <hughd@google.com>
    Cc: Tejun Heo <tj@kernel.org>
    Cc: Glauber Costa <glommer@openvz.org>
    Cc: Johannes Weiner <hannes@cmpxchg.org>
    Cc: <stable@vger.kernel.org>	[3.8]
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/memcontrol.c |    8 --------
 1 files changed, 0 insertions(+), 8 deletions(-)

commit 08bfb6e700d13886ed722c2236e1ec10f03a95df
Author: Michal Hocko <mhocko@suse.cz>
Date:   Mon Jul 8 16:00:27 2013 -0700

    Upstream commit: fa460c2d37870e0a6f94c70e8b76d05ca11b6db0
    
    Revert "memcg: avoid dangling reference count in creation failure"
    
    This reverts commit e4715f01be697a.
    
    mem_cgroup_put is hierarchy aware so mem_cgroup_put(memcg) already drops
    an additional reference from all parents so the additional
    mem_cgrroup_put(parent) potentially causes use-after-free.
    
    Signed-off-by: Michal Hocko <mhocko@suse.cz>
    Signed-off-by: Li Zefan <lizefan@huawei.com>
    Acked-by: KAMEZAWA Hiroyuki <kamezawa.hiroyu@jp.fujitsu.com>
    Cc: Hugh Dickins <hughd@google.com>
    Cc: Tejun Heo <tj@kernel.org>
    Cc: Glauber Costa <glommer@openvz.org>
    Cc: Johannes Weiner <hannes@cmpxchg.org>
    Cc: <stable@vger.kernel.org>	[3.9+]
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/memcontrol.c |    2 --
 1 files changed, 0 insertions(+), 2 deletions(-)

commit 3267ec559f48327a1836eccecd53215afc5810d0
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Thu Jun 20 13:13:59 2013 -0700

    Upstream commit: 2cb33cac622afde897aa02d3dcd9fbba8bae839e
    
    libceph: Fix NULL pointer dereference in auth client code
    
    A malicious monitor can craft an auth reply message that could cause a
    NULL function pointer dereference in the client's kernel.
    
    To prevent this, the auth_none protocol handler needs an empty
    ceph_auth_client_ops->build_request() function.
    
    CVE-2013-1059
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Reported-by: Chanam Park <chanam.park@hkpco.kr>
    Reviewed-by: Seth Arnold <seth.arnold@canonical.com>
    Reviewed-by: Sage Weil <sage@inktank.com>
    Cc: stable@vger.kernel.org

 net/ceph/auth_none.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

commit cdfeb4049e7cb38702215b2c356ce0407974ac79
Author: Eric Paris <eparis@redhat.com>
Date:   Wed Jul 3 15:08:29 2013 -0700

    Upstream commit: b57922b6c76c3ee401bb32fd3f298409dd6e6a53
    
    fork: reorder permissions when violating number of processes limits
    
    When a task is attempting to violate the RLIMIT_NPROC limit we have a
    check to see if the task is sufficiently priviledged.  The check first
    looks at CAP_SYS_ADMIN, then CAP_SYS_RESOURCE, then if the task is uid=0.
    
    A result is that tasks which are allowed by the uid=0 check are first
    checked against the security subsystem.  This results in the security
    subsystem auditting a denial for sys_admin and sys_resource and then the
    task passing the uid=0 check.
    
    This patch rearranges the code to first check uid=0, since if we pass that
    we shouldn't hit the security system at all.  We then check sys_resource,
    since it is the smallest capability which will solve the problem.  Lastly
    we check the fallback everything cap_sysadmin.  We don't want to give this
    capability many places since it is so powerful.
    
    This will eliminate many of the false positive/needless denial messages we
    get when a root task tries to violate the nproc limit.  (note that
    kthreads count against root, so on a sufficiently large machine we can
    actually get past the default limits before any userspace tasks are
    launched.)
    
    Signed-off-by: Eric Paris <eparis@redhat.com>
    Cc: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 kernel/fork.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 08c87e049c8a50707908785d950fd48c334f4c09
Author: Chen Gang <gang.chen@asianux.com>
Date:   Sat Jun 22 13:26:09 2013 +0800

    Upstream commit: f118e9abddfae94d7ef88858159d7556e1c2f7f6
    
    arch: sparc: kernel: check the memory length before use strcpy().
    
    For the related next strcpy(), the destination length is less than 512,
    but the source maximize length may be 'OPROMMAXPARAM' (4096) which is
    more than 512.
    
    One work flow may:
      openprom_sunos_ioctl() ->  if (cmd == OPROMSETOPT)
        getstrings() ->  will alloc buffer with size 'OPROMMAXPARAM'.
        opromsetopt() ->  devide the buffer into 'var' and 'value'
          of_set_property() -> pass
            prom_setprop() -> pass
              ldom_set_var()
    
    And do not mind the additional 4 alignment buffer increasing, since
    'sizeof(pkt) - sizeof(pkt.header)' is 4 alignment at least.
    
    Signed-off-by: Chen Gang <gang.chen@asianux.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 arch/sparc/kernel/ds.c |   10 ++++++++++
 1 files changed, 10 insertions(+), 0 deletions(-)

commit 0f5d7e1171c65a8d4e9186b3656e1206121efb13
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jul 12 20:38:45 2013 -0400

    Fix SLAB boot errors due to PAX_USERCOPY reported on the forums
    
    Unlike slub, slab can initally create two of the kmalloc_caches
    which will be used later for generic kmallocs of their particular
    aligned size (since the later loop in the unified allocator code
    skips any already-existing kmalloc_caches)

 mm/slab.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 7afc9d07a4c0a676aa5c4ac2b30882f60be6bae3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 9 22:04:59 2013 -0400

    compile fixes

 fs/exec.c |    2 +-
 mm/mmap.c |    4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

commit e2d027c7e0f106be683c0c72482b8285daefcbe6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 9 20:58:40 2013 -0400

    commit successful merges

 Documentation/kernel-parameters.txt                |    4 +
 Makefile                                           |    8 +-
 arch/alpha/include/asm/cache.h                     |    4 +-
 arch/alpha/kernel/osf_sys.c                        |   12 +-
 arch/arm/include/asm/thread_info.h                 |    3 +-
 arch/arm/kernel/ptrace.c                           |    9 +
 arch/arm/kernel/traps.c                            |    7 +-
 arch/arm/mm/fault.c                                |   29 +-
 arch/arm/mm/mmap.c                                 |    8 +-
 arch/avr32/include/asm/cache.h                     |    4 +-
 arch/blackfin/include/asm/cache.h                  |    3 +-
 arch/cris/include/arch-v10/arch/cache.h            |    3 +-
 arch/cris/include/arch-v32/arch/cache.h            |    3 +-
 arch/frv/include/asm/cache.h                       |    3 +-
 arch/frv/mm/elf-fdpic.c                            |    4 +-
 arch/hexagon/include/asm/cache.h                   |    6 +-
 arch/ia64/include/asm/cache.h                      |    3 +-
 arch/ia64/kernel/sys_ia64.c                        |    2 +
 arch/ia64/mm/hugetlbpage.c                         |    2 +
 arch/m32r/include/asm/cache.h                      |    4 +-
 arch/m68k/include/asm/cache.h                      |    4 +-
 arch/metag/mm/hugetlbpage.c                        |    1 +
 arch/microblaze/include/asm/cache.h                |    3 +-
 arch/mips/include/asm/cache.h                      |    3 +-
 arch/mips/include/asm/thread_info.h                |    9 +-
 arch/mips/kernel/ptrace.c                          |    9 +
 arch/mips/kernel/scall32-o32.S                     |    2 +-
 arch/mips/kernel/scall64-64.S                      |    2 +-
 arch/mips/kernel/scall64-n32.S                     |    2 +-
 arch/mips/kernel/scall64-o32.S                     |    2 +-
 arch/mips/mm/mmap.c                                |    4 +-
 arch/mn10300/proc-mn103e010/include/proc/cache.h   |    4 +-
 arch/mn10300/proc-mn2ws0050/include/proc/cache.h   |    4 +-
 arch/openrisc/include/asm/cache.h                  |    4 +-
 arch/parisc/include/asm/cache.h                    |    5 +-
 arch/parisc/kernel/sys_parisc.c                    |   17 +-
 arch/powerpc/include/asm/cache.h                   |    3 +-
 arch/powerpc/kernel/process.c                      |   10 +-
 arch/powerpc/kernel/ptrace.c                       |   14 +
 arch/powerpc/kernel/traps.c                        |    5 +
 arch/s390/include/asm/cache.h                      |    4 +-
 arch/score/include/asm/cache.h                     |    4 +-
 arch/sh/include/asm/cache.h                        |    3 +-
 arch/sh/mm/mmap.c                                  |    6 +-
 arch/sparc/include/asm/cache.h                     |    4 +-
 arch/sparc/include/asm/thread_info_64.h            |    9 +-
 arch/sparc/kernel/process_32.c                     |    6 +-
 arch/sparc/kernel/process_64.c                     |    4 +-
 arch/sparc/kernel/ptrace_64.c                      |   14 +
 arch/sparc/kernel/sys_sparc_64.c                   |    8 +-
 arch/sparc/kernel/syscalls.S                       |    8 +-
 arch/sparc/kernel/traps_32.c                       |    8 +-
 arch/sparc/kernel/traps_64.c                       |   28 +-
 arch/sparc/kernel/unaligned_64.c                   |    2 +-
 arch/sparc/mm/fault_64.c                           |    2 +-
 arch/sparc/mm/hugetlbpage.c                        |    3 +-
 arch/tile/include/asm/cache.h                      |    3 +-
 arch/tile/mm/hugetlbpage.c                         |    2 +
 arch/um/defconfig                                  |    1 -
 arch/um/include/asm/cache.h                        |    3 +-
 arch/unicore32/include/asm/cache.h                 |    6 +-
 arch/x86/Kconfig                                   |    5 +-
 arch/x86/ia32/ia32_aout.c                          |    2 +
 arch/x86/include/asm/thread_info.h                 |    8 +-
 arch/x86/kernel/dumpstack.c                        |    8 +
 arch/x86/kernel/entry_32.S                         |    2 +-
 arch/x86/kernel/entry_64.S                         |    2 +-
 arch/x86/kernel/ioport.c                           |   13 +
 arch/x86/kernel/ptrace.c                           |   14 +
 arch/x86/kernel/signal.c                           |    9 +-
 arch/x86/kernel/smpboot.c                          |    3 +
 arch/x86/kernel/sys_i386_32.c                      |    9 +-
 arch/x86/kernel/sys_x86_64.c                       |    8 +-
 arch/x86/kernel/verify_cpu.S                       |    1 +
 arch/x86/kernel/vm86_32.c                          |    1 +
 arch/x86/mm/fault.c                                |   12 +-
 arch/x86/mm/hugetlbpage.c                          |   15 +-
 arch/x86/mm/init.c                                 |   66 +-
 arch/x86/net/bpf_jit_comp.c                        |  129 +-
 arch/xtensa/variants/dc232b/include/variant/core.h |    2 +-
 arch/xtensa/variants/fsf/include/variant/core.h    |    3 +-
 arch/xtensa/variants/s6000/include/variant/core.h  |    3 +-
 drivers/block/cciss.c                              |    2 +
 drivers/block/cpqarray.c                           |    1 +
 drivers/cdrom/cdrom.c                              |    4 +-
 drivers/char/Kconfig                               |    4 +-
 drivers/char/genrtc.c                              |    1 +
 drivers/char/mem.c                                 |   17 +
 drivers/char/mwave/tp3780i.c                       |    1 +
 drivers/char/random.c                              |   12 +
 drivers/gpu/drm/drm_info.c                         |    4 +
 drivers/hid/hid-wiimote-debug.c                    |    2 +-
 drivers/media/radio/radio-cadet.c                  |    2 +-
 drivers/message/fusion/mptbase.c                   |    9 +
 drivers/net/bonding/bond_main.c                    |    2 +-
 drivers/net/phy/mdio-bitbang.c                     |    1 +
 drivers/net/wireless/zd1211rw/zd_usb.c             |    2 +-
 drivers/pci/proc.c                                 |    9 +
 drivers/rtc/rtc-dev.c                              |    3 +
 drivers/tty/sysrq.c                                |    2 +-
 drivers/tty/vt/keyboard.c                          |   22 +-
 drivers/video/logo/logo_linux_clut224.ppm          | 2721 ++++++++------------
 drivers/xen/xenfs/xenstored.c                      |    5 +
 fs/attr.c                                          |    1 +
 fs/autofs4/waitq.c                                 |    9 +
 fs/binfmt_aout.c                                   |    7 +
 fs/binfmt_elf.c                                    |    8 +-
 fs/btrfs/ioctl.c                                   |    6 +-
 fs/compat.c                                        |   20 +-
 fs/coredump.c                                      |    9 +-
 fs/debugfs/inode.c                                 |    4 +
 fs/exec.c                                          |  184 ++-
 fs/ext2/balloc.c                                   |    4 +-
 fs/ext3/balloc.c                                   |    4 +-
 fs/ext4/resize.c                                   |   17 +-
 fs/fcntl.c                                         |    5 +
 fs/file.c                                          |    4 +
 fs/filesystems.c                                   |    4 +
 fs/fs_struct.c                                     |   13 +-
 fs/hugetlbfs/inode.c                               |    5 +-
 fs/namei.c                                         |  234 ++-
 fs/namespace.c                                     |   16 +
 fs/notify/fanotify/fanotify_user.c                 |    1 +
 fs/open.c                                          |   38 +
 fs/proc/Kconfig                                    |   10 +-
 fs/proc/array.c                                    |   59 +-
 fs/proc/base.c                                     |  168 ++-
 fs/proc/cmdline.c                                  |    4 +
 fs/proc/devices.c                                  |    4 +
 fs/proc/fd.c                                       |   17 +-
 fs/proc/inode.c                                    |    4 +
 fs/proc/kcore.c                                    |    3 +
 fs/proc/proc_net.c                                 |   12 +
 fs/proc/proc_sysctl.c                              |   43 +-
 fs/proc/root.c                                     |    8 +
 fs/proc/task_mmu.c                                 |   75 +-
 fs/readdir.c                                       |   19 +
 fs/select.c                                        |    2 +
 fs/seq_file.c                                      |   12 +-
 fs/stat.c                                          |   19 +-
 fs/sysfs/dir.c                                     |   12 +
 fs/utimes.c                                        |    7 +
 fs/xattr.c                                         |   19 +-
 include/linux/capability.h                         |    5 +
 include/linux/cred.h                               |    3 +
 include/linux/fs.h                                 |   10 +
 include/linux/fsnotify.h                           |    6 +
 include/linux/kallsyms.h                           |   14 +-
 include/linux/kmod.h                               |    2 +
 include/linux/mm.h                                 |    1 +
 include/linux/perf_event.h                         |   13 +-
 include/linux/printk.h                             |    3 +-
 include/linux/sched.h                              |   24 +-
 include/linux/security.h                           |    1 +
 include/linux/seq_file.h                           |    3 +
 include/linux/shm.h                                |    4 +
 include/linux/skbuff.h                             |    3 +
 include/linux/slab.h                               |    9 -
 include/linux/sysctl.h                             |    2 +
 include/linux/thread_info.h                        |    2 +
 include/linux/uidgid.h                             |    5 +
 include/linux/vermagic.h                           |    9 +-
 include/uapi/linux/personality.h                   |    1 +
 init/Kconfig                                       |    3 +-
 init/main.c                                        |   14 +
 ipc/mqueue.c                                       |    1 +
 ipc/shm.c                                          |   28 +
 kernel/capability.c                                |   39 +-
 kernel/cgroup.c                                    |    2 +-
 kernel/compat.c                                    |    1 +
 kernel/configs.c                                   |   11 +
 kernel/cred.c                                      |  110 +-
 kernel/events/core.c                               |   14 +-
 kernel/exit.c                                      |   10 +-
 kernel/fork.c                                      |   41 +-
 kernel/futex.c                                     |    1 +
 kernel/kallsyms.c                                  |    9 +
 kernel/kcmp.c                                      |    4 +
 kernel/kmod.c                                      |   64 +-
 kernel/kprobes.c                                   |    4 +-
 kernel/ksysfs.c                                    |    2 +
 kernel/lockdep_proc.c                              |   10 +-
 kernel/module.c                                    |   81 +-
 kernel/panic.c                                     |    2 +-
 kernel/pid.c                                       |   19 +-
 kernel/posix-timers.c                              |    7 +
 kernel/printk.c                                    |    5 +
 kernel/ptrace.c                                    |   20 +-
 kernel/resource.c                                  |   10 +
 kernel/sched/core.c                                |    6 +-
 kernel/signal.c                                    |   37 +-
 kernel/sys.c                                       |   45 +-
 kernel/sysctl.c                                    |   70 +-
 kernel/taskstats.c                                 |    6 +
 kernel/time.c                                      |    5 +
 kernel/time/timekeeping.c                          |    1 +
 kernel/time/timer_list.c                           |   12 +
 kernel/time/timer_stats.c                          |   10 +-
 lib/Kconfig.debug                                  |    5 +-
 lib/is_single_threaded.c                           |    3 +
 mm/Kconfig                                         |    4 +-
 mm/filemap.c                                       |    1 +
 mm/kmemleak.c                                      |    4 +-
 mm/mempolicy.c                                     |   12 +-
 mm/migrate.c                                       |    3 +-
 mm/mlock.c                                         |    3 +
 mm/mmap.c                                          |   63 +-
 mm/mprotect.c                                      |    8 +
 mm/process_vm_access.c                             |    6 +
 mm/slab.c                                          |    2 +-
 mm/slub.c                                          |   14 +-
 mm/vmalloc.c                                       |    4 +
 mm/vmstat.c                                        |   18 +-
 net/core/dev_ioctl.c                               |    4 +
 net/core/sock_diag.c                               |    7 +
 net/ipv4/inet_hashtables.c                         |    5 +
 net/ipv4/ip_sockglue.c                             |    3 +-
 net/ipv4/tcp_input.c                               |    4 +-
 net/ipv4/tcp_ipv4.c                                |   24 +-
 net/ipv4/tcp_minisocks.c                           |    9 +-
 net/ipv4/tcp_timer.c                               |   11 +
 net/ipv4/udp.c                                     |   24 +
 net/ipv6/tcp_ipv6.c                                |   23 +-
 net/ipv6/udp.c                                     |    4 +
 net/netfilter/Kconfig                              |   10 +
 net/netfilter/Makefile                             |    1 +
 net/netfilter/nf_conntrack_core.c                  |    8 +
 net/netrom/af_netrom.c                             |    1 -
 net/phonet/af_phonet.c                             |    2 +-
 net/sctp/proc.c                                    |    3 +-
 net/socket.c                                       |   66 +-
 net/sysctl_net.c                                   |    2 +-
 net/unix/af_unix.c                                 |   31 +-
 security/Kconfig                                   |  343 +++-
 security/apparmor/Kconfig                          |    9 +
 security/apparmor/apparmorfs.c                     |  231 ++
 security/commoncap.c                               |   29 +
 security/min_addr.c                                |    2 +
 security/security.c                                |    2 -
 security/selinux/hooks.c                           |    2 -
 security/tomoyo/mount.c                            |    4 +
 security/yama/Kconfig                              |    2 +-
 242 files changed, 4385 insertions(+), 2042 deletions(-)

commit 043a378c0f72ed92cc30182c48abce39867ac93f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 9 20:57:40 2013 -0400

    Commit merge of new files and rejected patches

 arch/arm/include/asm/thread_info.h     |    6 +-
 arch/arm/kernel/process.c              |    4 +-
 arch/powerpc/include/asm/thread_info.h |    7 +-
 arch/powerpc/mm/slice.c                |    2 +-
 arch/sparc/kernel/process_64.c         |    4 +-
 arch/x86/kernel/vm86_32.c              |   15 +
 fs/coredump.c                          |    1 +
 fs/ext4/balloc.c                       |    4 +-
 fs/namei.c                             |    7 +
 fs/namespace.c                         |    8 +
 fs/pipe.c                              |    2 +-
 fs/proc/inode.c                        |   13 +
 fs/proc/internal.h                     |    3 +
 grsecurity/Kconfig                     | 1054 +++++++++
 grsecurity/Makefile                    |   38 +
 grsecurity/gracl.c                     | 4073 ++++++++++++++++++++++++++++++++
 grsecurity/gracl_alloc.c               |  105 +
 grsecurity/gracl_cap.c                 |  110 +
 grsecurity/gracl_fs.c                  |  431 ++++
 grsecurity/gracl_ip.c                  |  387 +++
 grsecurity/gracl_learn.c               |  207 ++
 grsecurity/gracl_res.c                 |   68 +
 grsecurity/gracl_segv.c                |  305 +++
 grsecurity/gracl_shm.c                 |   40 +
 grsecurity/grsec_chdir.c               |   19 +
 grsecurity/grsec_chroot.c              |  370 +++
 grsecurity/grsec_disabled.c            |  434 ++++
 grsecurity/grsec_exec.c                |  187 ++
 grsecurity/grsec_fifo.c                |   24 +
 grsecurity/grsec_fork.c                |   23 +
 grsecurity/grsec_init.c                |  283 +++
 grsecurity/grsec_link.c                |   58 +
 grsecurity/grsec_log.c                 |  326 +++
 grsecurity/grsec_mem.c                 |   40 +
 grsecurity/grsec_mount.c               |   62 +
 grsecurity/grsec_pax.c                 |   36 +
 grsecurity/grsec_ptrace.c              |   30 +
 grsecurity/grsec_sig.c                 |  246 ++
 grsecurity/grsec_sock.c                |  244 ++
 grsecurity/grsec_sysctl.c              |  469 ++++
 grsecurity/grsec_time.c                |   16 +
 grsecurity/grsec_tpe.c                 |   73 +
 grsecurity/grsum.c                     |   61 +
 include/linux/gracl.h                  |  319 +++
 include/linux/gralloc.h                |    9 +
 include/linux/grdefs.h                 |  140 ++
 include/linux/grinternal.h             |  227 ++
 include/linux/grmsg.h                  |  112 +
 include/linux/grsecurity.h             |  241 ++
 include/linux/grsock.h                 |   19 +
 include/linux/netfilter/xt_gradm.h     |    9 +
 include/linux/proc_fs.h                |   13 +
 include/linux/sched.h                  |   48 +-
 include/trace/events/fs.h              |   53 +
 kernel/kmod.c                          |    7 +-
 kernel/panic.c                         |    2 +-
 kernel/posix-timers.c                  |    1 +
 kernel/time/timekeeping.c              |    2 +
 lib/Kconfig.debug                      |    2 +-
 lib/vsprintf.c                         |   31 +
 localversion-grsec                     |    1 +
 mm/mmap.c                              |   13 +-
 mm/shmem.c                             |    2 +-
 net/core/net-procfs.c                  |    5 +
 net/ipv6/udp.c                         |    3 +
 net/netfilter/xt_gradm.c               |   51 +
 66 files changed, 11184 insertions(+), 21 deletions(-)

commit 75a36f058b5abbc82f9b94ba5576eef4b40cd5d6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 9 17:35:47 2013 -0400

    Initial import of pax-linux-3.10-test1.patch

 Documentation/dontdiff                             |   46 +-
 Documentation/kernel-parameters.txt                |   12 +
 Makefile                                           |  100 +-
 arch/alpha/include/asm/atomic.h                    |   10 +
 arch/alpha/include/asm/elf.h                       |    7 +
 arch/alpha/include/asm/pgalloc.h                   |    6 +
 arch/alpha/include/asm/pgtable.h                   |   11 +
 arch/alpha/kernel/module.c                         |    2 +-
 arch/alpha/kernel/osf_sys.c                        |    8 +-
 arch/alpha/mm/fault.c                              |  141 +-
 arch/arm/Kconfig                                   |    2 +-
 arch/arm/include/asm/atomic.h                      |  444 ++-
 arch/arm/include/asm/cache.h                       |    5 +-
 arch/arm/include/asm/cacheflush.h                  |    2 +-
 arch/arm/include/asm/checksum.h                    |   14 +-
 arch/arm/include/asm/cmpxchg.h                     |    2 +
 arch/arm/include/asm/domain.h                      |   33 +-
 arch/arm/include/asm/elf.h                         |   13 +-
 arch/arm/include/asm/fncpy.h                       |    2 +
 arch/arm/include/asm/futex.h                       |   10 +
 arch/arm/include/asm/kmap_types.h                  |    2 +-
 arch/arm/include/asm/mach/dma.h                    |    2 +-
 arch/arm/include/asm/mach/map.h                    |    7 +-
 arch/arm/include/asm/outercache.h                  |    2 +-
 arch/arm/include/asm/page.h                        |    2 +-
 arch/arm/include/asm/pgalloc.h                     |   22 +-
 arch/arm/include/asm/pgtable-2level-hwdef.h        |    5 +
 arch/arm/include/asm/pgtable-2level.h              |    1 +
 arch/arm/include/asm/pgtable-3level-hwdef.h        |    2 +
 arch/arm/include/asm/pgtable-3level.h              |    2 +
 arch/arm/include/asm/pgtable.h                     |   56 +-
 arch/arm/include/asm/proc-fns.h                    |    2 +-
 arch/arm/include/asm/processor.h                   |    5 +-
 arch/arm/include/asm/psci.h                        |    2 +-
 arch/arm/include/asm/smp.h                         |    2 +-
 arch/arm/include/asm/thread_info.h                 |    6 +-
 arch/arm/include/asm/uaccess.h                     |   92 +-
 arch/arm/include/uapi/asm/ptrace.h                 |    2 +-
 arch/arm/kernel/armksyms.c                         |    8 +-
 arch/arm/kernel/entry-armv.S                       |  107 +-
 arch/arm/kernel/entry-common.S                     |   41 +-
 arch/arm/kernel/entry-header.S                     |   60 +
 arch/arm/kernel/fiq.c                              |    2 +
 arch/arm/kernel/head.S                             |    6 +-
 arch/arm/kernel/hw_breakpoint.c                    |    2 +-
 arch/arm/kernel/module.c                           |   29 +-
 arch/arm/kernel/patch.c                            |    2 +
 arch/arm/kernel/perf_event_cpu.c                   |    2 +-
 arch/arm/kernel/process.c                          |   14 +-
 arch/arm/kernel/psci.c                             |    2 +-
 arch/arm/kernel/setup.c                            |   22 +-
 arch/arm/kernel/signal.c                           |   24 +-
 arch/arm/kernel/smp.c                              |    2 +-
 arch/arm/kernel/traps.c                            |   15 +-
 arch/arm/kernel/vmlinux.lds.S                      |   22 +-
 arch/arm/lib/clear_user.S                          |    6 +-
 arch/arm/lib/copy_from_user.S                      |    6 +-
 arch/arm/lib/copy_page.S                           |    1 +
 arch/arm/lib/copy_to_user.S                        |    6 +-
 arch/arm/lib/csumpartialcopyuser.S                 |    4 +-
 arch/arm/lib/delay.c                               |    2 +-
 arch/arm/lib/uaccess_with_memcpy.c                 |    2 +-
 arch/arm/mach-kirkwood/common.c                    |   19 +-
 arch/arm/mach-omap2/board-n8x0.c                   |    2 +-
 arch/arm/mach-omap2/gpmc.c                         |   22 +-
 arch/arm/mach-omap2/omap-wakeupgen.c               |    2 +-
 arch/arm/mach-omap2/omap_device.c                  |    4 +-
 arch/arm/mach-omap2/omap_device.h                  |    4 +-
 arch/arm/mach-omap2/omap_hwmod.c                   |    4 +-
 arch/arm/mach-omap2/wd_timer.c                     |    6 +-
 arch/arm/mach-tegra/cpuidle-tegra20.c              |    2 +-
 arch/arm/mach-ux500/setup.h                        |    7 -
 arch/arm/mm/Kconfig                                |    3 +-
 arch/arm/mm/alignment.c                            |    8 +
 arch/arm/mm/fault.c                                |   91 +
 arch/arm/mm/fault.h                                |   12 +
 arch/arm/mm/init.c                                 |   41 +
 arch/arm/mm/ioremap.c                              |    4 +-
 arch/arm/mm/mmap.c                                 |   30 +-
 arch/arm/mm/mmu.c                                  |  187 +-
 arch/arm/mm/proc-v7-2level.S                       |    3 +
 arch/arm/plat-omap/sram.c                          |    2 +
 arch/arm/plat-samsung/include/plat/dma-ops.h       |    2 +-
 arch/arm64/kernel/debug-monitors.c                 |    2 +-
 arch/arm64/kernel/hw_breakpoint.c                  |    2 +-
 arch/avr32/include/asm/elf.h                       |    8 +-
 arch/avr32/include/asm/kmap_types.h                |    4 +-
 arch/avr32/mm/fault.c                              |   27 +
 arch/frv/include/asm/atomic.h                      |   10 +
 arch/frv/include/asm/kmap_types.h                  |    2 +-
 arch/frv/mm/elf-fdpic.c                            |    3 +-
 arch/ia64/include/asm/atomic.h                     |   10 +
 arch/ia64/include/asm/elf.h                        |    7 +
 arch/ia64/include/asm/pgalloc.h                    |   12 +
 arch/ia64/include/asm/pgtable.h                    |   13 +-
 arch/ia64/include/asm/spinlock.h                   |    2 +-
 arch/ia64/include/asm/uaccess.h                    |   26 +-
 arch/ia64/kernel/err_inject.c                      |    2 +-
 arch/ia64/kernel/mca.c                             |    2 +-
 arch/ia64/kernel/module.c                          |   48 +-
 arch/ia64/kernel/palinfo.c                         |    2 +-
 arch/ia64/kernel/salinfo.c                         |    2 +-
 arch/ia64/kernel/sys_ia64.c                        |    7 +
 arch/ia64/kernel/topology.c                        |    2 +-
 arch/ia64/kernel/vmlinux.lds.S                     |    2 +-
 arch/ia64/mm/fault.c                               |   32 +-
 arch/ia64/mm/init.c                                |   13 +
 arch/m32r/lib/usercopy.c                           |    6 +
 arch/mips/include/asm/atomic.h                     |   14 +
 arch/mips/include/asm/elf.h                        |   11 +-
 arch/mips/include/asm/exec.h                       |    2 +-
 arch/mips/include/asm/page.h                       |    2 +-
 arch/mips/include/asm/pgalloc.h                    |    5 +
 arch/mips/kernel/binfmt_elfn32.c                   |    7 +
 arch/mips/kernel/binfmt_elfo32.c                   |    7 +
 arch/mips/kernel/process.c                         |   12 -
 arch/mips/mm/fault.c                               |   17 +
 arch/mips/mm/mmap.c                                |   51 +-
 arch/parisc/include/asm/atomic.h                   |   10 +
 arch/parisc/include/asm/elf.h                      |    7 +
 arch/parisc/include/asm/pgalloc.h                  |    6 +
 arch/parisc/include/asm/pgtable.h                  |   11 +
 arch/parisc/include/asm/uaccess.h                  |    4 +-
 arch/parisc/kernel/module.c                        |   50 +-
 arch/parisc/kernel/sys_parisc.c                    |    9 +-
 arch/parisc/kernel/traps.c                         |    4 +-
 arch/parisc/mm/fault.c                             |  140 +-
 arch/powerpc/include/asm/atomic.h                  |   10 +
 arch/powerpc/include/asm/elf.h                     |   19 +-
 arch/powerpc/include/asm/exec.h                    |    2 +-
 arch/powerpc/include/asm/kmap_types.h              |    2 +-
 arch/powerpc/include/asm/mman.h                    |    2 +-
 arch/powerpc/include/asm/page.h                    |    8 +-
 arch/powerpc/include/asm/page_64.h                 |    7 +-
 arch/powerpc/include/asm/pgalloc-64.h              |    7 +
 arch/powerpc/include/asm/pgtable.h                 |    1 +
 arch/powerpc/include/asm/pte-hash32.h              |    1 +
 arch/powerpc/include/asm/reg.h                     |    1 +
 arch/powerpc/include/asm/smp.h                     |    2 +-
 arch/powerpc/include/asm/uaccess.h                 |  140 +-
 arch/powerpc/kernel/exceptions-64e.S               |    4 +-
 arch/powerpc/kernel/exceptions-64s.S               |    2 +-
 arch/powerpc/kernel/module_32.c                    |   13 +-
 arch/powerpc/kernel/process.c                      |   55 -
 arch/powerpc/kernel/signal_32.c                    |    2 +-
 arch/powerpc/kernel/signal_64.c                    |    2 +-
 arch/powerpc/kernel/sysfs.c                        |    2 +-
 arch/powerpc/kernel/vdso.c                         |    5 +-
 arch/powerpc/lib/usercopy_64.c                     |   18 -
 arch/powerpc/mm/fault.c                            |   54 +-
 arch/powerpc/mm/mmap_64.c                          |   16 +
 arch/powerpc/mm/mmu_context_nohash.c               |    2 +-
 arch/powerpc/mm/numa.c                             |    2 +-
 arch/powerpc/mm/slice.c                            |   13 +-
 arch/powerpc/platforms/cell/spufs/file.c           |    4 +-
 arch/powerpc/platforms/powermac/smp.c              |    2 +-
 arch/s390/include/asm/atomic.h                     |   10 +
 arch/s390/include/asm/elf.h                        |   13 +-
 arch/s390/include/asm/exec.h                       |    2 +-
 arch/s390/include/asm/uaccess.h                    |   15 +-
 arch/s390/kernel/module.c                          |   22 +-
 arch/s390/kernel/process.c                         |   36 -
 arch/s390/mm/mmap.c                                |   24 +
 arch/score/include/asm/exec.h                      |    2 +-
 arch/score/kernel/process.c                        |    5 -
 arch/sh/kernel/cpu/sh4a/smp-shx3.c                 |    2 +-
 arch/sh/mm/mmap.c                                  |   22 +-
 arch/sparc/include/asm/atomic_64.h                 |  106 +-
 arch/sparc/include/asm/cache.h                     |    2 +-
 arch/sparc/include/asm/elf_32.h                    |    7 +
 arch/sparc/include/asm/elf_64.h                    |    7 +
 arch/sparc/include/asm/pgalloc_32.h                |    1 +
 arch/sparc/include/asm/pgalloc_64.h                |    1 +
 arch/sparc/include/asm/pgtable_32.h                |   15 +-
 arch/sparc/include/asm/pgtsrmmu.h                  |    5 +
 arch/sparc/include/asm/spinlock_64.h               |   35 +-
 arch/sparc/include/asm/thread_info_32.h            |    2 +
 arch/sparc/include/asm/thread_info_64.h            |    2 +
 arch/sparc/include/asm/uaccess.h                   |    1 +
 arch/sparc/include/asm/uaccess_32.h                |   27 +-
 arch/sparc/include/asm/uaccess_64.h                |   19 +-
 arch/sparc/kernel/Makefile                         |    2 +-
 arch/sparc/kernel/prom_common.c                    |    2 +-
 arch/sparc/kernel/sys_sparc_32.c                   |    2 +-
 arch/sparc/kernel/sys_sparc_64.c                   |   48 +-
 arch/sparc/kernel/sysfs.c                          |    2 +-
 arch/sparc/kernel/traps_64.c                       |   13 +-
 arch/sparc/lib/Makefile                            |    2 +-
 arch/sparc/lib/atomic_64.S                         |  136 +-
 arch/sparc/lib/ksyms.c                             |    6 +
 arch/sparc/mm/Makefile                             |    2 +-
 arch/sparc/mm/fault_32.c                           |  292 +
 arch/sparc/mm/fault_64.c                           |  486 ++
 arch/sparc/mm/hugetlbpage.c                        |   21 +-
 arch/tile/include/asm/atomic_64.h                  |   10 +
 arch/tile/include/asm/uaccess.h                    |    4 +-
 arch/um/Makefile                                   |    4 +
 arch/um/include/asm/kmap_types.h                   |    2 +-
 arch/um/include/asm/page.h                         |    3 +
 arch/um/include/asm/pgtable-3level.h               |    1 +
 arch/um/kernel/process.c                           |   16 -
 arch/x86/Kconfig                                   |   10 +-
 arch/x86/Kconfig.cpu                               |    6 +-
 arch/x86/Kconfig.debug                             |    4 +-
 arch/x86/Makefile                                  |   10 +
 arch/x86/boot/Makefile                             |    3 +
 arch/x86/boot/bitops.h                             |    4 +-
 arch/x86/boot/boot.h                               |    4 +-
 arch/x86/boot/compressed/Makefile                  |    3 +
 arch/x86/boot/compressed/eboot.c                   |    2 -
 arch/x86/boot/compressed/efi_stub_32.S             |   16 +-
 arch/x86/boot/compressed/head_32.S                 |    7 +-
 arch/x86/boot/compressed/head_64.S                 |    8 +-
 arch/x86/boot/compressed/misc.c                    |    4 +-
 arch/x86/boot/cpucheck.c                           |   28 +-
 arch/x86/boot/header.S                             |    6 +-
 arch/x86/boot/memory.c                             |    2 +-
 arch/x86/boot/video-vesa.c                         |    1 +
 arch/x86/boot/video.c                              |    2 +-
 arch/x86/crypto/aes-x86_64-asm_64.S                |    4 +
 arch/x86/crypto/aesni-intel_asm.S                  |   22 +
 arch/x86/crypto/blowfish-x86_64-asm_64.S           |    7 +
 arch/x86/crypto/camellia-x86_64-asm_64.S           |    7 +
 arch/x86/crypto/cast5-avx-x86_64-asm_64.S          |    7 +
 arch/x86/crypto/cast6-avx-x86_64-asm_64.S          |    9 +
 arch/x86/crypto/salsa20-x86_64-asm_64.S            |    4 +
 arch/x86/crypto/serpent-avx-x86_64-asm_64.S        |    9 +
 arch/x86/crypto/serpent-sse2-x86_64-asm_64.S       |    4 +
 arch/x86/crypto/sha1_ssse3_asm.S                   |    2 +
 arch/x86/crypto/twofish-avx-x86_64-asm_64.S        |    9 +
 arch/x86/crypto/twofish-x86_64-asm_64-3way.S       |    4 +
 arch/x86/crypto/twofish-x86_64-asm_64.S            |    3 +
 arch/x86/ia32/ia32_signal.c                        |   14 +-
 arch/x86/ia32/ia32entry.S                          |  141 +-
 arch/x86/ia32/sys_ia32.c                           |    4 +-
 arch/x86/include/asm/alternative-asm.h             |   39 +
 arch/x86/include/asm/alternative.h                 |    4 +-
 arch/x86/include/asm/apic.h                        |    2 +-
 arch/x86/include/asm/apm.h                         |    4 +-
 arch/x86/include/asm/atomic.h                      |  307 +-
 arch/x86/include/asm/atomic64_32.h                 |  100 +
 arch/x86/include/asm/atomic64_64.h                 |  202 +-
 arch/x86/include/asm/bitops.h                      |    4 +-
 arch/x86/include/asm/boot.h                        |    7 +-
 arch/x86/include/asm/cache.h                       |    5 +-
 arch/x86/include/asm/cacheflush.h                  |    2 +-
 arch/x86/include/asm/checksum_32.h                 |   12 +-
 arch/x86/include/asm/cmpxchg.h                     |   35 +
 arch/x86/include/asm/compat.h                      |    2 +-
 arch/x86/include/asm/cpufeature.h                  |    4 +-
 arch/x86/include/asm/desc.h                        |   67 +-
 arch/x86/include/asm/desc_defs.h                   |    6 +
 arch/x86/include/asm/div64.h                       |    2 +-
 arch/x86/include/asm/elf.h                         |   31 +-
 arch/x86/include/asm/emergency-restart.h           |    2 +-
 arch/x86/include/asm/fpu-internal.h                |    6 +-
 arch/x86/include/asm/futex.h                       |   16 +-
 arch/x86/include/asm/hw_irq.h                      |    4 +-
 arch/x86/include/asm/i8259.h                       |    2 +-
 arch/x86/include/asm/io.h                          |   21 +-
 arch/x86/include/asm/irqflags.h                    |    5 +
 arch/x86/include/asm/kprobes.h                     |    9 +-
 arch/x86/include/asm/local.h                       |  142 +-
 arch/x86/include/asm/mman.h                        |   15 +
 arch/x86/include/asm/mmu.h                         |   16 +-
 arch/x86/include/asm/mmu_context.h                 |   76 +-
 arch/x86/include/asm/module.h                      |   17 +-
 arch/x86/include/asm/nmi.h                         |    6 +-
 arch/x86/include/asm/page.h                        |    1 +
 arch/x86/include/asm/page_64.h                     |    4 +-
 arch/x86/include/asm/paravirt.h                    |   46 +-
 arch/x86/include/asm/paravirt_types.h              |   17 +-
 arch/x86/include/asm/pgalloc.h                     |   23 +
 arch/x86/include/asm/pgtable-2level.h              |    2 +
 arch/x86/include/asm/pgtable-3level.h              |    4 +
 arch/x86/include/asm/pgtable.h                     |  122 +-
 arch/x86/include/asm/pgtable_32.h                  |   14 +-
 arch/x86/include/asm/pgtable_32_types.h            |   15 +-
 arch/x86/include/asm/pgtable_64.h                  |   19 +-
 arch/x86/include/asm/pgtable_64_types.h            |    5 +
 arch/x86/include/asm/pgtable_types.h               |   36 +-
 arch/x86/include/asm/processor.h                   |   39 +-
 arch/x86/include/asm/ptrace.h                      |   26 +-
 arch/x86/include/asm/realmode.h                    |    4 +-
 arch/x86/include/asm/reboot.h                      |   10 +-
 arch/x86/include/asm/rwsem.h                       |   60 +-
 arch/x86/include/asm/segment.h                     |   24 +-
 arch/x86/include/asm/smp.h                         |   14 +-
 arch/x86/include/asm/spinlock.h                    |   36 +-
 arch/x86/include/asm/stackprotector.h              |    4 +-
 arch/x86/include/asm/stacktrace.h                  |   32 +-
 arch/x86/include/asm/switch_to.h                   |    4 +-
 arch/x86/include/asm/thread_info.h                 |   83 +-
 arch/x86/include/asm/uaccess.h                     |   96 +-
 arch/x86/include/asm/uaccess_32.h                  |  106 +-
 arch/x86/include/asm/uaccess_64.h                  |  232 +-
 arch/x86/include/asm/word-at-a-time.h              |    2 +-
 arch/x86/include/asm/x86_init.h                    |   10 +-
 arch/x86/include/asm/xsave.h                       |   10 +-
 arch/x86/include/uapi/asm/e820.h                   |    2 +-
 arch/x86/kernel/Makefile                           |    2 +-
 arch/x86/kernel/acpi/boot.c                        |    4 +-
 arch/x86/kernel/acpi/sleep.c                       |    4 +
 arch/x86/kernel/acpi/wakeup_32.S                   |    6 +-
 arch/x86/kernel/alternative.c                      |   65 +-
 arch/x86/kernel/apic/apic.c                        |    4 +-
 arch/x86/kernel/apic/apic_flat_64.c                |    4 +-
 arch/x86/kernel/apic/apic_noop.c                   |    2 +-
 arch/x86/kernel/apic/bigsmp_32.c                   |    2 +-
 arch/x86/kernel/apic/es7000_32.c                   |    5 +-
 arch/x86/kernel/apic/io_apic.c                     |    8 +-
 arch/x86/kernel/apic/numaq_32.c                    |    3 +-
 arch/x86/kernel/apic/probe_32.c                    |    2 +-
 arch/x86/kernel/apic/summit_32.c                   |    2 +-
 arch/x86/kernel/apic/x2apic_cluster.c              |    4 +-
 arch/x86/kernel/apic/x2apic_phys.c                 |    2 +-
 arch/x86/kernel/apic/x2apic_uv_x.c                 |    2 +-
 arch/x86/kernel/apm_32.c                           |   19 +-
 arch/x86/kernel/asm-offsets.c                      |   20 +
 arch/x86/kernel/asm-offsets_64.c                   |    1 +
 arch/x86/kernel/cpu/Makefile                       |    4 -
 arch/x86/kernel/cpu/amd.c                          |    2 +-
 arch/x86/kernel/cpu/common.c                       |   75 +-
 arch/x86/kernel/cpu/intel_cacheinfo.c              |   50 +-
 arch/x86/kernel/cpu/mcheck/mce.c                   |   33 +-
 arch/x86/kernel/cpu/mcheck/p5.c                    |    3 +
 arch/x86/kernel/cpu/mcheck/therm_throt.c           |    2 +-
 arch/x86/kernel/cpu/mcheck/winchip.c               |    3 +
 arch/x86/kernel/cpu/mtrr/main.c                    |    2 +-
 arch/x86/kernel/cpu/mtrr/mtrr.h                    |    2 +-
 arch/x86/kernel/cpu/perf_event.c                   |    8 +-
 arch/x86/kernel/cpu/perf_event_intel.c             |    6 +-
 arch/x86/kernel/cpu/perf_event_intel_uncore.c      |    4 +-
 arch/x86/kernel/cpu/perf_event_intel_uncore.h      |    2 +-
 arch/x86/kernel/cpuid.c                            |    2 +-
 arch/x86/kernel/crash.c                            |    4 +-
 arch/x86/kernel/crash_dump_64.c                    |    2 +-
 arch/x86/kernel/doublefault_32.c                   |    8 +-
 arch/x86/kernel/dumpstack.c                        |   28 +-
 arch/x86/kernel/dumpstack_32.c                     |   34 +-
 arch/x86/kernel/dumpstack_64.c                     |   61 +-
 arch/x86/kernel/e820.c                             |    4 +-
 arch/x86/kernel/early_printk.c                     |    1 +
 arch/x86/kernel/entry_32.S                         |  354 +-
 arch/x86/kernel/entry_64.S                         |  548 ++-
 arch/x86/kernel/ftrace.c                           |   14 +-
 arch/x86/kernel/head64.c                           |   13 +-
 arch/x86/kernel/head_32.S                          |  237 +-
 arch/x86/kernel/head_64.S                          |  143 +-
 arch/x86/kernel/i386_ksyms_32.c                    |    8 +
 arch/x86/kernel/i387.c                             |    2 +-
 arch/x86/kernel/i8259.c                            |   10 +-
 arch/x86/kernel/io_delay.c                         |    2 +-
 arch/x86/kernel/ioport.c                           |    2 +-
 arch/x86/kernel/irq.c                              |    8 +-
 arch/x86/kernel/irq_32.c                           |   69 +-
 arch/x86/kernel/irq_64.c                           |    2 +-
 arch/x86/kernel/kdebugfs.c                         |    2 +-
 arch/x86/kernel/kgdb.c                             |   25 +-
 arch/x86/kernel/kprobes/core.c                     |   30 +-
 arch/x86/kernel/kprobes/opt.c                      |   16 +-
 arch/x86/kernel/kvm.c                              |    2 +-
 arch/x86/kernel/ldt.c                              |   31 +-
 arch/x86/kernel/machine_kexec_32.c                 |    6 +-
 arch/x86/kernel/microcode_core.c                   |    2 +-
 arch/x86/kernel/microcode_intel.c                  |    4 +-
 arch/x86/kernel/module.c                           |   76 +-
 arch/x86/kernel/msr.c                              |    2 +-
 arch/x86/kernel/nmi.c                              |   19 +-
 arch/x86/kernel/nmi_selftest.c                     |    4 +-
 arch/x86/kernel/paravirt-spinlocks.c               |    2 +-
 arch/x86/kernel/paravirt.c                         |   43 +-
 arch/x86/kernel/pci-calgary_64.c                   |    2 +-
 arch/x86/kernel/pci-iommu_table.c                  |    2 +-
 arch/x86/kernel/pci-swiotlb.c                      |    2 +-
 arch/x86/kernel/process.c                          |   55 +-
 arch/x86/kernel/process_32.c                       |   29 +-
 arch/x86/kernel/process_64.c                       |   15 +-
 arch/x86/kernel/ptrace.c                           |   25 +-
 arch/x86/kernel/pvclock.c                          |    8 +-
 arch/x86/kernel/reboot.c                           |   44 +-
 arch/x86/kernel/relocate_kernel_64.S               |    2 +
 arch/x86/kernel/setup.c                            |   21 +-
 arch/x86/kernel/setup_percpu.c                     |   29 +-
 arch/x86/kernel/signal.c                           |   15 +-
 arch/x86/kernel/smp.c                              |    2 +-
 arch/x86/kernel/smpboot.c                          |   15 +-
 arch/x86/kernel/step.c                             |   10 +-
 arch/x86/kernel/sys_i386_32.c                      |  184 +
 arch/x86/kernel/sys_x86_64.c                       |   22 +-
 arch/x86/kernel/tboot.c                            |   14 +-
 arch/x86/kernel/time.c                             |   10 +-
 arch/x86/kernel/tls.c                              |    7 +-
 arch/x86/kernel/traps.c                            |   64 +-
 arch/x86/kernel/uprobes.c                          |    4 +-
 arch/x86/kernel/vm86_32.c                          |    6 +-
 arch/x86/kernel/vmlinux.lds.S                      |  148 +-
 arch/x86/kernel/vsyscall_64.c                      |   12 +-
 arch/x86/kernel/x8664_ksyms_64.c                   |    2 -
 arch/x86/kernel/x86_init.c                         |    8 +-
 arch/x86/kernel/xsave.c                            |    2 +
 arch/x86/kvm/cpuid.c                               |   21 +-
 arch/x86/kvm/emulate.c                             |    4 +-
 arch/x86/kvm/lapic.c                               |    2 +-
 arch/x86/kvm/paging_tmpl.h                         |    2 +-
 arch/x86/kvm/svm.c                                 |    8 +
 arch/x86/kvm/vmx.c                                 |   61 +-
 arch/x86/kvm/x86.c                                 |    8 +-
 arch/x86/lguest/boot.c                             |    3 +-
 arch/x86/lib/atomic64_386_32.S                     |  164 +
 arch/x86/lib/atomic64_cx8_32.S                     |  103 +-
 arch/x86/lib/checksum_32.S                         |  100 +-
 arch/x86/lib/clear_page_64.S                       |    5 +-
 arch/x86/lib/cmpxchg16b_emu.S                      |    2 +
 arch/x86/lib/copy_page_64.S                        |   24 +-
 arch/x86/lib/copy_user_64.S                        |   47 +-
 arch/x86/lib/copy_user_nocache_64.S                |   20 +-
 arch/x86/lib/csum-copy_64.S                        |    2 +
 arch/x86/lib/csum-wrappers_64.c                    |    4 +-
 arch/x86/lib/getuser.S                             |   70 +-
 arch/x86/lib/insn.c                                |    6 +-
 arch/x86/lib/iomap_copy_64.S                       |    2 +
 arch/x86/lib/memcpy_64.S                           |   18 +-
 arch/x86/lib/memmove_64.S                          |   34 +-
 arch/x86/lib/memset_64.S                           |    7 +-
 arch/x86/lib/mmx_32.c                              |  243 +-
 arch/x86/lib/msr-reg.S                             |   18 +-
 arch/x86/lib/putuser.S                             |   90 +-
 arch/x86/lib/rwlock.S                              |   42 +
 arch/x86/lib/rwsem.S                               |    6 +-
 arch/x86/lib/thunk_64.S                            |    2 +
 arch/x86/lib/usercopy_32.c                         |  363 +-
 arch/x86/lib/usercopy_64.c                         |   13 +-
 arch/x86/mm/extable.c                              |   25 +-
 arch/x86/mm/fault.c                                |  556 ++-
 arch/x86/mm/gup.c                                  |    2 +-
 arch/x86/mm/highmem_32.c                           |    4 +
 arch/x86/mm/hugetlbpage.c                          |   30 +-
 arch/x86/mm/init.c                                 |   98 +-
 arch/x86/mm/init_32.c                              |  113 +-
 arch/x86/mm/init_64.c                              |   38 +-
 arch/x86/mm/iomap_32.c                             |    4 +
 arch/x86/mm/ioremap.c                              |   15 +-
 arch/x86/mm/kmemcheck/kmemcheck.c                  |    4 +-
 arch/x86/mm/mmap.c                                 |   41 +-
 arch/x86/mm/mmio-mod.c                             |   10 +-
 arch/x86/mm/numa.c                                 |    2 +-
 arch/x86/mm/pageattr-test.c                        |    2 +-
 arch/x86/mm/pageattr.c                             |   33 +-
 arch/x86/mm/pat.c                                  |   12 +-
 arch/x86/mm/pat_rbtree.c                           |    2 +-
 arch/x86/mm/pf_in.c                                |   10 +-
 arch/x86/mm/pgtable.c                              |  137 +-
 arch/x86/mm/pgtable_32.c                           |    3 +
 arch/x86/mm/physaddr.c                             |    4 +-
 arch/x86/mm/setup_nx.c                             |    7 +
 arch/x86/mm/tlb.c                                  |    4 +
 arch/x86/net/bpf_jit.S                             |   14 +
 arch/x86/net/bpf_jit_comp.c                        |   37 +-
 arch/x86/oprofile/backtrace.c                      |    8 +-
 arch/x86/oprofile/nmi_int.c                        |    8 +-
 arch/x86/oprofile/op_model_amd.c                   |    8 +-
 arch/x86/oprofile/op_model_ppro.c                  |    7 +-
 arch/x86/oprofile/op_x86_model.h                   |    2 +-
 arch/x86/pci/amd_bus.c                             |    2 +-
 arch/x86/pci/irq.c                                 |    8 +-
 arch/x86/pci/mrst.c                                |    4 +-
 arch/x86/pci/pcbios.c                              |  144 +-
 arch/x86/platform/efi/efi_32.c                     |   24 +
 arch/x86/platform/efi/efi_64.c                     |   10 +
 arch/x86/platform/efi/efi_stub_32.S                |   64 +-
 arch/x86/platform/efi/efi_stub_64.S                |    8 +
 arch/x86/platform/mrst/mrst.c                      |    6 +-
 arch/x86/platform/olpc/olpc_dt.c                   |    2 +-
 arch/x86/power/cpu.c                               |   11 +-
 arch/x86/realmode/init.c                           |   10 +-
 arch/x86/realmode/rm/Makefile                      |    3 +
 arch/x86/realmode/rm/header.S                      |    4 +-
 arch/x86/realmode/rm/trampoline_32.S               |   12 +-
 arch/x86/realmode/rm/trampoline_64.S               |    2 +-
 arch/x86/tools/Makefile                            |    2 +-
 arch/x86/tools/relocs.c                            |   94 +-
 arch/x86/um/tls_32.c                               |    2 +-
 arch/x86/vdso/Makefile                             |    2 +-
 arch/x86/vdso/vdso32-setup.c                       |   23 +-
 arch/x86/vdso/vma.c                                |   29 +-
 arch/x86/xen/enlighten.c                           |   47 +-
 arch/x86/xen/mmu.c                                 |    9 +
 arch/x86/xen/smp.c                                 |   18 +-
 arch/x86/xen/xen-asm_32.S                          |   12 +-
 arch/x86/xen/xen-head.S                            |   11 +
 arch/x86/xen/xen-ops.h                             |    2 -
 block/blk-iopoll.c                                 |    4 +-
 block/blk-map.c                                    |    2 +-
 block/blk-softirq.c                                |    4 +-
 block/bsg.c                                        |   12 +-
 block/compat_ioctl.c                               |    2 +-
 block/genhd.c                                      |   11 +-
 block/partitions/efi.c                             |    8 +-
 block/scsi_ioctl.c                                 |   27 +-
 crypto/algapi.c                                    |    2 +-
 crypto/cryptd.c                                    |    4 +-
 crypto/pcrypt.c                                    |    6 +-
 drivers/acpi/apei/apei-internal.h                  |    2 +-
 drivers/acpi/apei/cper.c                           |    8 +-
 drivers/acpi/bgrt.c                                |    6 +-
 drivers/acpi/blacklist.c                           |    4 +-
 drivers/acpi/ec_sys.c                              |   12 +-
 drivers/acpi/processor_idle.c                      |    2 +-
 drivers/acpi/sysfs.c                               |    4 +-
 drivers/ata/libahci.c                              |    2 +-
 drivers/ata/libata-core.c                          |    8 +-
 drivers/ata/pata_arasan_cf.c                       |    4 +-
 drivers/atm/adummy.c                               |    2 +-
 drivers/atm/ambassador.c                           |    8 +-
 drivers/atm/atmtcp.c                               |   14 +-
 drivers/atm/eni.c                                  |   10 +-
 drivers/atm/firestream.c                           |    8 +-
 drivers/atm/fore200e.c                             |   14 +-
 drivers/atm/he.c                                   |   18 +-
 drivers/atm/horizon.c                              |    4 +-
 drivers/atm/idt77252.c                             |   36 +-
 drivers/atm/iphase.c                               |   34 +-
 drivers/atm/lanai.c                                |   12 +-
 drivers/atm/nicstar.c                              |   46 +-
 drivers/atm/solos-pci.c                            |    4 +-
 drivers/atm/suni.c                                 |    4 +-
 drivers/atm/uPD98402.c                             |   16 +-
 drivers/atm/zatm.c                                 |    6 +-
 drivers/base/attribute_container.c                 |    2 +-
 drivers/base/bus.c                                 |    4 +-
 drivers/base/devtmpfs.c                            |    8 +-
 drivers/base/node.c                                |    2 +-
 drivers/base/power/domain.c                        |    4 +-
 drivers/base/power/sysfs.c                         |    2 +-
 drivers/base/power/wakeup.c                        |    8 +-
 drivers/base/syscore.c                             |    4 +-
 drivers/block/cciss.c                              |   28 +-
 drivers/block/cciss.h                              |    2 +-
 drivers/block/cpqarray.c                           |   28 +-
 drivers/block/cpqarray.h                           |    2 +-
 drivers/block/drbd/drbd_int.h                      |    6 +-
 drivers/block/drbd/drbd_main.c                     |    8 +-
 drivers/block/drbd/drbd_receiver.c                 |   22 +-
 drivers/block/loop.c                               |    2 +-
 drivers/block/nbd.c                                |    2 +-
 drivers/block/pktcdvd.c                            |    2 +-
 drivers/cdrom/cdrom.c                              |   11 +-
 drivers/cdrom/gdrom.c                              |    1 -
 drivers/char/agp/compat_ioctl.c                    |    2 +-
 drivers/char/agp/frontend.c                        |    4 +-
 drivers/char/hpet.c                                |    2 +-
 drivers/char/hw_random/intel-rng.c                 |    2 +-
 drivers/char/ipmi/ipmi_msghandler.c                |    8 +-
 drivers/char/ipmi/ipmi_si_intf.c                   |    8 +-
 drivers/char/mem.c                                 |   45 +-
 drivers/char/nvram.c                               |    2 +-
 drivers/char/pcmcia/synclink_cs.c                  |   18 +-
 drivers/char/random.c                              |   10 +-
 drivers/char/sonypi.c                              |    9 +-
 drivers/char/tpm/tpm_acpi.c                        |    3 +-
 drivers/char/tpm/tpm_eventlog.c                    |    7 +-
 drivers/char/virtio_console.c                      |    4 +-
 drivers/clk/clk-composite.c                        |    2 +-
 drivers/clocksource/arm_arch_timer.c               |    2 +-
 drivers/clocksource/metag_generic.c                |    2 +-
 drivers/cpufreq/acpi-cpufreq.c                     |   20 +-
 drivers/cpufreq/cpufreq.c                          |    9 +-
 drivers/cpufreq/cpufreq_governor.c                 |    6 +-
 drivers/cpufreq/cpufreq_governor.h                 |    2 +-
 drivers/cpufreq/cpufreq_ondemand.c                 |    8 +-
 drivers/cpufreq/cpufreq_stats.c                    |    2 +-
 drivers/cpufreq/p4-clockmod.c                      |   12 +-
 drivers/cpufreq/sparc-us3-cpufreq.c                |   69 +-
 drivers/cpufreq/speedstep-centrino.c               |    7 +-
 drivers/cpuidle/cpuidle.c                          |    2 +-
 drivers/cpuidle/governor.c                         |    4 +-
 drivers/cpuidle/sysfs.c                            |    2 +-
 drivers/devfreq/devfreq.c                          |    6 +-
 drivers/dma/sh/shdma.c                             |    2 +-
 drivers/edac/edac_mc_sysfs.c                       |   12 +-
 drivers/edac/edac_pci_sysfs.c                      |   22 +-
 drivers/edac/mce_amd.h                             |    2 +-
 drivers/firewire/core-card.c                       |    2 +-
 drivers/firewire/core-device.c                     |    2 +-
 drivers/firewire/core-transaction.c                |    1 +
 drivers/firewire/core.h                            |    1 +
 drivers/firmware/dmi-id.c                          |    2 +-
 drivers/firmware/dmi_scan.c                        |    7 +-
 drivers/firmware/efi/efi.c                         |   12 +-
 drivers/firmware/efi/efivars.c                     |    2 +-
 drivers/firmware/google/memconsole.c               |    4 +-
 drivers/gpio/gpio-ich.c                            |    2 +-
 drivers/gpio/gpio-vr41xx.c                         |    2 +-
 drivers/gpu/drm/drm_crtc_helper.c                  |    2 +-
 drivers/gpu/drm/drm_drv.c                          |    6 +-
 drivers/gpu/drm/drm_fops.c                         |   18 +-
 drivers/gpu/drm/drm_global.c                       |   14 +-
 drivers/gpu/drm/drm_info.c                         |   14 +-
 drivers/gpu/drm/drm_ioc32.c                        |   13 +-
 drivers/gpu/drm/drm_ioctl.c                        |    2 +-
 drivers/gpu/drm/drm_lock.c                         |    4 +-
 drivers/gpu/drm/drm_stub.c                         |    2 +-
 drivers/gpu/drm/drm_sysfs.c                        |    2 +-
 drivers/gpu/drm/i810/i810_dma.c                    |    8 +-
 drivers/gpu/drm/i810/i810_drv.h                    |    4 +-
 drivers/gpu/drm/i915/i915_debugfs.c                |    2 +-
 drivers/gpu/drm/i915/i915_dma.c                    |    2 +-
 drivers/gpu/drm/i915/i915_drv.h                    |    4 +-
 drivers/gpu/drm/i915/i915_gem_execbuffer.c         |    4 +-
 drivers/gpu/drm/i915/i915_ioc32.c                  |   11 +-
 drivers/gpu/drm/i915/i915_irq.c                    |   22 +-
 drivers/gpu/drm/i915/intel_display.c               |   26 +-
 drivers/gpu/drm/mga/mga_drv.h                      |    4 +-
 drivers/gpu/drm/mga/mga_ioc32.c                    |   11 +-
 drivers/gpu/drm/mga/mga_irq.c                      |    8 +-
 drivers/gpu/drm/nouveau/nouveau_bios.c             |    2 +-
 drivers/gpu/drm/nouveau/nouveau_drm.h              |    2 +-
 drivers/gpu/drm/nouveau/nouveau_gem.c              |    4 +-
 drivers/gpu/drm/nouveau/nouveau_ioc32.c            |    2 +-
 drivers/gpu/drm/nouveau/nouveau_vga.c              |    2 +-
 drivers/gpu/drm/qxl/qxl_ttm.c                      |   38 +-
 drivers/gpu/drm/r128/r128_cce.c                    |    2 +-
 drivers/gpu/drm/r128/r128_drv.h                    |    4 +-
 drivers/gpu/drm/r128/r128_ioc32.c                  |   11 +-
 drivers/gpu/drm/r128/r128_irq.c                    |    4 +-
 drivers/gpu/drm/r128/r128_state.c                  |    4 +-
 drivers/gpu/drm/radeon/mkregtable.c                |    4 +-
 drivers/gpu/drm/radeon/radeon_device.c             |    2 +-
 drivers/gpu/drm/radeon/radeon_drv.h                |    2 +-
 drivers/gpu/drm/radeon/radeon_ioc32.c              |   13 +-
 drivers/gpu/drm/radeon/radeon_irq.c                |    6 +-
 drivers/gpu/drm/radeon/radeon_state.c              |    4 +-
 drivers/gpu/drm/radeon/radeon_ttm.c                |   57 +-
 drivers/gpu/drm/radeon/rs690.c                     |    4 +-
 drivers/gpu/drm/ttm/ttm_memory.c                   |    4 +-
 drivers/gpu/drm/ttm/ttm_page_alloc.c               |    4 +-
 drivers/gpu/drm/udl/udl_fb.c                       |    1 -
 drivers/gpu/drm/via/via_drv.h                      |    4 +-
 drivers/gpu/drm/via/via_irq.c                      |   18 +-
 drivers/gpu/drm/vmwgfx/vmwgfx_drv.h                |    2 +-
 drivers/gpu/drm/vmwgfx/vmwgfx_fifo.c               |    8 +-
 drivers/gpu/drm/vmwgfx/vmwgfx_ioctl.c              |    4 +-
 drivers/gpu/drm/vmwgfx/vmwgfx_irq.c                |    4 +-
 drivers/gpu/drm/vmwgfx/vmwgfx_marker.c             |    2 +-
 drivers/hid/hid-core.c                             |    4 +-
 drivers/hv/channel.c                               |    4 +-
 drivers/hv/hv.c                                    |    2 +-
 drivers/hv/hyperv_vmbus.h                          |    2 +-
 drivers/hv/vmbus_drv.c                             |    4 +-
 drivers/hwmon/acpi_power_meter.c                   |    4 +-
 drivers/hwmon/applesmc.c                           |    2 +-
 drivers/hwmon/asus_atk0110.c                       |   10 +-
 drivers/hwmon/coretemp.c                           |    2 +-
 drivers/hwmon/ibmaem.c                             |    2 +-
 drivers/hwmon/iio_hwmon.c                          |    2 +-
 drivers/hwmon/pmbus/pmbus_core.c                   |   10 +-
 drivers/hwmon/sht15.c                              |   12 +-
 drivers/hwmon/via-cputemp.c                        |    2 +-
 drivers/i2c/busses/i2c-amd756-s4882.c              |    2 +-
 drivers/i2c/busses/i2c-nforce2-s4985.c             |    2 +-
 drivers/i2c/i2c-dev.c                              |    2 +-
 drivers/ide/ide-cd.c                               |    2 +-
 drivers/iio/industrialio-core.c                    |    2 +-
 drivers/infiniband/core/cm.c                       |   32 +-
 drivers/infiniband/core/fmr_pool.c                 |   20 +-
 drivers/infiniband/hw/cxgb4/mem.c                  |    4 +-
 drivers/infiniband/hw/ipath/ipath_rc.c             |    6 +-
 drivers/infiniband/hw/ipath/ipath_ruc.c            |    6 +-
 drivers/infiniband/hw/mthca/mthca_cmd.c            |    2 +-
 drivers/infiniband/hw/mthca/mthca_mr.c             |    2 +-
 drivers/infiniband/hw/nes/nes.c                    |    4 +-
 drivers/infiniband/hw/nes/nes.h                    |   40 +-
 drivers/infiniband/hw/nes/nes_cm.c                 |   62 +-
 drivers/infiniband/hw/nes/nes_mgt.c                |    8 +-
 drivers/infiniband/hw/nes/nes_nic.c                |   40 +-
 drivers/infiniband/hw/nes/nes_verbs.c              |   10 +-
 drivers/infiniband/hw/qib/qib.h                    |    1 +
 drivers/input/gameport/gameport.c                  |    4 +-
 drivers/input/input.c                              |    4 +-
 drivers/input/joystick/sidewinder.c                |    1 +
 drivers/input/joystick/xpad.c                      |    4 +-
 drivers/input/mouse/psmouse.h                      |    2 +-
 drivers/input/mousedev.c                           |    2 +-
 drivers/input/serio/serio.c                        |    4 +-
 drivers/iommu/iommu.c                              |    2 +-
 drivers/iommu/irq_remapping.c                      |   12 +-
 drivers/irqchip/irq-gic.c                          |    4 +-
 drivers/isdn/capi/capi.c                           |   10 +-
 drivers/isdn/gigaset/interface.c                   |    8 +-
 drivers/isdn/hardware/avm/b1.c                     |    4 +-
 drivers/isdn/i4l/isdn_tty.c                        |   22 +-
 drivers/isdn/icn/icn.c                             |    2 +-
 drivers/leds/leds-clevo-mail.c                     |    2 +-
 drivers/leds/leds-ss4200.c                         |    2 +-
 drivers/lguest/core.c                              |   10 +-
 drivers/lguest/page_tables.c                       |    2 +-
 drivers/lguest/x86/core.c                          |   12 +-
 drivers/lguest/x86/switcher_32.S                   |   27 +-
 drivers/md/bcache/closure.h                        |    2 +-
 drivers/md/bitmap.c                                |    2 +-
 drivers/md/dm-ioctl.c                              |    2 +-
 drivers/md/dm-raid1.c                              |   16 +-
 drivers/md/dm-stripe.c                             |   10 +-
 drivers/md/dm-table.c                              |    2 +-
 drivers/md/dm-thin-metadata.c                      |    4 +-
 drivers/md/dm.c                                    |   16 +-
 drivers/md/md.c                                    |   26 +-
 drivers/md/md.h                                    |    6 +-
 drivers/md/persistent-data/dm-space-map.h          |    1 +
 drivers/md/raid1.c                                 |    4 +-
 drivers/md/raid10.c                                |   16 +-
 drivers/md/raid5.c                                 |   10 +-
 drivers/media/dvb-core/dvbdev.c                    |    2 +-
 drivers/media/dvb-frontends/dib3000.h              |    2 +-
 drivers/media/pci/cx88/cx88-video.c                |    6 +-
 drivers/media/platform/omap/omap_vout.c            |   11 +-
 drivers/media/platform/s5p-tv/mixer.h              |    2 +-
 drivers/media/platform/s5p-tv/mixer_grp_layer.c    |    2 +-
 drivers/media/platform/s5p-tv/mixer_reg.c          |    2 +-
 drivers/media/platform/s5p-tv/mixer_video.c        |   24 +-
 drivers/media/platform/s5p-tv/mixer_vp_layer.c     |    2 +-
 drivers/media/radio/radio-cadet.c                  |    2 +
 drivers/media/usb/dvb-usb/cxusb.c                  |    2 +-
 drivers/media/usb/dvb-usb/dw2102.c                 |    2 +-
 drivers/media/v4l2-core/v4l2-compat-ioctl32.c      |    6 +-
 drivers/media/v4l2-core/v4l2-ioctl.c               |   11 +-
 drivers/message/fusion/mptsas.c                    |   34 +-
 drivers/message/fusion/mptscsih.c                  |   19 +-
 drivers/message/i2o/i2o_proc.c                     |   51 +-
 drivers/message/i2o/iop.c                          |    8 +-
 drivers/mfd/janz-cmodio.c                          |    1 +
 drivers/mfd/twl4030-irq.c                          |    9 +-
 drivers/mfd/twl6030-irq.c                          |   10 +-
 drivers/misc/c2port/core.c                         |    4 +-
 drivers/misc/kgdbts.c                              |    4 +-
 drivers/misc/lis3lv02d/lis3lv02d.c                 |    8 +-
 drivers/misc/lis3lv02d/lis3lv02d.h                 |    2 +-
 drivers/misc/sgi-gru/gruhandles.c                  |    4 +-
 drivers/misc/sgi-gru/gruprocfs.c                   |    8 +-
 drivers/misc/sgi-gru/grutables.h                   |  154 +-
 drivers/misc/sgi-xp/xp.h                           |    2 +-
 drivers/misc/sgi-xp/xpc.h                          |    3 +-
 drivers/misc/sgi-xp/xpc_main.c                     |    4 +-
 drivers/mmc/core/mmc_ops.c                         |    2 +-
 drivers/mmc/host/dw_mmc.h                          |    2 +-
 drivers/mmc/host/sdhci-s3c.c                       |    8 +-
 drivers/mtd/nand/denali.c                          |    1 +
 drivers/mtd/nftlmount.c                            |    1 +
 drivers/mtd/sm_ftl.c                               |    2 +-
 drivers/net/bonding/bond_main.c                    |    2 +-
 drivers/net/ethernet/8390/ax88796.c                |    4 +-
 drivers/net/ethernet/broadcom/bnx2x/bnx2x_cmn.h    |    2 +-
 drivers/net/ethernet/broadcom/bnx2x/bnx2x_sp.c     |   11 +-
 drivers/net/ethernet/broadcom/bnx2x/bnx2x_sp.h     |    3 +-
 drivers/net/ethernet/broadcom/tg3.h                |    1 +
 drivers/net/ethernet/chelsio/cxgb3/l2t.h           |    2 +-
 drivers/net/ethernet/dec/tulip/de4x5.c             |    4 +-
 drivers/net/ethernet/emulex/benet/be_main.c        |    2 +-
 drivers/net/ethernet/faraday/ftgmac100.c           |    2 +
 drivers/net/ethernet/faraday/ftmac100.c            |    2 +
 drivers/net/ethernet/intel/ixgbe/ixgbe_ptp.c       |    2 +-
 drivers/net/ethernet/neterion/vxge/vxge-config.c   |    7 +-
 .../net/ethernet/qlogic/qlcnic/qlcnic_83xx_init.c  |    4 +-
 .../net/ethernet/qlogic/qlcnic/qlcnic_83xx_vnic.c  |   12 +-
 drivers/net/ethernet/realtek/r8169.c               |    8 +-
 drivers/net/ethernet/sfc/ptp.c                     |    2 +-
 drivers/net/ethernet/stmicro/stmmac/mmc_core.c     |    4 +-
 drivers/net/hyperv/hyperv_net.h                    |    2 +-
 drivers/net/hyperv/rndis_filter.c                  |    4 +-
 drivers/net/ieee802154/fakehard.c                  |    2 +-
 drivers/net/macvlan.c                              |   18 +-
 drivers/net/macvtap.c                              |    2 +-
 drivers/net/ppp/ppp_generic.c                      |    4 +-
 drivers/net/slip/slhc.c                            |    2 +-
 drivers/net/team/team.c                            |    2 +-
 drivers/net/tun.c                                  |    5 +-
 drivers/net/usb/hso.c                              |   23 +-
 drivers/net/vxlan.c                                |    2 +-
 drivers/net/wireless/at76c50x-usb.c                |    2 +-
 drivers/net/wireless/ath/ath9k/ar9002_mac.c        |   30 +-
 drivers/net/wireless/ath/ath9k/ar9003_mac.c        |   58 +-
 drivers/net/wireless/ath/ath9k/hw.h                |    4 +-
 drivers/net/wireless/iwlegacy/3945-mac.c           |    4 +-
 drivers/net/wireless/iwlwifi/dvm/debugfs.c         |   26 +-
 drivers/net/wireless/iwlwifi/pcie/trans.c          |    4 +-
 drivers/net/wireless/mac80211_hwsim.c              |   32 +-
 drivers/net/wireless/rndis_wlan.c                  |    2 +-
 drivers/net/wireless/rt2x00/rt2x00.h               |    2 +-
 drivers/net/wireless/rt2x00/rt2x00queue.c          |    4 +-
 drivers/net/wireless/ti/wl1251/sdio.c              |   12 +-
 drivers/net/wireless/ti/wl12xx/main.c              |    8 +-
 drivers/net/wireless/ti/wl18xx/main.c              |    6 +-
 drivers/oprofile/buffer_sync.c                     |    8 +-
 drivers/oprofile/event_buffer.c                    |    2 +-
 drivers/oprofile/oprof.c                           |    2 +-
 drivers/oprofile/oprofile_files.c                  |    2 +-
 drivers/oprofile/oprofile_stats.c                  |   10 +-
 drivers/oprofile/oprofile_stats.h                  |   10 +-
 drivers/oprofile/oprofilefs.c                      |    2 +-
 drivers/oprofile/timer_int.c                       |    2 +-
 drivers/parport/procfs.c                           |    4 +-
 drivers/pci/hotplug/acpiphp_ibm.c                  |    4 +-
 drivers/pci/hotplug/cpcihp_generic.c               |    6 +-
 drivers/pci/hotplug/cpcihp_zt5550.c                |   14 +-
 drivers/pci/hotplug/cpqphp_nvram.c                 |    4 +
 drivers/pci/hotplug/pci_hotplug_core.c             |    6 +-
 drivers/pci/hotplug/pciehp_core.c                  |    2 +-
 drivers/pci/pci-sysfs.c                            |    6 +-
 drivers/pci/pci.h                                  |    2 +-
 drivers/pci/pcie/aspm.c                            |    6 +-
 drivers/pci/probe.c                                |    2 +-
 drivers/platform/x86/chromeos_laptop.c             |    2 +-
 drivers/platform/x86/msi-laptop.c                  |   14 +-
 drivers/platform/x86/sony-laptop.c                 |    2 +-
 drivers/platform/x86/thinkpad_acpi.c               |   70 +-
 drivers/pnp/pnpbios/bioscalls.c                    |   14 +-
 drivers/pnp/resource.c                             |    4 +-
 drivers/power/pda_power.c                          |    7 +-
 drivers/power/power_supply.h                       |    4 +-
 drivers/power/power_supply_core.c                  |    7 +-
 drivers/power/power_supply_sysfs.c                 |    6 +-
 drivers/regulator/max8660.c                        |    6 +-
 drivers/regulator/max8973-regulator.c              |    8 +-
 drivers/regulator/mc13892-regulator.c              |    6 +-
 drivers/rtc/rtc-cmos.c                             |    4 +-
 drivers/rtc/rtc-ds1307.c                           |    2 +-
 drivers/rtc/rtc-m48t59.c                           |    4 +-
 drivers/scsi/bfa/bfa_fcpim.h                       |    2 +-
 drivers/scsi/bfa/bfa_ioc.h                         |    4 +-
 drivers/scsi/hosts.c                               |    4 +-
 drivers/scsi/hpsa.c                                |   30 +-
 drivers/scsi/hpsa.h                                |    2 +-
 drivers/scsi/libfc/fc_exch.c                       |   50 +-
 drivers/scsi/libsas/sas_ata.c                      |    2 +-
 drivers/scsi/lpfc/lpfc.h                           |    8 +-
 drivers/scsi/lpfc/lpfc_debugfs.c                   |   18 +-
 drivers/scsi/lpfc/lpfc_init.c                      |    6 +-
 drivers/scsi/lpfc/lpfc_scsi.c                      |   16 +-
 drivers/scsi/pmcraid.c                             |   20 +-
 drivers/scsi/pmcraid.h                             |    8 +-
 drivers/scsi/qla2xxx/qla_attr.c                    |    4 +-
 drivers/scsi/qla2xxx/qla_gbl.h                     |    4 +-
 drivers/scsi/qla2xxx/qla_os.c                      |    6 +-
 drivers/scsi/qla4xxx/ql4_def.h                     |    2 +-
 drivers/scsi/qla4xxx/ql4_os.c                      |    6 +-
 drivers/scsi/scsi.c                                |    2 +-
 drivers/scsi/scsi_lib.c                            |    6 +-
 drivers/scsi/scsi_sysfs.c                          |    2 +-
 drivers/scsi/scsi_tgt_lib.c                        |    2 +-
 drivers/scsi/scsi_transport_fc.c                   |    8 +-
 drivers/scsi/scsi_transport_iscsi.c                |    6 +-
 drivers/scsi/scsi_transport_srp.c                  |    6 +-
 drivers/scsi/sd.c                                  |    2 +-
 drivers/scsi/sg.c                                  |    2 +-
 drivers/spi/spi.c                                  |    2 +-
 drivers/staging/media/solo6x10/solo6x10-core.c     |    2 +-
 drivers/staging/octeon/ethernet-rx.c               |   12 +-
 drivers/staging/octeon/ethernet.c                  |    8 +-
 drivers/staging/rtl8712/rtl871x_io.h               |    2 +-
 drivers/staging/sbe-2t3e3/netdev.c                 |    2 +-
 drivers/staging/usbip/vhci.h                       |    2 +-
 drivers/staging/usbip/vhci_hcd.c                   |    6 +-
 drivers/staging/usbip/vhci_rx.c                    |    2 +-
 drivers/staging/vt6655/hostap.c                    |    7 +-
 drivers/staging/vt6656/hostap.c                    |    7 +-
 drivers/staging/zcache/tmem.c                      |    4 +-
 drivers/staging/zcache/tmem.h                      |    2 +
 drivers/target/target_core_device.c                |    2 +-
 drivers/target/target_core_transport.c             |    2 +-
 drivers/tty/cyclades.c                             |    6 +-
 drivers/tty/hvc/hvc_console.c                      |   14 +-
 drivers/tty/hvc/hvcs.c                             |   21 +-
 drivers/tty/ipwireless/tty.c                       |   27 +-
 drivers/tty/moxa.c                                 |    2 +-
 drivers/tty/n_gsm.c                                |    4 +-
 drivers/tty/n_tty.c                                |    3 +-
 drivers/tty/pty.c                                  |    4 +-
 drivers/tty/rocket.c                               |    6 +-
 drivers/tty/serial/kgdboc.c                        |   32 +-
 drivers/tty/serial/samsung.c                       |    9 +-
 drivers/tty/serial/serial_core.c                   |    8 +-
 drivers/tty/synclink.c                             |   34 +-
 drivers/tty/synclink_gt.c                          |   28 +-
 drivers/tty/synclinkmp.c                           |   34 +-
 drivers/tty/tty_io.c                               |    2 +-
 drivers/tty/tty_ldisc.c                            |   10 +-
 drivers/tty/tty_port.c                             |   22 +-
 drivers/uio/uio.c                                  |   21 +-
 drivers/usb/atm/cxacru.c                           |    2 +-
 drivers/usb/atm/usbatm.c                           |   24 +-
 drivers/usb/core/devices.c                         |    6 +-
 drivers/usb/core/hcd.c                             |    4 +-
 drivers/usb/core/message.c                         |    2 +-
 drivers/usb/core/sysfs.c                           |    2 +-
 drivers/usb/core/usb.c                             |    2 +-
 drivers/usb/early/ehci-dbgp.c                      |   16 +-
 drivers/usb/gadget/u_serial.c                      |   22 +-
 drivers/usb/serial/console.c                       |    6 +-
 drivers/usb/storage/usb.h                          |    2 +-
 drivers/usb/wusbcore/wa-hc.h                       |    4 +-
 drivers/usb/wusbcore/wa-xfer.c                     |    2 +-
 drivers/vhost/vringh.c                             |    2 +-
 drivers/video/aty/aty128fb.c                       |    2 +-
 drivers/video/aty/atyfb_base.c                     |    8 +-
 drivers/video/aty/mach64_cursor.c                  |    5 +-
 drivers/video/backlight/kb3886_bl.c                |    2 +-
 drivers/video/fb_defio.c                           |    6 +-
 drivers/video/fbcmap.c                             |    3 +-
 drivers/video/fbmem.c                              |    6 +-
 drivers/video/i810/i810_accel.c                    |    1 +
 drivers/video/mb862xx/mb862xxfb_accel.c            |   16 +-
 drivers/video/nvidia/nvidia.c                      |   27 +-
 drivers/video/output.c                             |    2 +-
 drivers/video/s1d13xxxfb.c                         |    6 +-
 drivers/video/smscufx.c                            |    4 +-
 drivers/video/udlfb.c                              |   36 +-
 drivers/video/uvesafb.c                            |   53 +-
 drivers/video/vesafb.c                             |   58 +-
 drivers/video/via/via_clock.h                      |    2 +-
 fs/9p/vfs_addr.c                                   |    2 +-
 fs/9p/vfs_inode.c                                  |    2 +-
 fs/Kconfig.binfmt                                  |    2 +-
 fs/aio.c                                           |   12 +-
 fs/autofs4/waitq.c                                 |    2 +-
 fs/befs/endian.h                                   |    4 +-
 fs/befs/linuxvfs.c                                 |    2 +-
 fs/binfmt_aout.c                                   |   23 +-
 fs/binfmt_elf.c                                    |  607 ++-
 fs/binfmt_flat.c                                   |    6 +
 fs/bio.c                                           |    6 +-
 fs/block_dev.c                                     |    2 +-
 fs/btrfs/ctree.c                                   |    9 +-
 fs/btrfs/super.c                                   |    2 +-
 fs/cachefiles/bind.c                               |    6 +-
 fs/cachefiles/daemon.c                             |    8 +-
 fs/cachefiles/internal.h                           |   12 +-
 fs/cachefiles/namei.c                              |    2 +-
 fs/cachefiles/proc.c                               |   12 +-
 fs/cachefiles/rdwr.c                               |    2 +-
 fs/ceph/dir.c                                      |    2 +-
 fs/cifs/cifs_debug.c                               |   12 +-
 fs/cifs/cifsfs.c                                   |    8 +-
 fs/cifs/cifsglob.h                                 |   54 +-
 fs/cifs/link.c                                     |    2 +-
 fs/cifs/misc.c                                     |    4 +-
 fs/cifs/smb1ops.c                                  |   80 +-
 fs/cifs/smb2ops.c                                  |   84 +-
 fs/cifs/smb2pdu.c                                  |    3 +-
 fs/coda/cache.c                                    |   10 +-
 fs/compat.c                                        |    6 +-
 fs/compat_binfmt_elf.c                             |    2 +
 fs/compat_ioctl.c                                  |   12 +-
 fs/configfs/dir.c                                  |   10 +-
 fs/coredump.c                                      |   24 +-
 fs/dcache.c                                        |    2 +-
 fs/ecryptfs/inode.c                                |    4 +-
 fs/ecryptfs/miscdev.c                              |    2 +-
 fs/exec.c                                          |  362 ++-
 fs/ext4/ext4.h                                     |   20 +-
 fs/ext4/mballoc.c                                  |   44 +-
 fs/ext4/mmp.c                                      |    2 +-
 fs/ext4/super.c                                    |    4 +-
 fs/fhandle.c                                       |    3 +-
 fs/fs_struct.c                                     |    8 +-
 fs/fscache/cookie.c                                |   36 +-
 fs/fscache/internal.h                              |  196 +-
 fs/fscache/object.c                                |   28 +-
 fs/fscache/operation.c                             |   30 +-
 fs/fscache/page.c                                  |  110 +-
 fs/fscache/stats.c                                 |  344 +-
 fs/fuse/cuse.c                                     |   10 +-
 fs/fuse/dev.c                                      |    4 +-
 fs/fuse/dir.c                                      |    2 +-
 fs/gfs2/inode.c                                    |    2 +-
 fs/hugetlbfs/inode.c                               |   13 +-
 fs/inode.c                                         |    4 +-
 fs/jffs2/erase.c                                   |    3 +-
 fs/jffs2/wbuf.c                                    |    3 +-
 fs/jfs/super.c                                     |    2 +-
 fs/libfs.c                                         |   10 +-
 fs/lockd/clntproc.c                                |    4 +-
 fs/lockd/svc.c                                     |    2 +-
 fs/locks.c                                         |    8 +-
 fs/namei.c                                         |   15 +-
 fs/namespace.c                                     |   10 +-
 fs/nfs/callback.c                                  |    4 +-
 fs/nfs/callback_xdr.c                              |    2 +-
 fs/nfs/inode.c                                     |    6 +-
 fs/nfs/nfs4state.c                                 |    2 +-
 fs/nfsd/nfs4proc.c                                 |    2 +-
 fs/nfsd/nfs4xdr.c                                  |    6 +-
 fs/nfsd/nfscache.c                                 |    9 +-
 fs/nfsd/vfs.c                                      |    6 +-
 fs/nls/nls_base.c                                  |   18 +-
 fs/nls/nls_euc-jp.c                                |    6 +-
 fs/nls/nls_koi8-ru.c                               |    6 +-
 fs/notify/fanotify/fanotify_user.c                 |    4 +-
 fs/notify/notification.c                           |    4 +-
 fs/ntfs/dir.c                                      |    2 +-
 fs/ntfs/file.c                                     |    4 +-
 fs/ocfs2/localalloc.c                              |    2 +-
 fs/ocfs2/ocfs2.h                                   |   10 +-
 fs/ocfs2/suballoc.c                                |   12 +-
 fs/ocfs2/super.c                                   |   20 +-
 fs/pipe.c                                          |   61 +-
 fs/proc/array.c                                    |   20 +
 fs/proc/base.c                                     |    4 +-
 fs/proc/kcore.c                                    |   32 +-
 fs/proc/meminfo.c                                  |    2 +-
 fs/proc/nommu.c                                    |    2 +-
 fs/proc/proc_sysctl.c                              |   18 +-
 fs/proc/self.c                                     |    2 +-
 fs/proc/task_mmu.c                                 |   39 +-
 fs/proc/task_nommu.c                               |    4 +-
 fs/proc/vmcore.c                                   |   12 +-
 fs/qnx6/qnx6.h                                     |    4 +-
 fs/quota/netlink.c                                 |    4 +-
 fs/read_write.c                                    |    2 +-
 fs/readdir.c                                       |    2 +-
 fs/reiserfs/do_balan.c                             |    2 +-
 fs/reiserfs/procfs.c                               |    2 +-
 fs/reiserfs/reiserfs.h                             |    4 +-
 fs/seq_file.c                                      |    2 +-
 fs/splice.c                                        |   40 +-
 fs/sysfs/bin.c                                     |    6 +-
 fs/sysfs/dir.c                                     |    2 +-
 fs/sysfs/file.c                                    |   10 +-
 fs/sysfs/symlink.c                                 |    2 +-
 fs/sysv/sysv.h                                     |    2 +-
 fs/ubifs/io.c                                      |    2 +-
 fs/udf/misc.c                                      |    2 +-
 fs/ufs/swab.h                                      |    4 +-
 fs/xattr.c                                         |   21 +
 fs/xattr_acl.c                                     |    4 +-
 fs/xfs/xfs_bmap.c                                  |    2 +-
 fs/xfs/xfs_dir2_sf.c                               |   10 +-
 fs/xfs/xfs_ioctl.c                                 |    2 +-
 fs/xfs/xfs_iops.c                                  |    2 +-
 include/asm-generic/4level-fixup.h                 |    2 +
 include/asm-generic/atomic-long.h                  |  210 +
 include/asm-generic/atomic.h                       |    2 +-
 include/asm-generic/atomic64.h                     |   12 +
 include/asm-generic/cache.h                        |    4 +-
 include/asm-generic/emergency-restart.h            |    2 +-
 include/asm-generic/kmap_types.h                   |    4 +-
 include/asm-generic/local.h                        |   13 +
 include/asm-generic/pgtable-nopmd.h                |   18 +-
 include/asm-generic/pgtable-nopud.h                |   15 +-
 include/asm-generic/pgtable.h                      |    8 +
 include/asm-generic/vmlinux.lds.h                  |   10 +-
 include/crypto/algapi.h                            |    2 +-
 include/drm/drmP.h                                 |   17 +-
 include/drm/drm_crtc_helper.h                      |    2 +-
 include/drm/ttm/ttm_memory.h                       |    2 +-
 include/keys/asymmetric-subtype.h                  |    2 +-
 include/linux/atmdev.h                             |    4 +-
 include/linux/binfmts.h                            |    3 +-
 include/linux/blkdev.h                             |    2 +-
 include/linux/blktrace_api.h                       |    2 +-
 include/linux/cache.h                              |    4 +
 include/linux/cdrom.h                              |    1 -
 include/linux/cleancache.h                         |    2 +-
 include/linux/clk-provider.h                       |    1 +
 include/linux/compat.h                             |    4 +-
 include/linux/compiler-gcc4.h                      |   20 +
 include/linux/compiler.h                           |   65 +-
 include/linux/completion.h                         |    6 +-
 include/linux/configfs.h                           |    2 +-
 include/linux/cpu.h                                |    2 +-
 include/linux/cpufreq.h                            |    3 +-
 include/linux/cpuidle.h                            |    5 +-
 include/linux/cpumask.h                            |   12 +-
 include/linux/crypto.h                             |    6 +-
 include/linux/ctype.h                              |    2 +-
 include/linux/decompress/mm.h                      |    2 +-
 include/linux/devfreq.h                            |    2 +-
 include/linux/device.h                             |    7 +-
 include/linux/dma-mapping.h                        |    2 +-
 include/linux/dmaengine.h                          |    4 +-
 include/linux/efi.h                                |    1 +
 include/linux/elf.h                                |    2 +
 include/linux/err.h                                |    4 +-
 include/linux/extcon.h                             |    2 +-
 include/linux/fb.h                                 |    2 +-
 include/linux/filter.h                             |    4 +
 include/linux/frontswap.h                          |    2 +-
 include/linux/fs.h                                 |    3 +-
 include/linux/fs_struct.h                          |    2 +-
 include/linux/fscache-cache.h                      |    4 +-
 include/linux/fscache.h                            |    2 +-
 include/linux/fsnotify.h                           |    2 +-
 include/linux/genhd.h                              |    2 +-
 include/linux/genl_magic_func.h                    |    2 +-
 include/linux/gfp.h                                |   12 +-
 include/linux/highmem.h                            |   12 +
 include/linux/hwmon-sysfs.h                        |    5 +-
 include/linux/i2c.h                                |    1 +
 include/linux/i2o.h                                |    2 +-
 include/linux/if_pppox.h                           |    2 +-
 include/linux/init.h                               |   33 +-
 include/linux/init_task.h                          |    7 +
 include/linux/interrupt.h                          |    8 +-
 include/linux/iommu.h                              |    2 +-
 include/linux/ioport.h                             |    2 +-
 include/linux/irq.h                                |    3 +-
 include/linux/irqchip/arm-gic.h                    |    4 +-
 include/linux/key-type.h                           |    2 +-
 include/linux/kgdb.h                               |    6 +-
 include/linux/kobject.h                            |    3 +-
 include/linux/kobject_ns.h                         |    2 +-
 include/linux/kref.h                               |    2 +-
 include/linux/kvm_host.h                           |    4 +-
 include/linux/libata.h                             |    2 +-
 include/linux/list.h                               |   15 +
 include/linux/math64.h                             |    6 +-
 include/linux/mm.h                                 |  116 +-
 include/linux/mm_types.h                           |   20 +
 include/linux/mmiotrace.h                          |    4 +-
 include/linux/mmzone.h                             |    2 +-
 include/linux/mod_devicetable.h                    |    6 +-
 include/linux/module.h                             |   60 +-
 include/linux/moduleloader.h                       |   16 +
 include/linux/moduleparam.h                        |    4 +-
 include/linux/namei.h                              |    6 +-
 include/linux/net.h                                |    2 +-
 include/linux/netdevice.h                          |    3 +-
 include/linux/netfilter.h                          |    2 +-
 include/linux/netfilter/ipset/ip_set.h             |    2 +-
 include/linux/netfilter/nfnetlink.h                |    2 +-
 include/linux/nls.h                                |    2 +-
 include/linux/notifier.h                           |    3 +-
 include/linux/oprofile.h                           |    4 +-
 include/linux/pci_hotplug.h                        |    3 +-
 include/linux/perf_event.h                         |   12 +-
 include/linux/pipe_fs_i.h                          |    8 +-
 include/linux/platform_data/usb-ehci-s5p.h         |    2 +-
 include/linux/platform_data/usb-ohci-exynos.h      |    2 +-
 include/linux/pm_domain.h                          |    2 +-
 include/linux/pm_runtime.h                         |    2 +-
 include/linux/pnp.h                                |    2 +-
 include/linux/poison.h                             |    4 +-
 include/linux/power/smartreflex.h                  |    2 +-
 include/linux/ppp-comp.h                           |    2 +-
 include/linux/proc_ns.h                            |    2 +-
 include/linux/random.h                             |    5 +
 include/linux/rculist.h                            |   16 +
 include/linux/reboot.h                             |   14 +-
 include/linux/regset.h                             |    3 +-
 include/linux/relay.h                              |    2 +-
 include/linux/rio.h                                |    2 +-
 include/linux/rmap.h                               |    4 +-
 include/linux/sched.h                              |   65 +-
 include/linux/sched/sysctl.h                       |    1 +
 include/linux/seq_file.h                           |    1 +
 include/linux/skbuff.h                             |   12 +-
 include/linux/slab.h                               |   42 +-
 include/linux/slab_def.h                           |   28 +-
 include/linux/slob_def.h                           |    4 +-
 include/linux/slub_def.h                           |    8 +-
 include/linux/sock_diag.h                          |    2 +-
 include/linux/sonet.h                              |    2 +-
 include/linux/sunrpc/addr.h                        |    8 +-
 include/linux/sunrpc/clnt.h                        |    2 +-
 include/linux/sunrpc/svc.h                         |    2 +-
 include/linux/sunrpc/svc_rdma.h                    |   18 +-
 include/linux/sunrpc/svcauth.h                     |    2 +-
 include/linux/swiotlb.h                            |    3 +-
 include/linux/syscalls.h                           |   10 +-
 include/linux/syscore_ops.h                        |    2 +-
 include/linux/sysctl.h                             |    6 +-
 include/linux/sysfs.h                              |   10 +-
 include/linux/sysrq.h                              |    3 +-
 include/linux/thread_info.h                        |    7 +
 include/linux/tty.h                                |    4 +-
 include/linux/tty_driver.h                         |    2 +-
 include/linux/tty_ldisc.h                          |    2 +-
 include/linux/types.h                              |   16 +
 include/linux/uaccess.h                            |    6 +-
 include/linux/unaligned/access_ok.h                |   24 +-
 include/linux/usb.h                                |    4 +-
 include/linux/usb/renesas_usbhs.h                  |    2 +-
 include/linux/vermagic.h                           |   21 +-
 include/linux/vmalloc.h                            |   11 +-
 include/linux/vmstat.h                             |   20 +-
 include/linux/xattr.h                              |    5 +-
 include/linux/zlib.h                               |    3 +-
 include/media/v4l2-dev.h                           |    2 +-
 include/net/9p/transport.h                         |    2 +-
 include/net/bluetooth/l2cap.h                      |    2 +-
 include/net/caif/cfctrl.h                          |    6 +-
 include/net/flow.h                                 |    2 +-
 include/net/genetlink.h                            |    2 +-
 include/net/gro_cells.h                            |    2 +-
 include/net/inet_connection_sock.h                 |    2 +-
 include/net/inetpeer.h                             |    8 +-
 include/net/ip.h                                   |    2 +-
 include/net/ip_fib.h                               |    2 +-
 include/net/ip_vs.h                                |    8 +-
 include/net/irda/ircomm_tty.h                      |    1 +
 include/net/iucv/af_iucv.h                         |    2 +-
 include/net/llc_c_ac.h                             |    2 +-
 include/net/llc_c_ev.h                             |    4 +-
 include/net/llc_c_st.h                             |    2 +-
 include/net/llc_s_ac.h                             |    2 +-
 include/net/llc_s_st.h                             |    2 +-
 include/net/mac80211.h                             |    2 +-
 include/net/neighbour.h                            |    2 +-
 include/net/net_namespace.h                        |   12 +-
 include/net/netdma.h                               |    2 +-
 include/net/netlink.h                              |    2 +-
 include/net/netns/conntrack.h                      |    6 +-
 include/net/netns/ipv4.h                           |    2 +-
 include/net/netns/ipv6.h                           |    2 +-
 include/net/protocol.h                             |    4 +-
 include/net/rtnetlink.h                            |    2 +-
 include/net/sctp/sctp.h                            |    6 +-
 include/net/sctp/sm.h                              |    4 +-
 include/net/sctp/structs.h                         |    2 +-
 include/net/sock.h                                 |    6 +-
 include/net/tcp.h                                  |    8 +-
 include/net/xfrm.h                                 |    8 +-
 include/rdma/iw_cm.h                               |    2 +-
 include/scsi/libfc.h                               |    3 +-
 include/scsi/scsi_device.h                         |    6 +-
 include/scsi/scsi_transport_fc.h                   |    3 +-
 include/sound/compress_driver.h                    |    2 +-
 include/sound/soc.h                                |    4 +-
 include/target/target_core_base.h                  |    2 +-
 include/trace/events/irq.h                         |    4 +-
 include/uapi/linux/a.out.h                         |    8 +
 include/uapi/linux/byteorder/little_endian.h       |   28 +-
 include/uapi/linux/elf.h                           |   28 +
 include/uapi/linux/screen_info.h                   |    3 +-
 include/uapi/linux/swab.h                          |    6 +-
 include/uapi/linux/sysctl.h                        |    6 +-
 include/uapi/linux/xattr.h                         |    4 +
 include/video/udlfb.h                              |    8 +-
 include/video/uvesafb.h                            |    1 +
 init/Kconfig                                       |    2 +-
 init/Makefile                                      |    3 +
 init/do_mounts.c                                   |   14 +-
 init/do_mounts.h                                   |    8 +-
 init/do_mounts_initrd.c                            |   30 +-
 init/do_mounts_md.c                                |    6 +-
 init/init_task.c                                   |    4 +
 init/initramfs.c                                   |   42 +-
 init/main.c                                        |   83 +-
 ipc/ipc_sysctl.c                                   |   10 +-
 ipc/mq_sysctl.c                                    |    2 +-
 ipc/msg.c                                          |   11 +-
 ipc/sem.c                                          |   11 +-
 ipc/shm.c                                          |   17 +-
 kernel/acct.c                                      |    2 +-
 kernel/audit.c                                     |    8 +-
 kernel/auditfilter.c                               |    2 +-
 kernel/auditsc.c                                   |    4 +-
 kernel/capability.c                                |    3 +
 kernel/compat.c                                    |   38 +-
 kernel/debug/debug_core.c                          |   16 +-
 kernel/debug/kdb/kdb_main.c                        |    4 +-
 kernel/events/core.c                               |   30 +-
 kernel/events/internal.h                           |   10 +-
 kernel/exit.c                                      |    4 +-
 kernel/fork.c                                      |  167 +-
 kernel/futex.c                                     |    9 +
 kernel/futex_compat.c                              |    2 +-
 kernel/gcov/base.c                                 |    7 +-
 kernel/hrtimer.c                                   |    4 +-
 kernel/irq_work.c                                  |    7 +-
 kernel/jump_label.c                                |    5 +
 kernel/kallsyms.c                                  |   39 +-
 kernel/kexec.c                                     |    3 +-
 kernel/kmod.c                                      |    4 +-
 kernel/kprobes.c                                   |    8 +-
 kernel/ksysfs.c                                    |    2 +-
 kernel/lockdep.c                                   |    7 +-
 kernel/module.c                                    |  337 +-
 kernel/mutex-debug.c                               |   12 +-
 kernel/mutex-debug.h                               |    4 +-
 kernel/mutex.c                                     |   11 +-
 kernel/notifier.c                                  |   17 +-
 kernel/panic.c                                     |    3 +-
 kernel/pid.c                                       |    2 +-
 kernel/pid_namespace.c                             |    2 +-
 kernel/posix-cpu-timers.c                          |    4 +-
 kernel/posix-timers.c                              |   22 +-
 kernel/power/process.c                             |   12 +-
 kernel/profile.c                                   |   14 +-
 kernel/ptrace.c                                    |    8 +-
 kernel/rcupdate.c                                  |    4 +-
 kernel/rcutiny.c                                   |    4 +-
 kernel/rcutiny_plugin.h                            |    2 +-
 kernel/rcutorture.c                                |   56 +-
 kernel/rcutree.c                                   |   76 +-
 kernel/rcutree.h                                   |   24 +-
 kernel/rcutree_plugin.h                            |   20 +-
 kernel/rcutree_trace.c                             |   22 +-
 kernel/rtmutex-tester.c                            |   24 +-
 kernel/sched/auto_group.c                          |    4 +-
 kernel/sched/core.c                                |   51 +-
 kernel/sched/fair.c                                |    4 +-
 kernel/sched/sched.h                               |    2 +-
 kernel/signal.c                                    |   12 +-
 kernel/smp.c                                       |    2 +-
 kernel/smpboot.c                                   |    4 +-
 kernel/softirq.c                                   |   18 +-
 kernel/srcu.c                                      |    4 +-
 kernel/sys.c                                       |   10 +-
 kernel/sysctl.c                                    |   39 +-
 kernel/time.c                                      |    2 +-
 kernel/time/alarmtimer.c                           |    2 +-
 kernel/time/tick-broadcast.c                       |    2 +-
 kernel/time/timer_stats.c                          |   10 +-
 kernel/timer.c                                     |    6 +-
 kernel/trace/blktrace.c                            |    6 +-
 kernel/trace/ftrace.c                              |   18 +-
 kernel/trace/ring_buffer.c                         |   76 +-
 kernel/trace/trace.c                               |    2 +-
 kernel/trace/trace.h                               |    2 +-
 kernel/trace/trace_events.c                        |   25 +-
 kernel/trace/trace_mmiotrace.c                     |    8 +-
 kernel/trace/trace_output.c                        |   12 +-
 kernel/trace/trace_stack.c                         |    2 +-
 kernel/user_namespace.c                            |    2 +-
 kernel/utsname_sysctl.c                            |    2 +-
 kernel/watchdog.c                                  |    2 +-
 kernel/workqueue.c                                 |    2 +-
 lib/Kconfig.debug                                  |    8 +-
 lib/Makefile                                       |    2 +-
 lib/bitmap.c                                       |    8 +-
 lib/bug.c                                          |    2 +
 lib/debugobjects.c                                 |    2 +-
 lib/devres.c                                       |    4 +-
 lib/div64.c                                        |    4 +-
 lib/dma-debug.c                                    |    4 +-
 lib/inflate.c                                      |    2 +-
 lib/ioremap.c                                      |    4 +-
 lib/kobject.c                                      |    6 +-
 lib/list_debug.c                                   |  126 +-
 lib/radix-tree.c                                   |    2 +-
 lib/strncpy_from_user.c                            |    2 +-
 lib/strnlen_user.c                                 |    2 +-
 lib/swiotlb.c                                      |    2 +-
 lib/usercopy.c                                     |    6 +
 lib/vsprintf.c                                     |   12 +-
 mm/Kconfig                                         |    6 +-
 mm/backing-dev.c                                   |    4 +-
 mm/filemap.c                                       |    2 +-
 mm/fremap.c                                        |    5 +
 mm/highmem.c                                       |    7 +-
 mm/hugetlb.c                                       |   70 +-
 mm/internal.h                                      |    1 +
 mm/maccess.c                                       |    4 +-
 mm/madvise.c                                       |   41 +
 mm/memory-failure.c                                |   26 +-
 mm/memory.c                                        |  424 ++-
 mm/mempolicy.c                                     |   26 +
 mm/mlock.c                                         |   15 +-
 mm/mmap.c                                          |  606 ++-
 mm/mprotect.c                                      |  139 +-
 mm/mremap.c                                        |   44 +-
 mm/nommu.c                                         |   21 +-
 mm/page-writeback.c                                |    4 +-
 mm/page_alloc.c                                    |   41 +-
 mm/page_io.c                                       |    2 +-
 mm/percpu.c                                        |    2 +-
 mm/process_vm_access.c                             |   14 +-
 mm/rmap.c                                          |   38 +-
 mm/shmem.c                                         |   19 +-
 mm/slab.c                                          |   79 +-
 mm/slab.h                                          |    5 +-
 mm/slab_common.c                                   |   46 +-
 mm/slob.c                                          |  201 +-
 mm/slub.c                                          |   79 +-
 mm/sparse-vmemmap.c                                |    4 +-
 mm/sparse.c                                        |    2 +-
 mm/swap.c                                          |    3 +
 mm/swapfile.c                                      |   12 +-
 mm/util.c                                          |    6 +
 mm/vmalloc.c                                       |   77 +-
 mm/vmstat.c                                        |   12 +-
 net/8021q/vlan.c                                   |    5 +-
 net/9p/mod.c                                       |    4 +-
 net/9p/trans_fd.c                                  |    2 +-
 net/atm/atm_misc.c                                 |    8 +-
 net/atm/lec.h                                      |    2 +-
 net/atm/proc.c                                     |    6 +-
 net/atm/resources.c                                |    4 +-
 net/ax25/sysctl_net_ax25.c                         |    2 +-
 net/batman-adv/bat_iv_ogm.c                        |    8 +-
 net/batman-adv/hard-interface.c                    |    4 +-
 net/batman-adv/soft-interface.c                    |    4 +-
 net/batman-adv/types.h                             |    6 +-
 net/batman-adv/unicast.c                           |    2 +-
 net/bluetooth/hci_core.c                           |    8 +-
 net/bluetooth/hci_sock.c                           |    2 +-
 net/bluetooth/l2cap_core.c                         |    6 +-
 net/bluetooth/l2cap_sock.c                         |   12 +-
 net/bluetooth/rfcomm/sock.c                        |    4 +-
 net/bluetooth/rfcomm/tty.c                         |   10 +-
 net/bridge/netfilter/ebtables.c                    |    6 +-
 net/caif/cfctrl.c                                  |   11 +-
 net/can/af_can.c                                   |    2 +-
 net/can/gw.c                                       |    6 +-
 net/compat.c                                       |   34 +-
 net/core/datagram.c                                |    2 +-
 net/core/dev.c                                     |   16 +-
 net/core/flow.c                                    |    8 +-
 net/core/iovec.c                                   |    4 +-
 net/core/neighbour.c                               |    2 +-
 net/core/net-sysfs.c                               |    2 +-
 net/core/net_namespace.c                           |    8 +-
 net/core/rtnetlink.c                               |   13 +-
 net/core/scm.c                                     |    8 +-
 net/core/sock.c                                    |   24 +-
 net/core/sock_diag.c                               |    9 +-
 net/core/sysctl_net_core.c                         |   18 +-
 net/decnet/af_decnet.c                             |    1 +
 net/decnet/sysctl_net_decnet.c                     |    4 +-
 net/ipv4/af_inet.c                                 |    8 +-
 net/ipv4/ah4.c                                     |    2 +-
 net/ipv4/devinet.c                                 |   18 +-
 net/ipv4/esp4.c                                    |    2 +-
 net/ipv4/fib_frontend.c                            |    6 +-
 net/ipv4/fib_semantics.c                           |    2 +-
 net/ipv4/inet_connection_sock.c                    |    2 +-
 net/ipv4/inetpeer.c                                |    4 +-
 net/ipv4/ip_fragment.c                             |   15 +-
 net/ipv4/ip_gre.c                                  |    6 +-
 net/ipv4/ip_sockglue.c                             |    2 +-
 net/ipv4/ip_vti.c                                  |    4 +-
 net/ipv4/ipcomp.c                                  |    2 +-
 net/ipv4/ipconfig.c                                |    6 +-
 net/ipv4/ipip.c                                    |    4 +-
 net/ipv4/netfilter/arp_tables.c                    |   12 +-
 net/ipv4/netfilter/ip_tables.c                     |   12 +-
 net/ipv4/ping.c                                    |    2 +-
 net/ipv4/raw.c                                     |   14 +-
 net/ipv4/route.c                                   |   18 +-
 net/ipv4/sysctl_net_ipv4.c                         |   45 +-
 net/ipv4/tcp_input.c                               |    2 +-
 net/ipv4/tcp_probe.c                               |    2 +-
 net/ipv4/udp.c                                     |   10 +-
 net/ipv4/xfrm4_policy.c                            |   14 +-
 net/ipv6/addrconf.c                                |   12 +-
 net/ipv6/icmp.c                                    |    2 +-
 net/ipv6/ip6_gre.c                                 |    8 +-
 net/ipv6/ip6_tunnel.c                              |    4 +-
 net/ipv6/ipv6_sockglue.c                           |    2 +-
 net/ipv6/netfilter/ip6_tables.c                    |   12 +-
 net/ipv6/netfilter/nf_conntrack_reasm.c            |   14 +-
 net/ipv6/raw.c                                     |   19 +-
 net/ipv6/reassembly.c                              |   13 +-
 net/ipv6/route.c                                   |    2 +-
 net/ipv6/sit.c                                     |    4 +-
 net/ipv6/sysctl_net_ipv6.c                         |    2 +-
 net/ipv6/udp.c                                     |    8 +-
 net/ipv6/xfrm6_policy.c                            |   13 +-
 net/irda/ircomm/ircomm_tty.c                       |   18 +-
 net/iucv/af_iucv.c                                 |    4 +-
 net/iucv/iucv.c                                    |    2 +-
 net/key/af_key.c                                   |    4 +-
 net/mac80211/cfg.c                                 |    8 +-
 net/mac80211/ieee80211_i.h                         |    3 +-
 net/mac80211/iface.c                               |   16 +-
 net/mac80211/main.c                                |    2 +-
 net/mac80211/pm.c                                  |    6 +-
 net/mac80211/rate.c                                |    2 +-
 net/mac80211/rc80211_pid_debugfs.c                 |    2 +-
 net/mac80211/util.c                                |    4 +-
 net/netfilter/ipset/ip_set_core.c                  |    2 +-
 net/netfilter/ipvs/ip_vs_conn.c                    |    6 +-
 net/netfilter/ipvs/ip_vs_core.c                    |    4 +-
 net/netfilter/ipvs/ip_vs_ctl.c                     |   14 +-
 net/netfilter/ipvs/ip_vs_lblc.c                    |    2 +-
 net/netfilter/ipvs/ip_vs_lblcr.c                   |    2 +-
 net/netfilter/ipvs/ip_vs_sync.c                    |    6 +-
 net/netfilter/ipvs/ip_vs_xmit.c                    |    4 +-
 net/netfilter/nf_conntrack_acct.c                  |    2 +-
 net/netfilter/nf_conntrack_ecache.c                |    2 +-
 net/netfilter/nf_conntrack_helper.c                |    2 +-
 net/netfilter/nf_conntrack_proto.c                 |    2 +-
 net/netfilter/nf_conntrack_proto_dccp.c            |    4 +-
 net/netfilter/nf_conntrack_standalone.c            |    2 +-
 net/netfilter/nf_conntrack_timestamp.c             |    2 +-
 net/netfilter/nf_log.c                             |   10 +-
 net/netfilter/nf_sockopt.c                         |    4 +-
 net/netfilter/nfnetlink_log.c                      |    4 +-
 net/netfilter/xt_statistic.c                       |    8 +-
 net/netlink/af_netlink.c                           |    4 +-
 net/netlink/genetlink.c                            |   16 +-
 net/packet/af_packet.c                             |   12 +-
 net/phonet/pep.c                                   |    6 +-
 net/phonet/socket.c                                |    2 +-
 net/phonet/sysctl.c                                |    2 +-
 net/rds/cong.c                                     |    6 +-
 net/rds/ib.h                                       |    2 +-
 net/rds/ib_cm.c                                    |    2 +-
 net/rds/ib_recv.c                                  |    4 +-
 net/rds/iw.h                                       |    2 +-
 net/rds/iw_cm.c                                    |    2 +-
 net/rds/iw_recv.c                                  |    4 +-
 net/rds/rds.h                                      |    2 +-
 net/rds/tcp.c                                      |    2 +-
 net/rds/tcp_send.c                                 |    2 +-
 net/rxrpc/af_rxrpc.c                               |    2 +-
 net/rxrpc/ar-ack.c                                 |   14 +-
 net/rxrpc/ar-call.c                                |    2 +-
 net/rxrpc/ar-connection.c                          |    2 +-
 net/rxrpc/ar-connevent.c                           |    2 +-
 net/rxrpc/ar-input.c                               |    4 +-
 net/rxrpc/ar-internal.h                            |    8 +-
 net/rxrpc/ar-local.c                               |    2 +-
 net/rxrpc/ar-output.c                              |    4 +-
 net/rxrpc/ar-peer.c                                |    2 +-
 net/rxrpc/ar-proc.c                                |    4 +-
 net/rxrpc/ar-transport.c                           |    2 +-
 net/rxrpc/rxkad.c                                  |    4 +-
 net/sctp/ipv6.c                                    |    6 +-
 net/sctp/protocol.c                                |   10 +-
 net/sctp/sm_sideeffect.c                           |    2 +-
 net/sctp/socket.c                                  |   21 +-
 net/sctp/sysctl.c                                  |    4 +-
 net/socket.c                                       |   18 +-
 net/sunrpc/clnt.c                                  |    4 +-
 net/sunrpc/sched.c                                 |    4 +-
 net/sunrpc/svc.c                                   |    6 +-
 net/sunrpc/xprtrdma/svc_rdma.c                     |   38 +-
 net/sunrpc/xprtrdma/svc_rdma_recvfrom.c            |    6 +-
 net/sunrpc/xprtrdma/svc_rdma_sendto.c              |    2 +-
 net/sunrpc/xprtrdma/svc_rdma_transport.c           |   10 +-
 net/tipc/link.c                                    |    6 +-
 net/tipc/msg.c                                     |    2 +-
 net/tipc/subscr.c                                  |    2 +-
 net/unix/sysctl_net_unix.c                         |    2 +-
 net/wireless/wext-core.c                           |   19 +-
 net/xfrm/xfrm_policy.c                             |   27 +-
 net/xfrm/xfrm_state.c                              |   29 +-
 net/xfrm/xfrm_sysctl.c                             |    2 +-
 scripts/Makefile.build                             |    2 +-
 scripts/Makefile.clean                             |    3 +-
 scripts/Makefile.host                              |   28 +-
 scripts/basic/fixdep.c                             |   12 +-
 scripts/gcc-plugin.sh                              |   17 +
 scripts/headers_install.sh                         |    1 +
 scripts/link-vmlinux.sh                            |    2 +-
 scripts/mod/file2alias.c                           |   14 +-
 scripts/mod/modpost.c                              |   25 +-
 scripts/mod/modpost.h                              |    6 +-
 scripts/mod/sumversion.c                           |    2 +-
 scripts/package/builddeb                           |    1 +
 scripts/pnmtologo.c                                |    6 +-
 scripts/sortextable.h                              |    6 +-
 security/Kconfig                                   |  676 +++-
 security/apparmor/lsm.c                            |    2 +-
 security/integrity/ima/ima.h                       |    4 +-
 security/integrity/ima/ima_api.c                   |    2 +-
 security/integrity/ima/ima_fs.c                    |    4 +-
 security/integrity/ima/ima_queue.c                 |    2 +-
 security/keys/compat.c                             |    2 +-
 security/keys/internal.h                           |    2 +-
 security/keys/key.c                                |   18 +-
 security/keys/keyctl.c                             |    8 +-
 security/keys/keyring.c                            |    6 +-
 security/security.c                                |    9 +-
 security/selinux/hooks.c                           |    2 +-
 security/selinux/include/xfrm.h                    |    2 +-
 security/smack/smack_lsm.c                         |    2 +-
 security/tomoyo/tomoyo.c                           |    2 +-
 security/yama/yama_lsm.c                           |   22 +-
 sound/aoa/codecs/onyx.c                            |    7 +-
 sound/aoa/codecs/onyx.h                            |    1 +
 sound/core/oss/pcm_oss.c                           |   18 +-
 sound/core/pcm_compat.c                            |    2 +-
 sound/core/pcm_native.c                            |    4 +-
 sound/core/seq/seq_device.c                        |    8 +-
 sound/core/sound.c                                 |    2 +-
 sound/drivers/mts64.c                              |   14 +-
 sound/drivers/opl4/opl4_lib.c                      |    2 +-
 sound/drivers/portman2x4.c                         |    3 +-
 sound/firewire/amdtp.c                             |    4 +-
 sound/firewire/amdtp.h                             |    2 +-
 sound/firewire/isight.c                            |   10 +-
 sound/firewire/scs1x.c                             |    8 +-
 sound/oss/sb_audio.c                               |    2 +-
 sound/oss/swarm_cs4297a.c                          |    6 +-
 sound/pci/ymfpci/ymfpci.h                          |    2 +-
 sound/pci/ymfpci/ymfpci_main.c                     |   12 +-
 sound/soc/fsl/fsl_ssi.c                            |    2 +-
 sound/sound_core.c                                 |    2 +-
 tools/gcc/.gitignore                               |    1 +
 tools/gcc/Makefile                                 |   45 +
 tools/gcc/checker_plugin.c                         |  172 +
 tools/gcc/colorize_plugin.c                        |  151 +
 tools/gcc/constify_plugin.c                        |  560 ++
 tools/gcc/generate_size_overflow_hash.sh           |   94 +
 tools/gcc/kallocstat_plugin.c                      |  170 +
 tools/gcc/kernexec_plugin.c                        |  465 ++
 tools/gcc/latent_entropy_plugin.c                  |  327 ++
 tools/gcc/size_overflow_hash.data                  | 5893 ++++++++++++++++++++
 tools/gcc/size_overflow_plugin.c                   | 2114 +++++++
 tools/gcc/stackleak_plugin.c                       |  327 ++
 tools/gcc/structleak_plugin.c                      |  277 +
 tools/perf/util/include/asm/alternative-asm.h      |    3 +
 tools/perf/util/include/linux/compiler.h           |    8 +
 virt/kvm/kvm_main.c                                |   32 +-
 1607 files changed, 30734 insertions(+), 7318 deletions(-)
commit a00016a11e35e91aec8e2d9b6ec4c6fbb11d6d2b
Merge: 0949bd4 fc53d63
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 22 19:03:44 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit fc53d6338964741b368070ec5c935bc579b8c2a6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 22 19:02:45 2012 -0400

    Update to pax-linux-3.2.12-test33.patch

commit 0949bd46a6455b308f66ad7c993bfee62412db35
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 22 16:56:09 2012 -0400

    Use current_umask() instead of current->fs->umask

commit 22f6432d0fe733619cfcb523782ed7d80c46d645
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Mar 21 19:42:42 2012 -0400

    compile fix

commit 0cad49d6b8fbb32395da924c1665a1110a9a9eef
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Mar 21 19:34:56 2012 -0400

    Resolve some very tricky hash table manipulations that resulted in an infinite loop in certain
    uses of domains with particular hash collisions

commit 47fc52e0a068a29d6cca2f809daf0679cba33c44
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 20:25:49 2012 -0400

    zero kernel_role

commit b00953b43c69238d181d21121ef1577c988d5f6b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 19:29:34 2012 -0400

    zero real_root after releasing it

commit 0b3ab73ce5d34a2c3206955cd65eddd6bdfd32a1
Merge: b724f59 273f98e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 19:11:26 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit 273f98e58cdac555d3b5dce5c1ca168349f95878
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 19:10:52 2012 -0400

    Temporary workaround for (most) size_overflow plugin false-positives
    Increase randomization for brk-managed heap to 21 bits
    Update to pax-linux-3.2.12-test32.patch

commit b724f59125304460c2af8bd4b02921993afbb5d3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 18:58:53 2012 -0400

    compile fix

commit 329f1a9d0f137d0a973316c53bbec18a6eeecd4f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 18:52:23 2012 -0400

    Require default and kernel role

commit a7c5c4f55bdd61cfcd0fb1be7a67160429409878
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 18:47:28 2012 -0400

    Allow policies without special roles
    don't call free_variables in error path of copy_user_acl, we'll call it later (triggered by a policy without special roles)

commit 402ec3d24d66d38403dc543c84851f5e72d39e22
Merge: 8e012dc f14661a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 19 18:06:59 2012 -0400

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	fs/namei.c

commit f14661aaf202155c97f66626cea0269017bb7775
Merge: eae671f 058b017
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 19 18:05:44 2012 -0400

    Merge branch 'linux-3.2.y' into pax-test

commit 8e012dcf7a50b7cde34c2cec93ecedd049123b75
Author: Ryusuke Konishi <konishi.ryusuke@lab.ntt.co.jp>
Date:   Fri Mar 16 17:08:39 2012 -0700

    nilfs2: fix NULL pointer dereference in nilfs_load_super_block()
    
    According to the report from Slicky Devil, nilfs caused kernel oops at
    nilfs_load_super_block function during mount after he shrank the
    partition without resizing the filesystem:
    
     BUG: unable to handle kernel NULL pointer dereference at 00000048
     IP: [<d0d7a08e>] nilfs_load_super_block+0x17e/0x280 [nilfs2]
     *pde = 00000000
     Oops: 0000 [#1] PREEMPT SMP
     ...
     Call Trace:
      [<d0d7a87b>] init_nilfs+0x4b/0x2e0 [nilfs2]
      [<d0d6f707>] nilfs_mount+0x447/0x5b0 [nilfs2]
      [<c0226636>] mount_fs+0x36/0x180
      [<c023d961>] vfs_kern_mount+0x51/0xa0
      [<c023ddae>] do_kern_mount+0x3e/0xe0
      [<c023f189>] do_mount+0x169/0x700
      [<c023fa9b>] sys_mount+0x6b/0xa0
      [<c04abd1f>] sysenter_do_call+0x12/0x28
     Code: 53 18 8b 43 20 89 4b 18 8b 4b 24 89 53 1c 89 43 24 89 4b 20 8b 43
     20 c7 43 2c 00 00 00 00 23 75 e8 8b 50 68 89 53 28 8b 54 b3 20 <8b> 72
     48 8b 7a 4c 8b 55 08 89 b3 84 00 00 00 89 bb 88 00 00 00
     EIP: [<d0d7a08e>] nilfs_load_super_block+0x17e/0x280 [nilfs2] SS:ESP 0068:ca9bbdcc
     CR2: 0000000000000048
    
    This turned out due to a defect in an error path which runs if the
    calculated location of the secondary super block was invalid.
    
    This patch fixes it and eliminates the reported oops.
    
    Reported-by: Slicky Devil <slicky.dvl@gmail.com>
    Signed-off-by: Ryusuke Konishi <konishi.ryusuke@lab.ntt.co.jp>
    Tested-by: Slicky Devil <slicky.dvl@gmail.com>
    Cc: <stable@vger.kernel.org>	[2.6.30+]
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 8067d7f69bf27dc08057a771cf125e71e4575bf2
Author: Haogang Chen <haogangchen@gmail.com>
Date:   Fri Mar 16 17:08:38 2012 -0700

    nilfs2: clamp ns_r_segments_percentage to [1, 99]
    
    ns_r_segments_percentage is read from the disk.  Bogus or malicious
    value could cause integer overflow and malfunction due to meaningless
    disk usage calculation.  This patch reports error when mounting such
    bogus volumes.
    
    Signed-off-by: Haogang Chen <haogangchen@gmail.com>
    Signed-off-by: Ryusuke Konishi <konishi.ryusuke@lab.ntt.co.jp>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit e1a90645643f9b0194a5984ec8febd06360d5c8b
Author: Eric Dumazet <eric.dumazet@gmail.com>
Date:   Sat Mar 10 09:20:21 2012 +0000

    tcp: fix syncookie regression
    
    commit ea4fc0d619 (ipv4: Don't use rt->rt_{src,dst} in ip_queue_xmit())
    added a serious regression on synflood handling.
    
    Simon Kirby discovered a successful connection was delayed by 20 seconds
    before being responsive.
    
    In my tests, I discovered that xmit frames were lost, and needed ~4
    retransmits and a socket dst rebuild before being really sent.
    
    In case of syncookie initiated connection, we use a different path to
    initialize the socket dst, and inet->cork.fl.u.ip4 is left cleared.
    
    As ip_queue_xmit() now depends on inet flow being setup, fix this by
    copying the temp flowi4 we use in cookie_v4_check().
    
    Reported-by: Simon Kirby <sim@netnation.com>
    Bisected-by: Simon Kirby <sim@netnation.com>
    Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
    Tested-by: Eric Dumazet <eric.dumazet@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit 06c6c8628bf38b08b4d97f4c55cde9fdecfb5d65
Author: Stanislav Kinsbursky <skinsbursky@parallels.com>
Date:   Mon Mar 12 02:59:41 2012 +0000

    tun: don't hold network namespace by tun sockets
    
    v3: added previously removed sock_put() to the tun_release() callback, because
    sk_release_kernel() doesn't drop the socket reference.
    
    v2: sk_release_kernel() used for socket release. Dummy tun_release() is
    required for sk_release_kernel() ---> sock_release() ---> sock->ops->release()
    call.
    
    TUN was designed to destroy it's socket on network namesapce shutdown. But this
    will never happen for persistent device, because it's socket holds network
    namespace.
    This patch removes of holding network namespace by TUN socket and replaces it
    by creating socket in init_net and then changing it's net it to desired one. On
    shutdown socket is moved back to init_net prior to final put.
    
    Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit 46ae7374bd387c58d673a9e58852a9fd31042c5c
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Mon Dec 12 10:02:30 2011 -0600

    vfs: Correctly set the dir i_mutex lockdep class
    
    9a7aa12f3911853a introduced additional logic around setting the i_mutex
    lockdep class for directory inodes. The idea was that some filesystems
    may want their own special lockdep class for different directory
    inodes and calling unlock_new_inode() should not clobber one of
    those special classes.
    
    I believe that the added conditional, around the *negated* return value
    of lockdep_match_class(), caused directory inodes to be placed in the
    wrong lockdep class.
    
    inode_init_always() sets the i_mutex lockdep class with i_mutex_key for
    all inodes. If the filesystem did not change the class during inode
    initialization, then the conditional mentioned above was false and the
    directory inode was incorrectly left in the non-directory lockdep class.
    If the filesystem did set a special lockdep class, then the conditional
    mentioned above was true and that class was clobbered with
    i_mutex_dir_key.
    
    This patch removes the negation from the conditional so that the i_mutex
    lockdep class is properly set for directory inodes. Special classes are
    preserved and directory inodes with unmodified classes are set with
    i_mutex_dir_key.
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Reviewed-by: Jan Kara <jack@suse.cz>
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

commit 603590b0d2eca61ce26499eac9c563bc567a18c9
Author: Jan Kara <jack@suse.cz>
Date:   Mon Feb 20 17:54:00 2012 +0100

    udf: Fix deadlock in udf_release_file()
    
    udf_release_file() can be called from munmap() path with mmap_sem held.  Thus
    we cannot take i_mutex there because that ranks above mmap_sem. Luckily,
    i_mutex is not needed in udf_release_file() anymore since protection by
    i_data_sem is enough to protect from races with write and truncate.
    
    Reported-by: Al Viro <viro@ZenIV.linux.org.uk>
    Reviewed-by: Namjae Jeon <linkinjeon@gmail.com>
    Signed-off-by: Jan Kara <jack@suse.cz>
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

commit ca79ab9034f3c2f7e3f65c35e0d9ed3ecea529bf
Author: Miklos Szeredi <mszeredi@suse.cz>
Date:   Tue Mar 6 13:56:33 2012 +0100

    vfs: fix double put after complete_walk()
    
    complete_walk() already puts nd->path, no need to do it again at cleanup time.
    
    This would result in Oopses if triggered, apparently the codepath is not too
    well exercised.
    
    Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
    CC: stable@vger.kernel.org
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

commit 13885ba2b18400f3ef6540497d30f1af896605e5
Author: Miklos Szeredi <mszeredi@suse.cz>
Date:   Tue Mar 6 13:56:34 2012 +0100

    vfs: fix return value from do_last()
    
    complete_walk() returns either ECHILD or ESTALE.  do_last() turns this into
    ECHILD unconditionally.  If not in RCU mode, this error will reach userspace
    which is complete nonsense.
    
    Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
    CC: stable@vger.kernel.org
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    
    Conflicts:
    
    	fs/namei.c

commit f5ab7572c99ffb58953eb1070622307e904c3b7f
Author: Al Viro <viro@zeniv.linux.org.uk>
Date:   Sat Mar 10 17:07:28 2012 -0500

    restore smp_mb() in unlock_new_inode()
    
    wait_on_inode() doesn't have ->i_lock
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

commit f3e758cd08e3881982d4b78eb72fe8a1ead6b872
Author: David S. Miller <davem@davemloft.net>
Date:   Tue Mar 13 18:19:51 2012 -0700

    sparc32: Add -Av8 to assembler command line.
    
    Newer version of binutils are more strict about specifying the
    correct options to enable certain classes of instructions.
    
    The sparc32 build is done for v7 in order to support sun4c systems
    which lack hardware integer multiply and divide instructions.
    
    So we have to pass -Av8 when building the assembler routines that
    use these instructions and get patched into the kernel when we find
    out that we have a v8 capable cpu.
    
    Reported-by: Paul Gortmaker <paul.gortmaker@windriver.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit 66276ec78b2a971d2e704e5ef963cdc8b6a049a4
Author: Thomas Gleixner <tglx@linutronix.de>
Date:   Fri Mar 9 20:55:10 2012 +0100

    x86: Derandom delay_tsc for 64 bit
    
    Commit f0fbf0abc093 ("x86: integrate delay functions") converted
    delay_tsc() into a random delay generator for 64 bit.  The reason is
    that it merged the mostly identical versions of delay_32.c and
    delay_64.c.  Though the subtle difference of the result was:
    
     static void delay_tsc(unsigned long loops)
     {
    -	unsigned bclock, now;
    +	unsigned long bclock, now;
    
    Now the function uses rdtscl() which returns the lower 32bit of the
    TSC. On 32bit that's not problematic as unsigned long is 32bit. On 64
    bit this fails when the lower 32bit are close to wrap around when
    bclock is read, because the following check
    
           if ((now - bclock) >= loops)
           	  	break;
    
    evaluated to true on 64bit for e.g. bclock = 0xffffffff and now = 0
    because the unsigned long (now - bclock) of these values results in
    0xffffffff00000001 which is definitely larger than the loops
    value. That explains Tvortkos observation:
    
    "Because I am seeing udelay(500) (_occasionally_) being short, and
     that by delaying for some duration between 0us (yep) and 491us."
    
    Make those variables explicitely u32 again, so this works for both 32
    and 64 bit.
    
    Reported-by: Tvrtko Ursulin <tvrtko.ursulin@onelan.co.uk>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Cc: stable@vger.kernel.org # >= 2.6.27
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 2d0ddb60f5031bdf79b4d51225f9f2d5856255bf
Author: Al Viro <viro@ZenIV.linux.org.uk>
Date:   Thu Mar 8 17:51:19 2012 +0000

    aio: fix the "too late munmap()" race
    
    Current code has put_ioctx() called asynchronously from aio_fput_routine();
    that's done *after* we have killed the request that used to pin ioctx,
    so there's nothing to stop io_destroy() waiting in wait_for_all_aios()
    from progressing.  As the result, we can end up with async call of
    put_ioctx() being the last one and possibly happening during exit_mmap()
    or elf_core_dump(), neither of which expects stray munmap() being done
    to them...
    
    We do need to prevent _freeing_ ioctx until aio_fput_routine() is done
    with that, but that's all we care about - neither io_destroy() nor
    exit_aio() will progress past wait_for_all_aios() until aio_fput_routine()
    does really_put_req(), so the ioctx teardown won't be done until then
    and we don't care about the contents of ioctx past that point.
    
    Since actual freeing of these suckers is RCU-delayed, we don't need to
    bump ioctx refcount when request goes into list for async removal.
    All we need is rcu_read_lock held just over the ->ctx_lock-protected
    area in aio_fput_routine().
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Reviewed-by: Jeff Moyer <jmoyer@redhat.com>
    Acked-by: Benjamin LaHaise <bcrl@kvack.org>
    Cc: stable@vger.kernel.org
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 002124c055afbf09b52226af65621999e8316448
Author: Al Viro <viro@ZenIV.linux.org.uk>
Date:   Wed Mar 7 05:16:35 2012 +0000

    aio: fix io_setup/io_destroy race
    
    Have ioctx_alloc() return an extra reference, so that caller would drop it
    on success and not bother with re-grabbing it on failure exit.  The current
    code is obviously broken - io_destroy() from another thread that managed
    to guess the address io_setup() would've returned would free ioctx right
    under us; gets especially interesting if aio_context_t * we pass to
    io_setup() points to PROT_READ mapping, so put_user() fails and we end
    up doing io_destroy() on kioctx another thread has just got freed...
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Acked-by: Benjamin LaHaise <bcrl@kvack.org>
    Reviewed-by: Jeff Moyer <jmoyer@redhat.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit a1cd2719b8ed8e40dbd98c87713ac23a2169f6d8
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Thu Mar 15 15:17:12 2012 -0700

    drivers/video/backlight/s6e63m0.c: fix corruption storing gamma mode
    
    strict_strtoul() writes a long but ->gamma_mode only has space to store an
    int, so on 64 bit systems we end up scribbling over ->gamma_table_count as
    well.  I've changed it to use kstrtouint() instead.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Acked-by: Inki Dae <inki.dae@samsung.com>
    Signed-off-by: Florian Tobias Schandinat <FlorianSchandinat@gmx.de>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit cf83f735a5571f4341ee6eab947a1f7d833cea6e
Merge: e4b05b6 eae671f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 16 21:04:27 2012 -0400

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	security/Kconfig

commit eae671fafe93f04685c04a089cc13efebc05d600
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 16 20:58:01 2012 -0400

    Update to pax-linux-3.2.11-test31.patch
    Introduction of the size_overflow plugin from Emese Revfy
    Many thanks to Emese for her hard work :)

commit e4b05b65c645c412eceb9c950ee7b4771627e6b1
Merge: e55aa68 258c015
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 15 20:59:19 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit 258c0159fa6dd5044ca984eeaad57bb6e21bacea
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 15 20:59:05 2012 -0400

    fix ARM compilation

commit e55aa68f4bb20e75cd7423123aa612c2a69590c0
Merge: 8f95ea9 55b7573
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Mar 14 19:33:41 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit 55b7573f6c2f3be26fb39c7bd6a9d742d02811ca
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Mar 14 19:33:15 2012 -0400

    Update to pax-linux-3.2.10-test28.patch

commit 8f95ea9f718c293794a1f6bdd2a5f5f336f7bd64
Merge: c8786a2 886ac5e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 13 17:38:13 2012 -0400

    Merge branch 'pax-test' into grsec-test
    
    Greets and thanks to snq for his assistance in testing/debugging REFCOUNT on ARM :)

commit 886ac5eeb1835e87cf7398b8aae9e9ba6b36bf77
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 13 17:37:44 2012 -0400

    Update to pax-linux-3.2.10-test26.patch

commit c8786a2abed5e5327f68efa520c04db99bb6a63a
Merge: 219c982 c061fcf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 13 17:25:06 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit c061fcfa6b78f3774800821144d8ac2d94d7da3e
Merge: 89373d2 3f4b3b2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 13 17:25:02 2012 -0400

    Merge branch 'linux-3.2.y' into pax-test

commit 219c982a05abe47be4ea7d749e1b408e0cb86f1f
Merge: 54e19a3 89373d2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 12 17:23:57 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit 89373d2abafb9bda97f78bdb157d1d05cf21e008
Merge: a778588 7459f11
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 12 17:23:49 2012 -0400

    Merge branch 'linux-3.2.y' into pax-test

commit 54e19a3979978fca902b14ae25125f26fbbbc7a7
Merge: c4650f1 a778588
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 12 16:51:25 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit a778588c9d1b75c48c1f09aac98c1b28bd87a749
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 12 16:51:12 2012 -0400

    Update to pax-linux-3.2.9-test24.patch

commit c4650f14b13f84735fe3de06a1f3ff5776473eff
Merge: fb2abee 1015790
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 11 21:08:28 2012 -0400

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	security/Kconfig

commit 101579028a736c224e590c7e12a7357018c424e1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 11 21:07:27 2012 -0400

    Update to pax-linux-3.2.9-test22.patch

commit fb2abee4b9b49f5f18342a8cdf7aa3ba2b7c9100
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 11 11:02:17 2012 -0400

    Allow 4096 CPUs

commit 96bae28cbe6a41d48e3b56e5904814096e956000
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 11 10:25:58 2012 -0400

    Use a per-cpu 48-bit counter instead of a global atomic64
    Initialize each counter to have the cpu number in the lower 16 bits
    instead of incrementing the counter each time by 1, perform the increments
    above the cpu number so that wrapping/exhausting the counter doesn't corrupt
    any state
    idea from PaX Team

commit b975688101da6e966aebb1bc6b8c5c5983974f9c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Mar 10 20:33:12 2012 -0500

    Special vnsec edition! :)
    Further reduce argv/env allowance for suid/sgid apps to 512KB
    Clamp suid/sgid stack resource limit to 8MB (preventing compat mmap layout fallback/too large stack gap)
    Clear 3GB personality on suid/sgid binaries
    Restore 4 bits entropy in the lowest bits of arg/env strings (now 28 bits on x86, 39 bits on x64)
      with the main purpose of throwing off program stack -> arg/env alignment
    Update documentation

commit e5cfa902c4e891d11dd2086543d2555aa0c27d33
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Mar 10 19:54:47 2012 -0500

    Resolve skbuff.h warnings that turn into errors during compilation in
    the grsecurity directory with -Werror

commit 2023210ad43a944033fcacc660ce410888f562ee
Merge: ece4383 5f66adf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 9 19:48:01 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 5f66adf72f83730a07bc79a2fab56afed6dbbd0e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 9 19:47:06 2012 -0500

    Add colorize plugin

commit ece4383e5e91c92d138c4df84225a70b552f4d69
Merge: a366d0e ab4a5a1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 9 17:56:46 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit ab4a5a1a67289c3585e2ff8aa64ecece7bd17eea
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 9 17:56:26 2012 -0500

    Update to pax-linux-3.2.9-test21.patch

commit a366d0ed963ce93fce10121c1100989d5f064e75
Author: Mikulas Patocka <mpatocka@redhat.com>
Date:   Sun Mar 4 19:52:03 2012 -0500

    mm: fix find_vma_prev
    
    Commit 6bd4837de96e ("mm: simplify find_vma_prev()") broke memory
    management on PA-RISC.
    
    After application of the patch, programs that allocate big arrays on the
    stack crash with segfault, for example, this will crash if compiled
    without optimization:
    
      int main()
      {
    	char array[200000];
    	array[199999] = 0;
    	return 0;
      }
    
    The reason is that PA-RISC has up-growing stack and the stack is usually
    the last memory area.  In the above example, a page fault happens above
    the stack.
    
    Previously, if we passed too high address to find_vma_prev, it returned
    NULL and stored the last VMA in *pprev.  After "simplify find_vma_prev"
    change, it stores NULL in *pprev.  Consequently, the stack area is not
    found and it is not expanded, as it used to be before the change.
    
    This patch restores the old behavior and makes it return the last VMA in
    *pprev if the requested address is higher than address of any other VMA.
    
    Signed-off-by: Mikulas Patocka <mpatocka@redhat.com>
    Acked-by: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 9cd8dd4d56051099f11563f72fcd91cd0ce19604
Author: Hugh Dickins <hughd@google.com>
Date:   Tue Mar 6 12:28:52 2012 -0800

    mmap: EINVAL not ENOMEM when rejecting VM_GROWS
    
    Currently error is -ENOMEM when rejecting VM_GROWSDOWN|VM_GROWSUP
    from shared anonymous: hoist the file case's -EINVAL up for both.
    
    Signed-off-by: Hugh Dickins <hughd@google.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 97745dce6c87f9d9ca5b4be9bd4c2fc1684ca04c
Author: Al Viro <viro@ZenIV.linux.org.uk>
Date:   Mon Mar 5 06:38:42 2012 +0000

    aout: move setup_arg_pages() prior to reading/mapping the binary
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 3b20ce55ae8cffee43cb4afdf5be438b5ac4fef0
Author: Jan Beulich <JBeulich@suse.com>
Date:   Mon Mar 5 16:49:24 2012 +0000

    vsprintf: make %pV handling compatible with kasprintf()
    
    kasprintf() (and potentially other functions that I didn't run across so
    far) want to evaluate argument lists twice.  Caring to do so for the
    primary list is obviously their job, but they can't reasonably be
    expected to check the format string for instances of %pV, which however
    need special handling too: On architectures like x86-64 (as opposed to
    e.g.  ix86), using the same argument list twice doesn't produce the
    expected results, as an internally managed cursor gets updated during
    the first run.
    
    Fix the problem by always acting on a copy of the original list when
    handling %pV.
    
    Signed-off-by: Jan Beulich <jbeulich@suse.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 4146896ab9674f51d4909f3a52bc7fe80f04e4cb
Author: Al Viro <viro@ZenIV.linux.org.uk>
Date:   Mon Mar 5 06:39:47 2012 +0000

    VM_GROWS{UP,DOWN} shouldn't be set on shmem VMAs
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit a831bd53764695ea680cc1fa3c98759a610ed2ac
Author: Christian König <deathsimple@vodafone.de>
Date:   Tue Feb 28 23:19:20 2012 +0100

    drm/radeon: fix uninitialized variable
    
    Without this fix the driver randomly treats
    textures as arrays and I'm really wondering
    why gcc isn't complaining about it.
    
    Signed-off-by: Christian König <deathsimple@vodafone.de>
    Reviewed-by: Jerome Glisse <jglisse@redhat.com>
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit aa2cd55f97f3cc03bdd895b6e8ba99619ee69dfc
Author: H. Peter Anvin <hpa@zytor.com>
Date:   Fri Mar 2 10:43:48 2012 -0800

    regset: Prevent null pointer reference on readonly regsets
    
    The regset common infrastructure assumed that regsets would always
    have .get and .set methods, but not necessarily .active methods.
    Unfortunately people have since written regsets without .set methods.
    
    Rather than putting in stub functions everywhere, handle regsets with
    null .get or .set methods explicitly.
    
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>
    Reviewed-by: Oleg Nesterov <oleg@redhat.com>
    Acked-by: Roland McGrath <roland@hack.frob.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 072ddd99401c79b53c6bf6bff9deb93022124c79
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 5 18:12:57 2012 -0500

    Fix compiler errors reported on forums

commit 1606774b48af24e6f99d99c624c0e447d4b66474
Merge: 3127bd5 4ca2ffd
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 5 17:31:35 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 4ca2ffd9da024f4ba2d0cb6245ba1b2726169452
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 5 17:31:21 2012 -0500

    Update to pax-linux-3.2.9-test20.patch

commit 3127bd581a292966b1057c7433219dac188c3720
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 2 21:30:37 2012 -0500

    Fix memory leak on logged exec_id check failure in /proc/pid/statm
    Thanks to Djalal Harouni for the report

commit d9f1a3be0e97e0632f97379322712d8deeb3ce23
Merge: 0a56be8 9aa8288
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 2 18:38:22 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 9aa8288a09e6e03ce37c08136b26bff17a093b5c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 2 18:37:43 2012 -0500

    Update to pax-linux-3.2.9-test19.patch

commit 0a56be884bbd7ce733cac0b879c45383494d73b0
Merge: 9e66745 3f5c52a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 1 20:18:01 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 3f5c52aba100b3bb252980f9d363aafde52da1a2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 1 20:16:56 2012 -0500

    Update to pax-linux-3.2.9-test18.patch

commit ae53ec231d12719a36bf871f8c5841020ed692ee
Merge: b255baf 44fb317
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 1 20:15:31 2012 -0500

    Merge branch 'linux-3.2.y' into pax-test

commit 9e667456c03eadea2f305be761abe4de9a5877a3
Merge: 5e4e200 b255baf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 27 20:53:59 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit b255baf50365d39b406f43aab2c64745607baaa2
Merge: 340ce90 1de504e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 27 20:53:29 2012 -0500

    Merge branch 'linux-3.2.y' into pax-test
    Update to pax-linux-3.2.8-test17.patch
    
    Conflicts:
    	arch/x86/include/asm/i387.h
    	arch/x86/kernel/process_32.c
    	arch/x86/kernel/traps.c

commit 5e4e200ac530452884b625cb75de240e1e98c731
Merge: 44306d7 340ce90
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 27 18:02:13 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 340ce90d98a043fa8e4ed9ffc229d4c1f86e2fec
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 27 18:01:48 2012 -0500

    Update to pax-linux-3.2.7-test17.patch

commit 44306d7b3097f77e73040dd25f4f6750751bae7a
Merge: 29d0b07 521c411
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 26 19:04:15 2012 -0500

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	Makefile

commit 521c411bb4ca66ce01146fde8bac9dd22414076d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 26 19:03:33 2012 -0500

    Update to pax-linux-3.2.7-test16.patch

commit 29d0b07290bb9a10cdfcc3c30058e16265330dea
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 26 17:12:44 2012 -0500

    fix typo

commit 344f6d84e5d3fdc6ec40a078fc2f5861d340b2ef
Merge: f45b3be caa8f83
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 20:59:27 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit caa8f83456c4d0b204beefffaa1d1993f2348d08
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 20:59:12 2012 -0500

    Update to pax-linux-3.2.7-test15.patch

commit f45b3be34a345502a302e736af9a65742ddef7cb
Merge: 62f35fd 9f1309b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 11:40:15 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 9f1309b0b935e3b30fc87a9e3009b84cf943ef47
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 11:39:57 2012 -0500

    Update to pax-linux-3.2.7-test14.patch

commit 62f35fdbecc58f2988fe13638d907b87a15776bb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 09:08:55 2012 -0500

    We could log on attempted exploits of writing /proc/self/mem, but the current
    log function declares the access a read, so just swap the ordering for now

commit 066ee8f9c26f1549b4ad893508777b549c8d4b79
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 08:46:14 2012 -0500

    Log /proc/pid/mem attempts

commit 674471e581893a94d475acac3e3c4496209b3ac9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 08:15:00 2012 -0500

    Make use of f_version for protecting /proc file structs (fine since we're not a directory
    or seq_file)

commit eab42cfdd237ffcdd8ec24bedecc275a3a9e987f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 24 20:02:19 2012 -0500

    Fix ia64 compilation

commit 50dfea412fd395e0183c2ade368efa525d38b267
Merge: 12db845 4c6f99b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 24 19:00:53 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 4c6f99bf338e03966356b147d0360cb3b522a44f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 24 19:00:36 2012 -0500

    (6:57:09 PM) pipacs: but you can be proactive
    (Fix other-arch atomic64/REFCOUNT compilation failures)

commit 12db8453f6bb0a756f369c9151668ba1249bc478
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 21:10:12 2012 -0500

    Remove unnecessary copies, as suggested by solar

commit cc02cab84368467ea03cb35f861a8a7092d91ab4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 20:59:35 2012 -0500

    Make global_exec_counter static, as suggested by solar

commit e642091a475ebb3a30e81f85e7751233d0c2af43
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 19:00:26 2012 -0500

    sync with stable tree

commit 6df09c3d8e371905b7b8fe90c4188f23614c6be5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 18:48:47 2012 -0500

    Remove unneeded gr_acl_handle_fchmod, as the code is shared now by gr_acl_handle_chmod
    Remove handling of old kludge in chmod/fchmod

commit 815cb62f2ca7b58efc39778b3a855feb675ab56c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 18:18:49 2012 -0500

    Apply umask checks to chmod/fchmod as well, as requested by sponsor
    Union the enforced umask with the existing one to produce minimal privilege
    Change umask type to u16

commit 0e7668c6abbdbcd3f7f9759e3994d6f4bc9953f0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Feb 22 18:16:11 2012 -0500

    Add per-role umask enforcement to RBAC, requested by a sponsor

commit ad5ac943fe58199f1cc475912a39edb157acb77b
Merge: dda0bb5 41722e3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 20 20:04:42 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 41722e342e116d95f3d3556d66c97c888d752d39
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 20 20:04:00 2012 -0500

    Merge changes from pax-linux-3.2.7-test12.patch, fixes KVM incompatibility with
    KERNEXEC plugin

commit dda0bb57137846a476a866c60db2681aaf6052c0
Merge: 4fd554e d70927a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 20 20:01:41 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit d70927afec977d489a54c106a3c3ddc32e953050
Merge: 1daebf1 9d0231c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 20 20:01:33 2012 -0500

    Merge branch 'linux-3.2.y' into pax-test

commit 4fd554e3a097b22c5049fcdc423897477deff5ef
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 20 09:17:57 2012 -0500

    Fix wrong logic on capability checks for switching roles, broke policies
    Thanks to Richard Kojedzinszky for reporting

commit 12f97d52ac603f24344f8d71569c412a307e9422
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 21:20:10 2012 -0500

    sparc64 compile fix

commit 07af3d8e76a6a47ce1836e5b20ed8c0f879c8201
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 18:38:32 2012 -0500

    Update configuration help and name for GRKERNSEC_PROC_MEMMAP

commit 5ced6f8def06c2176b40b5fa07345fc723dc4dcb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 18:18:01 2012 -0500

    optimize the check a bit

commit 03159050f64989be44ae03be769cbed62a7cd2e5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 18:00:45 2012 -0500

    smile VUPEN :D
    (limit argv+env to 1MB for suid/sgid binaries)

commit dd759d8800d225a397e4de49fe729c7d601298d2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 17:49:33 2012 -0500

    Address Space Protection -> Memory Protections (suggested on IRC for consistency)

commit 4de635bda8ebfb85312e3bf851bdbff93de400da
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 17:45:06 2012 -0500

    Change the long long type for exec_id to the proper u64

commit 4feb07e7cb64b3d0f0f8cca1aef70bc725cae6fa
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Thu Feb 9 00:46:47 2012 +0000

    isdn: type bug in isdn_net_header()
    
    We use len to store the return value from eth_header().  eth_header()
    can return -ETH_HLEN (-14).  We want to pass this back instead of
    truncating it to 65522 and returning that.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Acked-by: Neil Horman <nhorman@tuxdriver.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit 134ac8545b47f0f27d550ea6e1edb3a1ed7a9748
Author: Heiko Carstens <heiko.carstens@de.ibm.com>
Date:   Sat Feb 4 10:47:10 2012 +0100

    exec: fix use-after-free bug in setup_new_exec()
    
    Setting the task name is done within setup_new_exec() by accessing
    bprm->filename. However this happens after flush_old_exec().
    This may result in a use after free bug, flush_old_exec() may
    "complete" vfork_done, which will wake up the parent which in turn
    may free the passed in filename.
    To fix this add a new tcomm field in struct linux_binprm which
    contains the now early generated task name until it is used.
    
    Fixes this bug on s390:
    
      Unable to handle kernel pointer dereference at virtual kernel address 0000000039768000
      Process kworker/u:3 (pid: 245, task: 000000003a3dc840, ksp: 0000000039453818)
      Krnl PSW : 0704000180000000 0000000000282e94 (setup_new_exec+0xa0/0x374)
      Call Trace:
      ([<0000000000282e2c>] setup_new_exec+0x38/0x374)
       [<00000000002dd12e>] load_elf_binary+0x402/0x1bf4
       [<0000000000280a42>] search_binary_handler+0x38e/0x5bc
       [<0000000000282b6c>] do_execve_common+0x410/0x514
       [<0000000000282cb6>] do_execve+0x46/0x58
       [<00000000005bce58>] kernel_execve+0x28/0x70
       [<000000000014ba2e>] ____call_usermodehelper+0x102/0x140
       [<00000000005bc8da>] kernel_thread_starter+0x6/0xc
       [<00000000005bc8d4>] kernel_thread_starter+0x0/0xc
      Last Breaking-Event-Address:
       [<00000000002830f0>] setup_new_exec+0x2fc/0x374
    
      Kernel panic - not syncing: Fatal exception: panic_on_oops
    
    Reported-by: Sebastian Ott <sebott@linux.vnet.ibm.com>
    Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit d758ee9f5230893dabb5aab737b3109684bde196
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Fri Feb 10 09:03:58 2012 +0100

    relay: prevent integer overflow in relay_open()
    
    "subbuf_size" and "n_subbufs" come from the user and they need to be
    capped to prevent an integer overflow.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Cc: stable@kernel.org
    Signed-off-by: Jens Axboe <axboe@kernel.dk>

commit 40ed7b34848b8e0d7bf9a3fc21a7c75ce1ae507c
Merge: b1baadf 1daebf1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 13 17:47:04 2012 -0500

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	fs/proc/base.c

commit 1daebf1d623fe5b0efdd329f78562eb7078bc772
Merge: 1413df2 c2db2e2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 13 17:45:54 2012 -0500

    Merge branch 'linux-3.2.y' into pax-test

commit b1baadf5047ab67cf61cd20bf58c6afb09c37c7d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 12 16:44:05 2012 -0500

    add missing declaration

commit 3981059c35e8463002517935c28f3d74b8e3703c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 12 16:36:04 2012 -0500

    Require CAP_SETUID/CAP_SETGID in a subject in order to change roles
    in addition to existing checks (this handles the setresuid ruid = euid case)

commit 0beab03263c773f463412c350ad9064b44b6ede0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 12 16:13:40 2012 -0500

    Revert setreuid changes when RBAC is enabled, breaks freeradius
    I'll fix the learning issue Lavish reported a different way through
    gradm modifications
    
    This reverts commit d54ec64b7078f1dcb71b5d8a29e47d4a0f46c111.

commit 0c61cb1cfbbfec7d07647268c922d51434d22621
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 11 14:22:46 2012 -0500

    copy exec_id on fork

commit 000c08e0890630086b2ed04084050ed856a7ec31
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 10 20:00:36 2012 -0500

    compile fix

commit 54b8c8f54484e5ee18040657827158bc4b63bccc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 10 19:19:52 2012 -0500

    Introduce enhancement to CONFIG_GRKERNSEC_PROC_MEMMAP
    denies reading of sensitive /proc/pid entries where the file descriptor
    was opened in a different task than the one performing the read

commit dd19579049186e2648b9ae5e42af04cfda7ab2dc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 10 17:43:24 2012 -0500

    Remove duplicate signal check

commit 6ff60c34155bb73a4eec7bbfe6f59e9d35e1c0c6
Merge: 4eba97e 1413df2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Feb 8 19:24:34 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 1413df258d4664d928b876ffb57e1bdc1ccd06f6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Feb 8 19:24:08 2012 -0500

    Merge changes from pax-linux-3.2.4-test11.patch

commit 4eba97eda7f7d25b7ab6ad5c9de094545e749044
Merge: 0e058dd 8dd90a2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 6 17:50:12 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 8dd90a21adfeefd86134d1fedf77b958bc59eaa3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 6 17:49:07 2012 -0500

    Merge changes from pax-linux-3.2.4-test10.patch, fixes BPF JIT double-free

commit a6b5dfed0937a0eb386b4b519a387f8e8177ffdc
Merge: 7e4169c 6133971
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 6 17:48:57 2012 -0500

    Merge branch 'linux-3.2.y' into pax-test

commit 0e058dd6d14e0c67c44dd332a871f1fe1bb06095
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 5 19:24:45 2012 -0500

    We now allow configurations with no PaX markings, giving the system no way to override the defaults

commit 9afb0110287e31c3c56d861b4927f64f8dbd7857
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 5 10:01:23 2012 -0500

    Increase the buffer size of logged TPE reason, otherwise we could truncate the "y" in directory

commit a6a0ad24a5f7bef90236d94c1bdfe21d291fc834
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 4 21:01:16 2012 -0500

    Improve security of ptrace-based monitoring/sandboxing
    See:
    http://article.gmane.org/gmane.linux.kernel.lsm/15156

commit ca4ca5a1027b41f9528794e52a53ce9c47926101
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 20:42:55 2012 -0500

    fix typo

commit d54ec64b7078f1dcb71b5d8a29e47d4a0f46c111
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 20:25:38 2012 -0500

    Reported by lavish on IRC:
    If a suid/sgid binary did not learn any setuid/setgid call during learning,
    we would not any CAP_SETUID/CAP_SETGID capability to the task, nor
    any restrictions on uid/gid changes.  uid and gid can however be changed
    within a suid/sgid binary via setresuid/setresgid with ruid/rgid set to
    euid/egid.
    
    My fix:
    POSIX doesn't specify whether unprivileged users can perform the above
    setresuid/setresgid as an unprivileged user, though Linux has historically
    permitted them.  Modify this behavior when RBAC is enabled to require
    CAP_SETUID/CAP_SETGID for these operations.
    
    Thanks to Lavish for the report!
    
    Conflicts:
    
    	kernel/sys.c

commit e55be1f30908f1ad4450cb0558cde71ff5c7247f
Merge: ba586eb 7e4169c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 20:10:21 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 7e4169c6c880ec9641f1178c88545913c8a21e1f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 20:10:05 2012 -0500

    Merge changes from pax-linux-3.2.4-test9.patch

commit ba586ebbcd0ed781e38a99c580a757a00347c6eb
Author: Christopher Yeoh <cyeoh@au1.ibm.com>
Date:   Thu Feb 2 11:34:09 2012 +1030

    Fix race in process_vm_rw_core
    
    This fixes the race in process_vm_core found by Oleg (see
    
      http://article.gmane.org/gmane.linux.kernel/1235667/
    
    for details).
    
    This has been updated since I last sent it as the creation of the new
    mm_access() function did almost exactly the same thing as parts of the
    previous version of this patch did.
    
    In order to use mm_access() even when /proc isn't enabled, we move it to
    kernel/fork.c where other related process mm access functions already
    are.
    
    Signed-off-by: Chris Yeoh <yeohc@au1.ibm.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/proc/base.c
    	mm/process_vm_access.c

commit b9194d60fb9fe579f5c34817ed822abde18939a0
Author: Oleg Nesterov <oleg@redhat.com>
Date:   Tue Jan 31 17:15:11 2012 +0100

    proc: make sure mem_open() doesn't pin the target's memory
    
    Once /proc/pid/mem is opened, the memory can't be released until
    mem_release() even if its owner exits.
    
    Change mem_open() to do atomic_inc(mm_count) + mmput(), this only
    pins mm_struct. Change mem_rw() to do atomic_inc_not_zero(mm_count)
    before access_remote_vm(), this verifies that this mm is still alive.
    
    I am not sure what should mem_rw() return if atomic_inc_not_zero()
    fails. With this patch it returns zero to match the "mm == NULL" case,
    may be it should return -EINVAL like it did before e268337d.
    
    Perhaps it makes sense to add the additional fatal_signal_pending()
    check into the main loop, to ensure we do not hold this memory if
    the target task was oom-killed.
    
    Cc: stable@kernel.org
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit d4500134f9363bc79556e0e7a1fd811cd8552cc4
Author: Oleg Nesterov <oleg@redhat.com>
Date:   Tue Jan 31 17:14:38 2012 +0100

    proc: mem_release() should check mm != NULL
    
    mem_release() can hit mm == NULL, add the necessary check.
    
    Cc: stable@kernel.org
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 5d1c11221a86f233fdbb232312a561f85d0a3a05
Author: Oleg Nesterov <oleg@redhat.com>
Date:   Tue Jan 31 17:14:54 2012 +0100

    note: redisabled mem_write
    
    proc: unify mem_read() and mem_write()
    
    No functional changes, cleanup and preparation.
    
    mem_read() and mem_write() are very similar. Move this code into the
    new common helper, mem_rw(), which takes the additional "int write"
    argument.
    
    Cc: stable@kernel.org
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/proc/base.c

commit af966b421d9f55ab7e1a8b2741beba44b22bc2e0
Merge: 3903f01 01fee18
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 19:50:40 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 01fee1851aef26b898ccba5312cabf1f919b74cb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 19:49:46 2012 -0500

    Merge changes from pax-linux-3.2.4-test8.patch

commit c2490ddbfc3f5dd664dd0e1b8575856c3be01879
Merge: 201c0db 141936c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 19:49:01 2012 -0500

    Merge branch 'linux-3.2.y' into pax-test

commit 3903f0172ecadf7a575ba3535402a1506133640a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 30 23:26:44 2012 -0500

    Implement new version of CONFIG_GRKERNSEC_SYSFS_RESTRICT
    
    We'll whitelist required directories for compatibility instead of requiring
    that people disable the feature entirely if they use SELinux, fuse, etc
    
    Conflicts:
    
    	fs/sysfs/mount.c

commit e3618feaa7e63807f1b88c199882075b3ec9bd05
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jan 29 01:12:19 2012 -0500

    perform RBAC check if TPE is on but match fails, matches previous behavior

commit 627b7fe22799a86e2f81a74f0e0c53474bec3100
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jan 28 13:17:06 2012 -0500

    log more information about the reason for a TPE denial for novice users, requested by a sponsor

commit efefd67008cbad8a8591e2484410966a300a39a5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:58:53 2012 -0500

    merge upstream sha512 changes

commit 8a79280377db78fb2091fe01eddb9e24f75d9fe1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:49:07 2012 -0500

    drop lock on error in xfs_readlink
    
    http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=aaad641eadfd3e74b0fbb68fcf539b9cef0415d0

commit aa5f2f63e37f426bf2211c5fb8f7bc70de14f08a
Author: Li Wang <liwang@nudt.edu.cn>
Date:   Thu Jan 19 09:44:36 2012 +0800

    eCryptfs: Infinite loop due to overflow in ecryptfs_write()
    
    ecryptfs_write() can enter an infinite loop when truncating a file to a
    size larger than 4G. This only happens on architectures where size_t is
    represented by 32 bits.
    
    This was caused by a size_t overflow due to it incorrectly being used to
    store the result of a calculation which uses potentially large values of
    type loff_t.
    
    [tyhicks@canonical.com: rewrite subject and commit message]
    Signed-off-by: Li Wang <liwang@nudt.edu.cn>
    Signed-off-by: Yunchuan Wen <wenyunchuan@kylinos.com.cn>
    Reviewed-by: Cong Wang <xiyou.wangcong@gmail.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>

commit a7607747d0f74f357d78bb796d70635dd05f46e8
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Thu Jan 19 20:33:44 2012 -0600

    eCryptfs: Check inode changes in setattr
    
    Most filesystems call inode_change_ok() very early in ->setattr(), but
    eCryptfs didn't call it at all. It allowed the lower filesystem to make
    the call in its ->setattr() function. Then, eCryptfs would copy the
    appropriate inode attributes from the lower inode to the eCryptfs inode.
    
    This patch changes that and actually calls inode_change_ok() on the
    eCryptfs inode, fairly early in ecryptfs_setattr(). Ideally, the call
    would happen earlier in ecryptfs_setattr(), but there are some possible
    inode initialization steps that must happen first.
    
    Since the call was already being made on the lower inode, the change in
    functionality should be minimal, except for the case of a file extending
    truncate call. In that case, inode_newsize_ok() was never being
    called on the eCryptfs inode. Rather than inode_newsize_ok() catching
    maximum file size errors early on, eCryptfs would encrypt zeroed pages
    and write them to the lower filesystem until the lower filesystem's
    write path caught the error in generic_write_checks(). This patch
    introduces a new function, called ecryptfs_inode_newsize_ok(), which
    checks if the new lower file size is within the appropriate limits when
    the truncate operation will be growing the lower file.
    
    In summary this change prevents eCryptfs truncate operations (and the
    resulting page encryptions), which would exceed the lower filesystem
    limits or FSIZE rlimits, from ever starting.
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Reviewed-by: Li Wang <liwang@nudt.edu.cn>
    Cc: <stable@vger.kernel.org>

commit 0d96f190a39505254ace4e9330219aaeda9b64e3
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Wed Jan 18 18:30:04 2012 -0600

    eCryptfs: Make truncate path killable
    
    ecryptfs_write() handles the truncation of eCryptfs inodes. It grabs a
    page, zeroes out the appropriate portions, and then encrypts the page
    before writing it to the lower filesystem. It was unkillable and due to
    the lack of sparse file support could result in tying up a large portion
    of system resources, while encrypting pages of zeros, with no way for
    the truncate operation to be stopped from userspace.
    
    This patch adds the ability for ecryptfs_write() to detect a pending
    fatal signal and return as gracefully as possible. The intent is to
    leave the lower file in a useable state, while still allowing a user to
    break out of the encryption loop. If a pending fatal signal is detected,
    the eCryptfs inode size is updated to reflect the modified inode size
    and then -EINTR is returned.
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Cc: <stable@vger.kernel.org>

commit a02d0d2516b9e92edffeb8fca87462bca49c1f6f
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Tue Jan 24 10:02:22 2012 -0600

    eCryptfs: Fix oops when printing debug info in extent crypto functions
    
    If pages passed to the eCryptfs extent-based crypto functions are not
    mapped and the module parameter ecryptfs_verbosity=1 was specified at
    loading time, a NULL pointer dereference will occur.
    
    Note that this wouldn't happen on a production system, as you wouldn't
    pass ecryptfs_verbosity=1 on a production system. It leaks private
    information to the system logs and is for debugging only.
    
    The debugging info printed in these messages is no longer very useful
    and rather than doing a kmap() in these debugging paths, it will be
    better to simply remove the debugging paths completely.
    
    https://launchpad.net/bugs/913651
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Reported-by: Daniel DeFreez
    Cc: <stable@vger.kernel.org>

commit b1c44d3054dc7f293b2e0a98c0e9e5e03e01f04c
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Thu Jan 12 11:30:44 2012 +0100

    eCryptfs: Sanitize write counts of /dev/ecryptfs
    
    A malicious count value specified when writing to /dev/ecryptfs may
    result in a a very large kernel memory allocation.
    
    This patch peeks at the specified packet payload size, adds that to the
    size of the packet headers and compares the result with the write count
    value. The resulting maximum memory allocation size is approximately 532
    bytes.
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Reported-by: Sasha Levin <levinsasha928@gmail.com>
    Cc: <stable@vger.kernel.org>

commit 96dcb7282d323813181a1791f51c0ab7696b675b
Merge: 6c09fa5 201c0db
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:44:15 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 201c0dbf177527367676028151e36d340923f033
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:43:24 2012 -0500

    Merge changes from pax-linux-3.2.2-test6.patch, fixes 0 order vmalloc allocation errors
    on loading modules with empty sections

commit 6c09fa566a7c29f00556ca12f343f2db91c4f42b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:42:13 2012 -0500

    compile fix

commit 917ae526b4fcec2b3e1afefa13de9dff7d8a5423
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:39:28 2012 -0500

    use LSM flags instead of duplicating checks

commit 0cf3be2ea2ae43c9dd4933fb26c0429041b8acb8
Merge: 44b9f11 558718b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 18:56:23 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 558718b2217beff69edf60f34a6f9893d910e9ac
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 18:56:04 2012 -0500

    Merge changes from pax-linux-3.2.2-test6.patch

commit 44b9f1132b2de7cbf5f57525fe0f7f9fb0a76507
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 18:53:55 2012 -0500

    don't increase the size of task_struct when unnecessary
    change ptrace_readexec log message

commit a9c9626e054adb885883aa64f85506852894dd33
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 18:16:28 2012 -0500

    Update documentation for CONFIG_GRKERNSEC_PTRACE_READEXEC --
    the protection applies to all unreadable binaries.

commit 98fdf4ab69eba7a72efb2054295daafdbbc2fb8f
Merge: 7b3f3af 05a1349
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jan 25 20:52:09 2012 -0500

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	block/scsi_ioctl.c
    	drivers/scsi/sd.c
    	fs/proc/base.c

commit 05a134966efb9cb9346ad3422888969ffc79ac1d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jan 25 20:47:36 2012 -0500

    Resync with pax-linux-3.2.2-test5.patch

commit 5ecaafd81b229aeeb5656df36f9c8da86307f82a
Merge: c6d443d 3499d64
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jan 25 20:45:16 2012 -0500

    Merge branch 'linux-3.2.y' into pax-test (and pax-linux-3.2.2-test5.patch)
    
    Conflicts:
    	ipc/shm.c

commit 7b3f3afd7444613c759d68ff8c2efaebfae3bab1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jan 24 19:42:01 2012 -0500

    Add two new features, one is automatic by enabling CONFIG_GRKERNSEC
    (may be changed if it breaks some userland), the other has its own
    config option
    
    First feature requires CAP_SYS_ADMIN to write to any sysctl entry via
    the syscall or /proc/sys.
    
    Second feature requires read access to a suid/sgid binary in order
    to ptrace it, preventing infoleaking of binaries in situations where
    the admin has specified 4711 or 2711 perms.  Feature has been
    given the config option CONFIG_GRKERNSEC_PTRACE_READEXEC and
    a sysctl entry of ptrace_readexec

commit 11a7bb25c411c9dccfdca5718639b4becdffd388
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jan 22 14:37:10 2012 -0500

    Compilation fixes

commit cd400e21c7c352baba47d6f375297a7847afb33a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jan 22 14:20:27 2012 -0500

    Initial port of grsecurity 2.2.2 for Linux 3.2.1
    Note that the new syscalls added to this kernel for remote process read/write
    are subject to ptrace hardening/other relevant RBAC features
    /proc/slabinfo is S_IRUSR via mainline now, so I made slab_allocators S_IRUSR by default
    as well
    pax_track_stack has been removed from support for this kernel -- if you're running this kernel
    you should be using a version of gcc with plugin support

commit c6d443d1270f455c56a4ffe0f1dd3d3e7ec12a2f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jan 22 11:47:31 2012 -0500

    Import pax-linux-3.2.1-test5.patch
commit bfd7db842f835f9837cd43644459b3a95b0b488d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jan 22 11:02:02 2012 -0500

    Allow processes to access others' /proc/pid/maps files (subject to the normal modification of data)
    instead of returning -EACCES
    thanks to Wraith from irc for the report

commit 873ac13576506cd48ddb527c2540f274e249da50
Merge: 34083dd 8a44fcc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 20 18:04:02 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 8a44fcc90cf3368003dc84e1ed013b2e4248c9b2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 20 18:02:15 2012 -0500

    Merge the diff between pax-linux-3.2.1-test4.patch and pax-linux-3.2.1-test5.patch
    Denies executable shared memory when MPROTECT is active
    Fixes ia32 emulation crash on 64bit host introduced in a recent patch

commit 34083ddf5c0b2b1c0f5e9f7d9e32ddcba223446b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jan 19 20:23:14 2012 -0500

    Introduce new GRKERNSEC_SETXID implementation
    We're not able to change the credentials of other threads in the process until at most
    one syscall after the first thread does it, since we mark the threads as needing rescheduling
    and such work occurs on syscall exit.
    This does however ensure that we're only modifying the current task's credentials
    which upholds RCU expectations
    
    Many thanks to corsac for testing

commit 5f900ad54d3992a4e1cda88273acc2f897a42e71
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jan 19 17:42:48 2012 -0500

    Simplify backport

commit f02e444f7b2fb286f99d3b4031ff4e44a4606c37
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jan 19 17:08:16 2012 -0500

    Commit the latest silent fix for a local privilege escalation from Linus
    Also disable writing to /proc/pid/mem
    http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=e268337dfe26dfc7efd422a804dbb27977a3cccc

commit 814d38c72b1ee3338294576a05af4f6ca9cffa6c
Merge: 0394a3f 7e6299b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jan 18 20:22:09 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 7e6299b4733c082dde930375dd207b63237751ec
Merge: 83555fb 9bb1282
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jan 18 20:21:37 2012 -0500

    Merge branch 'linux-3.1.y' into pax-test

commit 0394a3f36c6195dcaf22e265c94d11bb7338c6f7
Author: Jesper Juhl <jj@chaosbits.net>
Date:   Sun Jan 8 22:44:29 2012 +0100

    audit: always follow va_copy() with va_end()
    
    A call to va_copy() should always be followed by a call to va_end() in
    the same function.  In kernel/autit.c::audit_log_vformat() this is not
    always done.  This patch makes sure va_end() is always called.
    
    Signed-off-by: Jesper Juhl <jj@chaosbits.net>
    Cc: Al Viro <viro@zeniv.linux.org.uk>
    Cc: Eric Paris <eparis@redhat.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit fcbb39319e88bfdf70efe3931cf80a9f23b1a4d9
Author: Andi Kleen <ak@linux.intel.com>
Date:   Thu Jan 12 17:20:30 2012 -0800

    panic: don't print redundant backtraces on oops
    
    When an oops causes a panic and panic prints another backtrace it's pretty
    common to have the original oops data be scrolled away on a 80x50 screen.
    
    The second backtrace is quite redundant and not needed anyways.
    
    So don't print the panic backtrace when oops_in_progress is true.
    
    [akpm@linux-foundation.org: add comment]
    Signed-off-by: Andi Kleen <ak@linux.intel.com>
    Cc: Michael Holzheu <holzheu@linux.vnet.ibm.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 22e4717d04333e2aff6d5d1b2c1b16045f367a1f
Author: Miklos Szeredi <mszeredi@suse.cz>
Date:   Thu Jan 12 17:59:46 2012 +0100

    fsnotify: don't BUG in fsnotify_destroy_mark()
    
    Removing the parent of a watched file results in "kernel BUG at
    fs/notify/mark.c:139".
    
    To reproduce
    
      add "-w /tmp/audit/dir/watched_file" to audit.rules
      rm -rf /tmp/audit/dir
    
    This is caused by fsnotify_destroy_mark() being called without an
    extra reference taken by the caller.
    
    Reported by Francesco Cosoleto here:
    
      https://bugzilla.novell.com/show_bug.cgi?id=689860
    
    Fix by removing the BUG_ON and adding a comment about not accessing mark after
    the iput.
    
    Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
    CC: stable@vger.kernel.org
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 1a90cff66ed00cd57bf00a990d13e95060fa362c
Author: Paolo Bonzini <pbonzini@redhat.com>
Date:   Thu Jan 12 16:01:28 2012 +0100

    block: fail SCSI passthrough ioctls on partition devices
    
    Linux allows executing the SG_IO ioctl on a partition or LVM volume, and
    will pass the command to the underlying block device.  This is
    well-known, but it is also a large security problem when (via Unix
    permissions, ACLs, SELinux or a combination thereof) a program or user
    needs to be granted access only to part of the disk.
    
    This patch lets partitions forward a small set of harmless ioctls;
    others are logged with printk so that we can see which ioctls are
    actually sent.  In my tests only CDROM_GET_CAPABILITY actually occurred.
    Of course it was being sent to a (partition on a) hard disk, so it would
    have failed with ENOTTY and the patch isn't changing anything in
    practice.  Still, I'm treating it specially to avoid spamming the logs.
    
    In principle, this restriction should include programs running with
    CAP_SYS_RAWIO.  If for example I let a program access /dev/sda2 and
    /dev/sdb, it still should not be able to read/write outside the
    boundaries of /dev/sda2 independent of the capabilities.  However, for
    now programs with CAP_SYS_RAWIO will still be allowed to send the
    ioctls.  Their actions will still be logged.
    
    This patch does not affect the non-libata IDE driver.  That driver
    however already tests for bd != bd->bd_contains before issuing some
    ioctl; it could be restricted further to forbid these ioctls even for
    programs running with CAP_SYS_ADMIN/CAP_SYS_RAWIO.
    
    Cc: linux-scsi@vger.kernel.org
    Cc: Jens Axboe <axboe@kernel.dk>
    Cc: James Bottomley <JBottomley@parallels.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    [ Make it also print the command name when warning - Linus ]
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit b41a1178caa15bd7d6d5b36c04c7b1ead05717e2
Author: Paolo Bonzini <pbonzini@redhat.com>
Date:   Thu Jan 12 16:01:27 2012 +0100

    block: add and use scsi_blk_cmd_ioctl
    
    Introduce a wrapper around scsi_cmd_ioctl that takes a block device.
    
    The function will then be enhanced to detect partition block devices
    and, in that case, subject the ioctls to whitelisting.
    
    Cc: linux-scsi@vger.kernel.org
    Cc: Jens Axboe <axboe@kernel.dk>
    Cc: James Bottomley <JBottomley@parallels.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 97a79814903fc350e1d13704ea31528a42705401
Author: Kees Cook <keescook@chromium.org>
Date:   Sat Jan 7 10:41:04 2012 -0800

    audit: treat s_id as an untrusted string
    
    The use of s_id should go through the untrusted string path, just to be
    extra careful.
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Acked-by: Mimi Zohar <zohar@us.ibm.com>
    Signed-off-by: Eric Paris <eparis@redhat.com>

commit 2d3f39e9dd73f26a8248fd4442f110d983c5b419
Author: Xi Wang <xi.wang@gmail.com>
Date:   Tue Dec 20 18:39:41 2011 -0500

    audit: fix signedness bug in audit_log_execve_info()
    
    In the loop, a size_t "len" is used to hold the return value of
    audit_log_single_execve_arg(), which returns -1 on error.  In that
    case the error handling (len <= 0) will be bypassed since "len" is
    unsigned, and the loop continues with (p += len) being wrapped.
    Change the type of "len" to signed int to fix the error handling.
    
    	size_t len;
    	...
    	for (...) {
    		len = audit_log_single_execve_arg(...);
    		if (len <= 0)
    			break;
    		p += len;
    	}
    
    Signed-off-by: Xi Wang <xi.wang@gmail.com>
    Signed-off-by: Eric Paris <eparis@redhat.com>

commit 1b3dc2ea3204fb22b9d0d30b2b7953991f5be594
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Tue Jan 17 03:28:51 2012 -0300

    [media] ds3000: using logical && instead of bitwise &
    
    The intent here was to test if the FE_HAS_LOCK was set.  The current
    test is equivalent to "if (status) { ..."
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit 36522330dc59d2fc70c042f3f081d75c32b6259a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 16 13:10:38 2012 -0500

    Ignore the 0 signal for protected task RBAC checks

commit d513acd55f7a683f6e146a4f570cdb63300479ab
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 16 11:56:13 2012 -0500

    whitespace cleanup

commit ced261c4b82818c700aff8487f647f6f3e5b5122
Merge: d48751f 83555fb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 13 20:12:54 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 83555fb431e5be6c0e09687ff3bdc583f0caf9d9
Merge: fcd8129 93dad39
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 13 20:12:43 2012 -0500

    Merge branch 'linux-3.1.y' into pax-test

commit d48751f3919ae855fda0ff6c149db82442329253
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jan 11 19:05:47 2012 -0500

    Call our own set_user when forcing change to new id

commit 26d9d497f6b926bc1699980aa18c360a3d3c52a0
Merge: e6578ff fcd8129
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jan 10 16:00:10 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit fcd8129277601f2e2d5a2066120cf8b2472d7d1f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jan 10 15:58:43 2012 -0500

    Merge changes from pax-linux-3.1.8-test23.patch

commit e6578ff3e7629c432ed9b99bde6af2a1c00279b5
Merge: 8859ec3 a120549
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 6 21:45:56 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit a12054967a77090de1caa07c41e694a77db4e237
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 6 21:45:30 2012 -0500

    Merge changes from pax-linux-3.1.8-test22.patch

commit 8859ec32f9815c274df65448f9f2960176c380d3
Merge: a5016b4 ddd4114
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 6 21:26:08 2012 -0500

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	fs/binfmt_elf.c
    	security/Kconfig

commit ddd41147e158a79704983a409b7433eba797cf66
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 6 21:12:42 2012 -0500

    Resync with PaX patch (whitespace difference)

commit 29e569df8205c5f0e043fe4803aa984406c8b118
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 6 21:09:47 2012 -0500

    Merge changes from pax-linux-3.1.8-test21.patch

commit a5016b4f9c09c337b17e063a7f369af1e86d944d
Merge: 0124c92 04231d5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 6 18:52:20 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 04231d52dc8d0d6788a6bc6709dc046d3eb37097
Merge: 7bdddeb a919904
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 6 18:51:50 2012 -0500

    Merge branch 'linux-3.1.y' into pax-test
    
    Conflicts:
    	include/net/flow.h

commit 0124c9264234c450904a0a5fa2f8c608ab8e3796
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 6 18:33:05 2012 -0500

    Make GRKERNSEC_SETXID option compatible with credential debugging

commit 69919c6da7cf8a781439da15b597a7d6bc9b3abe
Author: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
Date:   Wed Dec 28 15:57:11 2011 -0800

    mm/mempolicy.c: refix mbind_range() vma issue
    
    commit 8aacc9f550 ("mm/mempolicy.c: fix pgoff in mbind vma merge") is the
    slightly incorrect fix.
    
    Why? Think following case.
    
    1. map 4 pages of a file at offset 0
    
       [0123]
    
    2. map 2 pages just after the first mapping of the same file but with
       page offset 2
    
       [0123][23]
    
    3. mbind() 2 pages from the first mapping at offset 2.
       mbind_range() should treat new vma is,
    
       [0123][23]
         |23|
         mbind vma
    
       but it does
    
       [0123][23]
         |01|
         mbind vma
    
       Oops. then, it makes wrong vma merge and splitting ([01][0123] or similar).
    
    This patch fixes it.
    
    [testcase]
      test result - before the patch
    
    	case4: 126: test failed. expect '2,4', actual '2,2,2'
           	case5: passed
    	case6: passed
    	case7: passed
    	case8: passed
    	case_n: 246: test failed. expect '4,2', actual '1,4'
    
    	------------[ cut here ]------------
    	kernel BUG at mm/filemap.c:135!
    	invalid opcode: 0000 [#4] SMP DEBUG_PAGEALLOC
    
    	(snip long bug on messages)
    
      test result - after the patch
    
    	case4: passed
           	case5: passed
    	case6: passed
    	case7: passed
    	case8: passed
    	case_n: passed
    
      source:  mbind_vma_test.c
    ============================================================
     #include <numaif.h>
     #include <numa.h>
     #include <sys/mman.h>
     #include <stdio.h>
     #include <unistd.h>
     #include <stdlib.h>
     #include <string.h>
    
    static unsigned long pagesize;
    void* mmap_addr;
    struct bitmask *nmask;
    char buf[1024];
    FILE *file;
    char retbuf[10240] = "";
    int mapped_fd;
    
    char *rubysrc = "ruby -e '\
      pid = %d; \
      vstart = 0x%llx; \
      vend = 0x%llx; \
      s = `pmap -q #{pid}`; \
      rary = []; \
      s.each_line {|line|; \
        ary=line.split(\" \"); \
        addr = ary[0].to_i(16); \
        if(vstart <= addr && addr < vend) then \
          rary.push(ary[1].to_i()/4); \
        end; \
      }; \
      print rary.join(\",\"); \
    '";
    
    void init(void)
    {
    	void* addr;
    	char buf[128];
    
    	nmask = numa_allocate_nodemask();
    	numa_bitmask_setbit(nmask, 0);
    
    	pagesize = getpagesize();
    
    	sprintf(buf, "%s", "mbind_vma_XXXXXX");
    	mapped_fd = mkstemp(buf);
    	if (mapped_fd == -1)
    		perror("mkstemp "), exit(1);
    	unlink(buf);
    
    	if (lseek(mapped_fd, pagesize*8, SEEK_SET) < 0)
    		perror("lseek "), exit(1);
    	if (write(mapped_fd, "\0", 1) < 0)
    		perror("write "), exit(1);
    
    	addr = mmap(NULL, pagesize*8, PROT_NONE,
    		    MAP_SHARED, mapped_fd, 0);
    	if (addr == MAP_FAILED)
    		perror("mmap "), exit(1);
    
    	if (mprotect(addr+pagesize, pagesize*6, PROT_READ|PROT_WRITE) < 0)
    		perror("mprotect "), exit(1);
    
    	mmap_addr = addr + pagesize;
    
    	/* make page populate */
    	memset(mmap_addr, 0, pagesize*6);
    }
    
    void fin(void)
    {
    	void* addr = mmap_addr - pagesize;
    	munmap(addr, pagesize*8);
    
    	memset(buf, 0, sizeof(buf));
    	memset(retbuf, 0, sizeof(retbuf));
    }
    
    void mem_bind(int index, int len)
    {
    	int err;
    
    	err = mbind(mmap_addr+pagesize*index, pagesize*len,
    		    MPOL_BIND, nmask->maskp, nmask->size, 0);
    	if (err)
    		perror("mbind "), exit(err);
    }
    
    void mem_interleave(int index, int len)
    {
    	int err;
    
    	err = mbind(mmap_addr+pagesize*index, pagesize*len,
    		    MPOL_INTERLEAVE, nmask->maskp, nmask->size, 0);
    	if (err)
    		perror("mbind "), exit(err);
    }
    
    void mem_unbind(int index, int len)
    {
    	int err;
    
    	err = mbind(mmap_addr+pagesize*index, pagesize*len,
    		    MPOL_DEFAULT, NULL, 0, 0);
    	if (err)
    		perror("mbind "), exit(err);
    }
    
    void Assert(char *expected, char *value, char *name, int line)
    {
    	if (strcmp(expected, value) == 0) {
    		fprintf(stderr, "%s: passed\n", name);
    		return;
    	}
    	else {
    		fprintf(stderr, "%s: %d: test failed. expect '%s', actual '%s'\n",
    			name, line,
    			expected, value);
    //		exit(1);
    	}
    }
    
    /*
          AAAA
        PPPPPPNNNNNN
        might become
        PPNNNNNNNNNN
        case 4 below
    */
    void case4(void)
    {
    	init();
    	sprintf(buf, rubysrc, getpid(), mmap_addr, mmap_addr+pagesize*6);
    
    	mem_bind(0, 4);
    	mem_unbind(2, 2);
    
    	file = popen(buf, "r");
    	fread(retbuf, sizeof(retbuf), 1, file);
    	Assert("2,4", retbuf, "case4", __LINE__);
    
    	fin();
    }
    
    /*
           AAAA
     PPPPPPNNNNNN
     might become
     PPPPPPPPPPNN
     case 5 below
    */
    void case5(void)
    {
    	init();
    	sprintf(buf, rubysrc, getpid(), mmap_addr, mmap_addr+pagesize*6);
    
    	mem_bind(0, 2);
    	mem_bind(2, 2);
    
    	file = popen(buf, "r");
    	fread(retbuf, sizeof(retbuf), 1, file);
    	Assert("4,2", retbuf, "case5", __LINE__);
    
    	fin();
    }
    
    /*
    	    AAAA
    	PPPPNNNNXXXX
    	might become
    	PPPPPPPPPPPP 6
    */
    void case6(void)
    {
    	init();
    	sprintf(buf, rubysrc, getpid(), mmap_addr, mmap_addr+pagesize*6);
    
    	mem_bind(0, 2);
    	mem_bind(4, 2);
    	mem_bind(2, 2);
    
    	file = popen(buf, "r");
    	fread(retbuf, sizeof(retbuf), 1, file);
    	Assert("6", retbuf, "case6", __LINE__);
    
    	fin();
    }
    
    /*
        AAAA
    PPPPNNNNXXXX
    might become
    PPPPPPPPXXXX 7
    */
    void case7(void)
    {
    	init();
    	sprintf(buf, rubysrc, getpid(), mmap_addr, mmap_addr+pagesize*6);
    
    	mem_bind(0, 2);
    	mem_interleave(4, 2);
    	mem_bind(2, 2);
    
    	file = popen(buf, "r");
    	fread(retbuf, sizeof(retbuf), 1, file);
    	Assert("4,2", retbuf, "case7", __LINE__);
    
    	fin();
    }
    
    /*
        AAAA
    PPPPNNNNXXXX
    might become
    PPPPNNNNNNNN 8
    */
    void case8(void)
    {
    	init();
    	sprintf(buf, rubysrc, getpid(), mmap_addr, mmap_addr+pagesize*6);
    
    	mem_bind(0, 2);
    	mem_interleave(4, 2);
    	mem_interleave(2, 2);
    
    	file = popen(buf, "r");
    	fread(retbuf, sizeof(retbuf), 1, file);
    	Assert("2,4", retbuf, "case8", __LINE__);
    
    	fin();
    }
    
    void case_n(void)
    {
    	init();
    	sprintf(buf, rubysrc, getpid(), mmap_addr, mmap_addr+pagesize*6);
    
    	/* make redundunt mappings [0][1234][34][7] */
    	mmap(mmap_addr + pagesize*4, pagesize*2, PROT_READ|PROT_WRITE,
    	     MAP_FIXED|MAP_SHARED, mapped_fd, pagesize*3);
    
    	/* Expect to do nothing. */
    	mem_unbind(2, 2);
    
    	file = popen(buf, "r");
    	fread(retbuf, sizeof(retbuf), 1, file);
    	Assert("4,2", retbuf, "case_n", __LINE__);
    
    	fin();
    }
    
    int main(int argc, char** argv)
    {
    	case4();
    	case5();
    	case6();
    	case7();
    	case8();
    	case_n();
    
    	return 0;
    }
    =============================================================
    
    Signed-off-by: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
    Acked-by: Johannes Weiner <hannes@cmpxchg.org>
    Cc: Minchan Kim <minchan.kim@gmail.com>
    Cc: Caspar Zhang <caspar@casparzhang.com>
    Cc: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
    Cc: Christoph Lameter <cl@linux.com>
    Cc: Hugh Dickins <hugh.dickins@tiscali.co.uk>
    Cc: Mel Gorman <mel@csn.ul.ie>
    Cc: Lee Schermerhorn <lee.schermerhorn@hp.com>
    Cc: <stable@vger.kernel.org>		[3.1.x]
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit f3a1082005781777086df235049f8c0b7efe524e
Author: Wei Yongjun <yongjun_wei@trendmicro.com.cn>
Date:   Tue Dec 27 22:32:41 2011 -0500

    packet: fix possible dev refcnt leak when bind fail
    
    If bind is fail when bind is called after set PACKET_FANOUT
    sock option, the dev refcnt will leak.
    
    Signed-off-by: Wei Yongjun <yongjun_wei@trendmicro.com.cn>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit 915f8b08dac68839dc7204ee81cf9852fda16d24
Author: Haogang Chen <haogangchen@gmail.com>
Date:   Mon Dec 19 17:11:56 2011 -0800

    nilfs2: potential integer overflow in nilfs_ioctl_clean_segments()
    
    There is a potential integer overflow in nilfs_ioctl_clean_segments().
    When a large argv[n].v_nmembs is passed from the userspace, the subsequent
    call to vmalloc() will allocate a buffer smaller than expected, which
    leads to out-of-bound access in nilfs_ioctl_move_blocks() and
    lfs_clean_segments().
    
    The following check does not prevent the overflow because nsegs is also
    controlled by the userspace and could be very large.
    
    		if (argv[n].v_nmembs > nsegs * nilfs->ns_blocks_per_segment)
    			goto out_free;
    
    This patch clamps argv[n].v_nmembs to UINT_MAX / argv[n].v_size, and
    returns -EINVAL when overflow.
    
    Signed-off-by: Haogang Chen <haogangchen@gmail.com>
    Signed-off-by: Ryusuke Konishi <konishi.ryusuke@lab.ntt.co.jp>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 006afb6eb7a7398edc0068c3a7b9510ffaf80f72
Author: Kautuk Consul <consul.kautuk@gmail.com>
Date:   Mon Dec 19 17:12:04 2011 -0800

    mm/vmalloc.c: remove static declaration of va from __get_vm_area_node
    
    Static storage is not required for the struct vmap_area in
    __get_vm_area_node.
    
    Removing "static" to store this variable on the stack instead.
    
    Signed-off-by: Kautuk Consul <consul.kautuk@gmail.com>
    Acked-by: David Rientjes <rientjes@google.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 461ecdf221edb089e5fa0d5563e1688cd0a36f66
Author: Michel Lespinasse <walken@google.com>
Date:   Mon Dec 19 17:12:06 2011 -0800

    binary_sysctl(): fix memory leak
    
    binary_sysctl() calls sysctl_getname() which allocates from names_cache
    slab usin __getname()
    
    The matching function to free the name is __putname(), and not putname()
    which should be used only to match getname() allocations.
    
    This is because when auditing is enabled, putname() calls audit_putname
    *instead* (not in addition) to __putname().  Then, if a syscall is in
    progress, audit_putname does not release the name - instead, it expects
    the name to get released when the syscall completes, but that will happen
    only if audit_getname() was called previously, i.e.  if the name was
    allocated with getname() rather than the naked __getname().  So,
    __getname() followed by putname() ends up leaking memory.
    
    Signed-off-by: Michel Lespinasse <walken@google.com>
    Acked-by: Al Viro <viro@zeniv.linux.org.uk>
    Cc: Christoph Hellwig <hch@infradead.org>
    Cc: Eric Paris <eparis@redhat.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 0a2cd3ef50c0bae70d59c74a77db0455d26fde56
Author: Sean Hefty <sean.hefty@intel.com>
Date:   Tue Dec 6 21:17:11 2011 +0000

    RDMA/cma: Verify private data length
    
    private_data_len is defined as a u8.  If the user specifies a large
    private_data size (> 220 bytes), we will calculate a total length that
    exceeds 255, resulting in private_data_len wrapping back to 0.  This
    can lead to overwriting random kernel memory.  Avoid this by verifying
    that the resulting size fits into a u8.
    
    Reported-by: B. Thery <benjamin.thery@bull.net>
    Addresses: <http://bugs.openfabrics.org/bugzilla/show_bug.cgi?id=2335>
    Signed-off-by: Sean Hefty <sean.hefty@intel.com>
    Signed-off-by: Roland Dreier <roland@purestorage.com>

commit 6b618c54aaec99078629ec5b9575cb7d6fc31176
Author: Xi Wang <xi.wang@gmail.com>
Date:   Sun Dec 11 23:40:56 2011 -0800

    Input: cma3000_d0x - fix signedness bug in cma3000_thread_irq()
    
    The error check (intr_status < 0) didn't work because intr_status is
    a u8.  Change its type to signed int.
    
    Signed-off-by: Xi Wang <xi.wang@gmail.com>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

commit e27f34e383d7863b2528a63b81b23db09781f6b6
Author: Xi Wang <xi.wang@gmail.com>
Date:   Fri Dec 16 12:44:15 2011 +0000

    sctp: fix incorrect overflow check on autoclose
    
    Commit 8ffd3208 voids the previous patches f6778aab and 810c0719 for
    limiting the autoclose value.  If userspace passes in -1 on 32-bit
    platform, the overflow check didn't work and autoclose would be set
    to 0xffffffff.
    
    This patch defines a max_autoclose (in seconds) for limiting the value
    and exposes it through sysctl, with the following intentions.
    
    1) Avoid overflowing autoclose * HZ.
    
    2) Keep the default autoclose bound consistent across 32- and 64-bit
       platforms (INT_MAX / HZ in this patch).
    
    3) Keep the autoclose value consistent between setsockopt() and
       getsockopt() calls.
    
    Suggested-by: Vlad Yasevich <vladislav.yasevich@hp.com>
    Signed-off-by: Xi Wang <xi.wang@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit 8ebdfaad2f46ff0ac9fef9858e436bcc712a1ac8
Author: Xi Wang <xi.wang@gmail.com>
Date:   Wed Dec 21 05:18:33 2011 -0500

    vmwgfx: fix incorrect VRAM size check in vmw_kms_fb_create()
    
    Commit e133e737 didn't correctly fix the integer overflow issue.
    
    -	unsigned int required_size;
    +	u64 required_size;
    	...
    	required_size = mode_cmd->pitch * mode_cmd->height;
    -	if (unlikely(required_size > dev_priv->vram_size)) {
    +	if (unlikely(required_size > (u64) dev_priv->vram_size)) {
    
    Note that both pitch and height are u32.  Their product is still u32 and
    would overflow before being assigned to required_size.  A correct way is
    to convert pitch and height to u64 before the multiplication.
    
    	required_size = (u64)mode_cmd->pitch * (u64)mode_cmd->height;
    
    This patch calls the existing vmw_kms_validate_mode_vram() for
    validation.
    
    Signed-off-by: Xi Wang <xi.wang@gmail.com>
    Reviewed-and-tested-by: Thomas Hellstrom <thellstrom@vmware.com>
    Signed-off-by: Dave Airlie <airlied@redhat.com>
    
    Conflicts:
    
    	drivers/gpu/drm/vmwgfx/vmwgfx_kms.c

commit eb8f0bd01fb994c9abc77dc84729794cd841753d
Author: Xi Wang <xi.wang@gmail.com>
Date:   Thu Dec 22 13:35:22 2011 +0000

    rps: fix insufficient bounds checking in store_rps_dev_flow_table_cnt()
    
    Setting a large rps_flow_cnt like (1 << 30) on 32-bit platform will
    cause a kernel oops due to insufficient bounds checking.
    
    	if (count > 1<<30) {
    		/* Enforce a limit to prevent overflow */
    		return -EINVAL;
    	}
    	count = roundup_pow_of_two(count);
    	table = vmalloc(RPS_DEV_FLOW_TABLE_SIZE(count));
    
    Note that the macro RPS_DEV_FLOW_TABLE_SIZE(count) is defined as:
    
    	... + (count * sizeof(struct rps_dev_flow))
    
    where sizeof(struct rps_dev_flow) is 8.  (1 << 30) * 8 will overflow
    32 bits.
    
    This patch replaces the magic number (1 << 30) with a symbolic bound.
    
    Suggested-by: Eric Dumazet <eric.dumazet@gmail.com>
    Signed-off-by: Xi Wang <xi.wang@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit 648188958672024b616c42c1f6c98c8cfc85619d
Author: Xi Wang <xi.wang@gmail.com>
Date:   Fri Dec 30 10:40:17 2011 -0500

    netfilter: ctnetlink: fix timeout calculation
    
    The sanity check (timeout < 0) never works; the dividend is unsigned
    and so is the division, which should have been a signed division.
    
    	long timeout = (ct->timeout.expires - jiffies) / HZ;
    	if (timeout < 0)
    		timeout = 0;
    
    This patch converts the time values to signed for the division.
    
    Signed-off-by: Xi Wang <xi.wang@gmail.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

commit ab03a0973cee73f88655ff4981812ad316a6cd59
Merge: 76f82df 7bdddeb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jan 3 17:42:50 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 7bdddebd9d274a344a1c57a561152160c9e9a32a
Merge: 3e59cb5 55cc81a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jan 3 17:42:36 2012 -0500

    Merge branch 'linux-3.1.y' into pax-test

commit 76f82df18ba181687f454426fa9ced7a92b2ac1f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Dec 22 20:15:02 2011 -0500

    Only further restrict futex targeting another process -- our modified
    permission check also happened to allow a case where a process retaining
    uid 0 could issue futex syscalls against other uid 0 tasks, despite the euid
    being non-zero (reported on forums by ben_w)

commit 6b235a4450a5fea41663ec35fa0608988b6078c6
Merge: 97c16f0 3e59cb5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Dec 22 19:11:06 2011 -0500

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	fs/hfs/btree.c

commit 3e59cb503d4ca6ce0954b8d3eb508cf7d1a31f50
Merge: 285eb4e c26f60b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Dec 22 19:09:57 2011 -0500

    Merge branch 'linux-3.1.y' into pax-test
    
    Conflicts:
    	arch/x86/kernel/process.c

commit 97c16f0fcff592160c1787bd1c56ae7ad070ac17
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Dec 19 21:54:01 2011 -0500

    Add new option: "Enforce consistent multithreaded privileges"

commit 7d125a16a5245b2bafc9184b8f93e864394ba1cb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Dec 7 19:58:31 2011 -0500

    Remove harmless duplicate code -- exec_file would be null already so the
    second check would never pass.

commit 4e3304e94aa72737810bc50169519af157dce4ce
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Dec 7 19:50:39 2011 -0500

    Revert back to (possibly?) undocumented /proc/pid behavior that gdb
    depended on for attaching to a thread.  Entries exist in /proc for
    threads, but are not visible in a readdir.

commit 1bd899335f23815cfe8deac44c6b346398f3b95e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Dec 4 18:03:28 2011 -0500

    Put the already-walked path if in RCU-walk mode

commit ec7ae36b7159f10649709779443a988662965d66
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Dec 4 17:35:21 2011 -0500

    Fix memory leak introduced by recent (unpublished) commit
    75ab998b94a29d464518d6d501bdde3fbfcbfa14

commit 1e2318a8ea2e67eaf17236be374b5da8a5ba5e04
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Dec 4 13:56:10 2011 -0500

    Explicitly check size copied to userland in override_release to silence gcc

commit c30a85d0fff67e0724e726febb934c0b6fa01c6c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Dec 4 13:54:02 2011 -0500

    Initialize variable to silence erroneous gcc warning

commit 2cf8e7a3bf4e97b2cd3de9ebc453bc505dc7eb78
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Dec 4 13:47:47 2011 -0500

    Future-proof other potential RCU-aware locations where we can log.

commit 0c904e8c7ea0338c47c7ae825e093a152dc8f8a8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Dec 4 13:02:54 2011 -0500

    Fix freeze reported by 'vs' on the forums.  Bug occurred due to
    MAY_NOT_BLOCK added to Linux 3.1.  Our logging code, when a capability used
    in generic_permission() was in the task's effective set but disallowed by
    RBAC, would block when acquiring locks resulting in the freeze.
    
    Also update the ordering of checks so that CAP_DAC_READ_SEARCH isn't logged
    as being required when CAP_DAC_OVERRIDE is present (consistent with
    older patches).

commit ab694e5eccfbc369baa593ebc1269d1908cf16dc
Author: Xi Wang <xi.wang@gmail.com>
Date:   Tue Nov 29 09:26:30 2011 +0000

    sctp: better integer overflow check in sctp_auth_create_key()
    
    The check from commit 30c2235c is incomplete and cannot prevent
    cases like key_len = 0x80000000 (INT_MAX + 1).  In that case, the
    left-hand side of the check (INT_MAX - key_len), which is unsigned,
    becomes 0xffffffff (UINT_MAX) and bypasses the check.
    
    However this shouldn't be a security issue.  The function is called
    from the following two code paths:
    
     1) setsockopt()
    
     2) sctp_auth_asoc_set_secret()
    
    In case (1), sca_keylength is never going to exceed 65535 since it's
    bounded by a u16 from the user API.  As such, the key length will
    never overflow.
    
    In case (2), sca_keylength is computed based on the user key (1 short)
    and 2 * key_vector (3 shorts) for a total of 7 * USHRT_MAX, which still
    will not overflow.
    
    In other words, this overflow check is not really necessary.  Just
    make it more correct.
    
    Signed-off-by: Xi Wang <xi.wang@gmail.com>
    Cc: Vlad Yasevich <vladislav.yasevich@hp.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit e565e28c3635a1d50f80541fbf6b606d742fec76
Author: Josh Boyer <jwboyer@redhat.com>
Date:   Fri Aug 19 14:50:26 2011 -0400

    fs/minix: Verify bitmap block counts before mounting
    
    Newer versions of MINIX can create filesystems that allocate an extra
    bitmap block.  Mounting of this succeeds, but doing a statfs call will
    result in an oops in count_free because of a negative number being used
    for the bh index.
    
    Avoid this by verifying the number of allocated blocks at mount time,
    erroring out if there are not enough and make statfs ignore the extras
    if there are too many.
    
    This fixes https://bugzilla.kernel.org/show_bug.cgi?id=18792
    
    Signed-off-by: Josh Boyer <jwboyer@redhat.com>
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

commit 6e134e398ec1a3f428261680e83df4319e64bed9
Author: Julia Lawall <julia@diku.dk>
Date:   Tue Nov 15 14:53:11 2011 -0800

    drivers/gpu/vga/vgaarb.c: add missing kfree
    
    kbuf is a buffer that is local to this function, so all of the error paths
    leaving the function should release it.
    
    Signed-off-by: Julia Lawall <julia@diku.dk>
    Cc: Jesper Juhl <jj@chaosbits.net>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Dave Airlie <airlied@redhat.com>

commit 2b9057b321e36860e8d63985b5c4e496f254b717
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 3 21:33:28 2011 -0500

    Import changes between pax-linux-3.1.4-test18.patch and grsecurity-2.2.2-3.1.4-201112021740.patch

commit 5dfe6091dca281a456eaff5e7b4692d768a05cfd
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 3 21:29:37 2011 -0500

    Import pax-linux-3.1.4-test18.patch

commit 285eb4ea45d853ae00426b3315a61c1368080dad
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 10 18:33:46 2011 -0500

    Import changes from pax-linux-3.1.5-test20.patch

commit a6bda918fc90ec1d5c387e978d147ad2044153f1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Dec 8 20:55:54 2011 -0500

    Import changes from pax-linux-3.1.4-test19.patch

commit e6d987bdb782b280f882cc20055e3d9cb28ad3a5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 3 21:29:37 2011 -0500

    Import pax-linux-3.1.4-test18.patch
